<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Lista de CumpÄƒrÄƒturi</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f0fdf4, #ecfeff);
            min-height: 100vh;
            padding: 16px;
            padding-bottom: 30px;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
        }

        .header {
            background: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 20px;
            position: sticky;
            top: 16px;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 20px;
            font-weight: 700;
            color: #059669;
            flex: 1;
        }

        .logo i {
            font-size: 20px;
        }

        .home-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: #f3f4f6;
            border: none;
            border-radius: 12px;
            color: #4b5563;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            min-width: 80px;
            justify-content: center;
        }

        .home-btn:hover {
            background: #e5e7eb;
            color: #1f2937;
        }

        .hero {
            text-align: center;
            margin-bottom: 24px;
        }

        .hero h2 {
            font-size: 24px;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 12px;
            line-height: 1.3;
        }

        .hero p {
            font-size: 16px;
            color: #4b5563;
            line-height: 1.5;
        }

        .actions {
            display: grid;
            grid-template-columns: 1fr;
            gap: 16px;
            margin-bottom: 24px;
        }

        .action-btn {
            padding: 20px;
            border: none;
            border-radius: 16px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            min-height: 100px;
        }

        .create-btn {
            background: #059669;
            color: white;
        }

        .create-btn:hover {
            background: #047857;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(5, 150, 105, 0.3);
        }

        .join-btn {
            background: white;
            color: #374151;
            border: 1px solid #d1d5db;
        }

        .join-btn:hover {
            background: #f9fafb;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .action-btn i {
            font-size: 28px;
        }

        .form-container {
            margin-bottom: 24px;
        }

        .form-card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }

        .form-card h2 {
            font-size: 20px;
            font-weight: 700;
            color: #1f2937;
            text-align: center;
            margin-bottom: 20px;
            line-height: 1.3;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .form-group input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #d1d5db;
            border-radius: 12px;
            font-size: 16px;
            transition: border-color 0.2s;
            background: white;
        }

        .form-group input:focus {
            outline: none;
            border-color: #059669;
            box-shadow: 0 0 0 3px rgba(5, 150, 105, 0.1);
        }

        .error {
            background: #fef2f2;
            color: #dc2626;
            padding: 10px 12px;
            border-radius: 10px;
            font-size: 14px;
            margin-bottom: 16px;
            text-align: center;
        }

        .btn-primary {
            width: 100%;
            padding: 14px;
            background: #059669;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
            margin-bottom: 12px;
        }

        .btn-primary:hover {
            background: #047857;
        }

        .btn-secondary {
            width: 100%;
            padding: 14px;
            background: #f3f4f6;
            color: #4b5563;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .btn-secondary:hover {
            background: #e5e7eb;
        }

        .list-header {
            background: linear-gradient(90deg, #059669, #0d9488);
            color: white;
            padding: 20px;
            border-radius: 16px 16px 0 0;
            margin-bottom: 0;
        }

        .list-header-content {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .list-title-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .list-title {
            font-size: 20px;
            font-weight: 700;
            flex: 1;
        }

        .list-code {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 14px;
            border-radius: 20px;
            font-family: monospace;
            font-size: 16px;
            font-weight: 700;
            letter-spacing: 1px;
            white-space: nowrap;
        }

        .list-code i {
            cursor: pointer;
            transition: transform 0.2s;
        }

        .list-code i:hover {
            transform: scale(1.1);
        }

        .list-instructions {
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 14px;
            border-radius: 10px;
            font-size: 13px;
            margin-top: 8px;
        }

        .list-form {
            background: #f9fafb;
            padding: 20px;
            border: 1px solid #e5e7eb;
            border-top: none;
        }

        .add-item-form {
            display: flex;
            gap: 10px;
            margin-bottom: 16px;
        }

        .add-item-form input {
            flex: 1;
            padding: 14px 16px;
            border: 1px solid #d1d5db;
            border-radius: 12px;
            font-size: 16px;
            background: white;
        }

        .add-item-form button {
            padding: 14px 20px;
            background: #059669;
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
            min-width: 80px;
        }

        .add-item-form button:hover {
            background: #047857;
        }

        .add-item-form button:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }

        .search-box {
            position: relative;
            margin-bottom: 16px;
        }

        .search-box i {
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            color: #9ca3af;
            font-size: 16px;
        }

        .search-box input {
            width: 100%;
            padding: 14px 14px 14px 44px;
            border: 1px solid #d1d5db;
            border-radius: 12px;
            font-size: 16px;
            background: white;
        }

        .categories {
            background: white;
            border: 1px solid #e5e7eb;
            border-top: none;
            border-radius: 0 0 16px 16px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .category {
            padding: 16px 20px;
            border-bottom: 1px solid #f3f4f6;
        }

        .category:last-child {
            border-bottom: none;
        }

        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            cursor: pointer;
        }

        .category-title {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 18px;
            font-weight: 700;
            color: #1f2937;
        }

        .category-title i {
            font-size: 18px;
            color: #6b7280;
        }

        .category-count {
            color: #6b7280;
            font-size: 14px;
            font-weight: 500;
            background: #f3f4f6;
            padding: 2px 8px;
            border-radius: 10px;
        }

        .category-items {
            margin-left: 28px;
        }

        .no-items {
            color: #9ca3af;
            font-style: italic;
            font-size: 14px;
            padding: 8px 0;
        }

        .item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 0;
            border-radius: 8px;
        }

        .item-checkbox {
            width: 22px;
            height: 22px;
            border: 2px solid #d1d5db;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            flex-shrink: 0;
        }

        .item-checkbox.checked {
            background: #059669;
            border-color: #059669;
        }

        .item-checkbox.checked i {
            color: white;
            font-size: 12px;
        }

        .item-text {
            flex: 1;
            font-size: 16px;
            color: #374151;
            word-break: break-word;
            padding-right: 8px;
        }

        .item-text.completed {
            text-decoration: line-through;
            color: #9ca3af;
        }

        .item-actions {
            display: flex;
            align-items: center;
            gap: 8px;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .item:hover .item-actions {
            opacity: 1;
        }

        .move-select {
            padding: 6px 10px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 12px;
            background: white;
            min-width: 100px;
        }

        .delete-btn {
            padding: 6px;
            background: none;
            border: none;
            color: #9ca3af;
            cursor: pointer;
            border-radius: 6px;
            transition: color 0.2s;
            flex-shrink: 0;
        }

        .delete-btn:hover {
            color: #ef4444;
        }

        .instructions {
            background: white;
            border-radius: 16px;
            padding: 16px;
            margin-top: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .instructions p {
            color: #6b7280;
            font-size: 13px;
            margin: 4px 0;
            line-height: 1.4;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 24px;
            width: 100%;
            max-width: 400px;
            max-height: 85vh;
            overflow-y: auto;
        }

        .modal h3 {
            font-size: 18px;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 12px;
            line-height: 1.4;
        }

        .modal p {
            color: #6b7280;
            font-size: 14px;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .categories-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            margin-bottom: 20px;
            max-height: 250px;
            overflow-y: auto;
            padding-right: 8px;
        }

        .category-btn {
            padding: 14px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            background: white;
            text-align: left;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 15px;
            font-weight: 600;
        }

        .category-btn:hover {
            border-color: #6ee7b7;
            background: #f0fdf4;
        }

        .category-btn.selected {
            border-color: #059669;
            background: #f0fdf4;
            color: #059669;
        }

        .custom-category {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .custom-category input {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid #d1d5db;
            border-radius: 12px;
            font-size: 15px;
            background: white;
        }

        .custom-category button {
            padding: 12px 16px;
            background: #f3f4f6;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: background 0.2s;
            font-weight: 600;
        }

        .custom-category button:hover {
            background: #e5e7eb;
        }

        .modal-buttons {
            display: flex;
            gap: 12px;
            flex-direction: column;
        }

        .modal-buttons button {
            padding: 14px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
            font-size: 16px;
        }

        .confirm-btn {
            background: #059669;
            color: white;
        }

        .confirm-btn:hover {
            background: #047857;
        }

        .confirm-btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }

        .cancel-btn {
            background: #f3f4f6;
            color: #4b5563;
        }

        .cancel-btn:hover {
            background: #e5e7eb;
        }

        .hidden {
            display: none;
        }

        /* Touch-friendly improvements */
        button, .item-checkbox, .category-header {
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        input, textarea, select {
            -webkit-appearance: none;
            appearance: none;
        }

        /* Scrollbar styling for mobile */
        .categories, .categories-grid {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .categories::-webkit-scrollbar, .categories-grid::-webkit-scrollbar {
            display: none;
        }

        /* Safe area insets for iPhone */
        @supports (padding-top: env(safe-area-inset-top)) {
            body {
                padding-top: env(safe-area-inset-top);
                padding-bottom: env(safe-area-inset-bottom);
            }
            .header {
                top: calc(16px + env(safe-area-inset-top));
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-shopping-cart"></i>
                    <span>Lista CumpÄƒrÄƒturi</span>
                </div>
                <button class="home-btn hidden" id="backHomeBtn">
                    <i class="fas fa-home"></i>
                    <span>AcasÄƒ</span>
                </button>
            </div>
        </div>

        <!-- Home View -->
        <div id="homeView">
            <div class="hero">
                <h2>Lista de CumpÄƒrÄƒturi InteligentÄƒ</h2>
                <p>AdaugÄƒ alimente È™i alege categoria. PartajeazÄƒ lista cu oricine!</p>
            </div>

            <div class="actions">
                <button class="action-btn create-btn" id="createBtn">
                    <i class="fas fa-plus-circle"></i>
                    <span>CreeazÄƒ ListÄƒ NouÄƒ</span>
                </button>
                <button class="action-btn join-btn" id="joinBtn">
                    <i class="fas fa-key"></i>
                    <span>AlÄƒturÄƒ-te Listei</span>
                </button>
            </div>
        </div>

        <!-- Create View -->
        <div id="createView" class="hidden">
            <div class="form-container">
                <div class="form-card">
                    <h2>CreeazÄƒ Lista Ta</h2>
                    <div class="form-group">
                        <label for="listName">Numele Listei</label>
                        <input type="text" id="listName" placeholder="Ex: CumpÄƒrÄƒturi SÄƒptÄƒmÃ¢nale..." autocomplete="off">
                    </div>
                    <div id="createError" class="error hidden"></div>
                    <button class="btn-primary" id="createListBtn">CreeazÄƒ ListÄƒ</button>
                    <button class="btn-secondary" id="backToHome1">ÃŽnapoi la AcasÄƒ</button>
                </div>
            </div>
        </div>

        <!-- Join View -->
        <div id="joinView" class="hidden">
            <div class="form-container">
                <div class="form-card">
                    <h2>AlÄƒturÄƒ-te unei Liste</h2>
                    <div class="form-group">
                        <label for="joinCode">Codul Listei (6 cifre)</label>
                        <input type="text" id="joinCode" placeholder="XXXXXX" maxlength="6" autocomplete="off" inputmode="numeric">
                    </div>
                    <div id="joinError" class="error hidden"></div>
                    <button class="btn-primary" id="joinListBtn">AlÄƒturÄƒ-te Listei</button>
                    <button class="btn-secondary" id="backToHome2">ÃŽnapoi la AcasÄƒ</button>
                </div>
            </div>
        </div>

        <!-- List View -->
        <div id="listView" class="hidden">
            <div class="list-card">
                <div class="list-header">
                    <div class="list-header-content">
                        <div class="list-title-row">
                            <div class="list-title" id="listTitle">Lista Mea</div>
                            <div class="list-code">
                                <span id="listCodeDisplay">123456</span>
                                <i class="fas fa-copy" id="copyCodeBtn" title="CopiazÄƒ codul"></i>
                            </div>
                        </div>
                        <div class="list-instructions">PartajeazÄƒ acest cod cu oricine pentru colaborare</div>
                    </div>
                </div>
                
                <div class="list-form">
                    <div class="add-item-form">
                        <input type="text" id="newItem" placeholder="AdaugÄƒ aliment..." autocomplete="off">
                        <button id="addItemBtn">+</button>
                    </div>
                    
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="searchInput" placeholder="CautÄƒ...">
                    </div>
                </div>
                
                <div class="categories" id="categoriesContainer">
                    <!-- Categories will be populated here -->
                </div>
            </div>
            
            <div class="instructions">
                <p>âœ… ApasÄƒ pe aliment pentru a-l bifa</p>
                <p>ðŸ”„ Orice persoanÄƒ cu codul poate edita lista</p>
                <p>ðŸ“± Optimizat pentru telefon</p>
            </div>
        </div>
    </div>

    <!-- Category Selection Modal -->
    <div id="categoryModal" class="modal hidden">
        <div class="modal-content">
            <h3>Alege categoria pentru acest aliment</h3>
            <p id="modalItemName" style="font-weight: 600; color: #1f2937; margin-bottom: 16px;"></p>
            
            <div class="categories-grid" id="categoriesGrid">
                <!-- Category buttons will be populated here -->
            </div>
            
            <div class="custom-category">
                <input type="text" id="customCategory" placeholder="Categorie nouÄƒ...">
                <button id="addCustomCategory">+</button>
            </div>
            <div id="modalError" class="error hidden"></div>
            
            <div class="modal-buttons">
                <button class="confirm-btn" id="confirmAddBtn" disabled>AdaugÄƒ Ã®n listÄƒ</button>
                <button class="cancel-btn" id="cancelAddBtn">AnuleazÄƒ</button>
            </div>
        </div>
    </div>

    <script>
        // State management
        let currentView = 'home';
        let lists = [];
        let currentList = null;
        let modalCurrentItem = '';
        let expandedCategories = {};

        // Default categories
        const defaultCategories = [
            'Lactate', 'PÃ¢ine', 'Fructe', 'Legume', 'Carne', 'PeÈ™te', 'BÄƒuturi', 'Dulciuri', 
            'Cereale', 'Condimente', 'Altele'
        ];

        // DOM Elements
        const elements = {
            homeView: document.getElementById('homeView'),
            createView: document.getElementById('createView'),
            joinView: document.getElementById('joinView'),
            listView: document.getElementById('listView'),
            backHomeBtn: document.getElementById('backHomeBtn'),
            createBtn: document.getElementById('createBtn'),
            joinBtn: document.getElementById('joinBtn'),
            createListBtn: document.getElementById('createListBtn'),
            joinListBtn: document.getElementById('joinListBtn'),
            backToHome1: document.getElementById('backToHome1'),
            backToHome2: document.getElementById('backToHome2'),
            listName: document.getElementById('listName'),
            joinCode: document.getElementById('joinCode'),
            createError: document.getElementById('createError'),
            joinError: document.getElementById('joinError'),
            listTitle: document.getElementById('listTitle'),
            listCodeDisplay: document.getElementById('listCodeDisplay'),
            copyCodeBtn: document.getElementById('copyCodeBtn'),
            newItem: document.getElementById('newItem'),
            addItemBtn: document.getElementById('addItemBtn'),
            searchInput: document.getElementById('searchInput'),
            categoriesContainer: document.getElementById('categoriesContainer'),
            categoryModal: document.getElementById('categoryModal'),
            modalItemName: document.getElementById('modalItemName'),
            categoriesGrid: document.getElementById('categoriesGrid'),
            customCategory: document.getElementById('customCategory'),
            addCustomCategory: document.getElementById('addCustomCategory'),
            modalError: document.getElementById('modalError'),
            confirmAddBtn: document.getElementById('confirmAddBtn'),
            cancelAddBtn: document.getElementById('cancelAddBtn')
        };

        // Helper functions
        function generateCode() {
            return Math.floor(100000 + Math.random() * 900000).toString();
        }

        function showError(element, message) {
            element.textContent = message;
            element.classList.remove('hidden');
        }

        function hideError(element) {
            element.classList.add('hidden');
        }

        function showView(view) {
            // Hide all views
            elements.homeView.classList.add('hidden');
            elements.createView.classList.add('hidden');
            elements.joinView.classList.add('hidden');
            elements.listView.classList.add('hidden');
            
            // Show selected view
            switch(view) {
                case 'home':
                    elements.homeView.classList.remove('hidden');
                    break;
                case 'create':
                    elements.createView.classList.remove('hidden');
                    elements.listName.value = '';
                    hideError(elements.createError);
                    setTimeout(() => {
                        elements.listName.focus();
                        elements.listName.click(); // Trigger keyboard on mobile
                    }, 100);
                    break;
                case 'join':
                    elements.joinView.classList.remove('hidden');
                    elements.joinCode.value = '';
                    hideError(elements.joinError);
                    setTimeout(() => {
                        elements.joinCode.focus();
                        elements.joinCode.click(); // Trigger keyboard on mobile
                    }, 100);
                    break;
                case 'list':
                    elements.listView.classList.remove('hidden');
                    elements.backHomeBtn.classList.remove('hidden');
                    elements.newItem.value = '';
                    setTimeout(() => {
                        elements.newItem.focus();
                        elements.newItem.click(); // Trigger keyboard on mobile
                    }, 100);
                    renderList();
                    break;
            }
            currentView = view;
        }

        function createList() {
            const name = elements.listName.value.trim();
            if (!name) {
                showError(elements.createError, 'Introdu un nume pentru listÄƒ');
                return;
            }
            
            const code = generateCode();
            const newList = {
                id: Date.now(),
                name: name,
                code: code,
                categories: defaultCategories.map(cat => ({
                    name: cat,
                    items: [],
                    id: Date.now() + Math.random()
                })),
                createdAt: new Date().toISOString()
            };
            
            lists.push(newList);
            currentList = newList;
            elements.listName.value = '';
            hideError(elements.createError);
            showView('list');
            
            // Expand all categories
            expandedCategories = {};
            defaultCategories.forEach(cat => {
                expandedCategories[cat] = true;
            });
        }

        function joinList() {
            const code = elements.joinCode.value.trim();
            if (!code) {
                showError(elements.joinError, 'Introdu un cod');
                return;
            }
            
            const foundList = lists.find(list => list.code === code);
            if (foundList) {
                currentList = foundList;
                elements.joinCode.value = '';
                hideError(elements.joinError);
                showView('list');
                
                // Expand all categories
                expandedCategories = {};
                foundList.categories.forEach(cat => {
                    expandedCategories[cat.name] = true;
                });
            } else {
                showError(elements.joinError, 'Cod invalid. ÃŽncearcÄƒ din nou.');
            }
        }

        function showCategoryModal(itemName) {
            if (!itemName.trim()) return;
            modalCurrentItem = itemName;
            elements.modalItemName.textContent = `"${itemName}"`;
            populateCategoriesGrid();
            elements.customCategory.value = '';
            hideError(elements.modalError);
            elements.confirmAddBtn.disabled = true;
            elements.categoryModal.classList.remove('hidden');
        }

        function populateCategoriesGrid() {
            elements.categoriesGrid.innerHTML = '';
            if (!currentList) return;
            
            currentList.categories.forEach(category => {
                const btn = document.createElement('button');
                btn.className = 'category-btn';
                btn.textContent = category.name;
                btn.onclick = function() {
                    // Remove selected class from all buttons
                    document.querySelectorAll('.category-btn').forEach(b => {
                        b.classList.remove('selected');
                    });
                    // Add selected class to clicked button
                    this.classList.add('selected');
                    elements.confirmAddBtn.disabled = false;
                };
                elements.categoriesGrid.appendChild(btn);
            });
        }

        function addCustomCategory() {
            const categoryName = elements.customCategory.value.trim();
            if (!categoryName) return;
            
            if (currentList.categories.some(cat => 
                cat.name.toLowerCase() === categoryName.toLowerCase())) {
                showError(elements.modalError, 'Categoria existÄƒ deja');
                return;
            }
            
            const newCategory = {
                name: categoryName,
                items: [],
                id: Date.now() + Math.random()
            };
            currentList.categories.push(newCategory);
            populateCategoriesGrid();
            elements.customCategory.value = '';
            hideError(elements.modalError);
        }

        function confirmAddItem() {
            const selectedBtn = document.querySelector('.category-btn.selected');
            if (!selectedBtn) return;
            
            const categoryName = selectedBtn.textContent;
            const category = currentList.categories.find(cat => cat.name === categoryName);
            if (!category) return;
            
            category.items.push({
                id: Date.now(),
                text: modalCurrentItem,
                completed: false
            });
            
            elements.categoryModal.classList.add('hidden');
            elements.newItem.value = '';
            renderList();
        }

        function toggleCategory(categoryName) {
            expandedCategories[categoryName] = !expandedCategories[categoryName];
            renderList();
        }

        function toggleItem(categoryId, itemId) {
            currentList.categories.forEach(category => {
                if (category.id === categoryId) {
                    category.items.forEach(item => {
                        if (item.id === itemId) {
                            item.completed = !item.completed;
                        }
                    });
                }
            });
            renderList();
        }

        function deleteItem(categoryId, itemId) {
            currentList.categories.forEach(category => {
                if (category.id === categoryId) {
                    category.items = category.items.filter(item => item.id !== itemId);
                }
            });
            renderList();
        }

        function moveItemToCategory(itemId, fromCategoryId, toCategoryName) {
            if (!toCategoryName) return;
            
            let itemToMove = null;
            let fromCategory = null;
            
            // Find the item and its current category
            currentList.categories.forEach(category => {
                if (category.id === fromCategoryId) {
                    fromCategory = category;
                    category.items.forEach(item => {
                        if (item.id === itemId) {
                            itemToMove = item;
                        }
                    });
                }
            });
            
            if (!itemToMove || !fromCategory) return;
            
            // Remove from old category
            fromCategory.items = fromCategory.items.filter(item => item.id !== itemId);
            
            // Add to new category
            currentList.categories.forEach(category => {
                if (category.name === toCategoryName) {
                    category.items.push(itemToMove);
                }
            });
            
            renderList();
        }

        function copyCode() {
            // For mobile browsers that don't support clipboard API
            const textArea = document.createElement('textarea');
            textArea.value = currentList.code;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            
            // Show visual feedback
            const originalText = elements.listCodeDisplay.textContent;
            elements.listCodeDisplay.textContent = 'Copiat!';
            setTimeout(() => {
                elements.listCodeDisplay.textContent = originalText;
            }, 1000);
        }

        function filterCategories() {
            const searchTerm = elements.searchInput.value.toLowerCase();
            const container = elements.categoriesContainer;
            container.innerHTML = '';
            
            if (!currentList) return;
            
            const filteredCategories = currentList.categories.filter(category => {
                const categoryNameMatch = category.name.toLowerCase().includes(searchTerm);
                const itemsMatch = category.items.some(item => 
                    item.text.toLowerCase().includes(searchTerm)
                );
                return categoryNameMatch || itemsMatch || !searchTerm;
            });
            
            if (filteredCategories.length === 0) {
                container.innerHTML = '<div class="category"><p class="no-items">Nimic gÄƒsit</p></div>';
                return;
            }
            
            filteredCategories.forEach(category => {
                const categoryElement = document.createElement('div');
                categoryElement.className = 'category';
                
                const itemsToShow = category.items.filter(item => 
                    !elements.searchInput.value || item.text.toLowerCase().includes(elements.searchInput.value.toLowerCase())
                );
                
                const categoryName = category.name;
                const isExpanded = expandedCategories[categoryName] || false;
                const itemCount = itemsToShow.length;
                
                categoryElement.innerHTML = `
                    <div class="category-header">
                        <div class="category-title">
                            <i class="fas fa-${isExpanded ? 'chevron-down' : 'chevron-right'}"></i>
                            <span>${categoryName}</span>
                        </div>
                        <div class="category-count">${itemCount}</div>
                    </div>
                    ${isExpanded ? '<div class="category-items" id="items-' + category.id + '"></div>' : ''}
                `;
                
                container.appendChild(categoryElement);
                
                // Add event listener for category header
                categoryElement.querySelector('.category-header').addEventListener('click', () => {
                    toggleCategory(categoryName);
                });
                
                if (isExpanded) {
                    const itemsContainer = document.getElementById(`items-${category.id}`);
                    if (itemsToShow.length === 0) {
                        itemsContainer.innerHTML = '<p class="no-items">Niciun aliment</p>';
                    } else {
                        itemsToShow.forEach(item => {
                            const itemElement = document.createElement('div');
                            itemElement.className = 'item';
                            itemElement.innerHTML = `
                                <div class="item-checkbox ${item.completed ? 'checked' : ''}">
                                    ${item.completed ? '<i class="fas fa-check"></i>' : ''}
                                </div>
                                <span class="item-text ${item.completed ? 'completed' : ''}">${item.text}</span>
                                <div class="item-actions">
                                    <select class="move-select">
                                        <option value="">MutÄƒ</option>
                                        ${currentList.categories.map(otherCat => 
                                            otherCat.name !== categoryName ? 
                                            `<option value="${otherCat.name}">${otherCat.name}</option>` : 
                                            ''
                                        ).join('')}
                                    </select>
                                    <button class="delete-btn">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            `;
                            itemsContainer.appendChild(itemElement);
                            
                            // Add event listeners for item actions
                            const checkbox = itemElement.querySelector('.item-checkbox');
                            const deleteBtn = itemElement.querySelector('.delete-btn');
                            const moveSelect = itemElement.querySelector('.move-select');
                            
                            checkbox.addEventListener('click', () => {
                                toggleItem(category.id, item.id);
                            });
                            
                            deleteBtn.addEventListener('click', () => {
                                deleteItem(category.id, item.id);
                            });
                            
                            moveSelect.addEventListener('change', (e) => {
                                moveItemToCategory(item.id, category.id, e.target.value);
                            });
                        });
                    }
                }
            });
        }

        function renderList() {
            if (!currentList) return;
            
            elements.listTitle.textContent = currentList.name;
            elements.listCodeDisplay.textContent = currentList.code;
            filterCategories();
        }

        // Event Listeners
        elements.createBtn.addEventListener('click', () => showView('create'));
        elements.joinBtn.addEventListener('click', () => showView('join'));
        elements.createListBtn.addEventListener('click', createList);
        elements.joinListBtn.addEventListener('click', joinList);
        elements.backToHome1.addEventListener('click', () => showView('home'));
        elements.backToHome2.addEventListener('click', () => showView('home'));
        elements.backHomeBtn.addEventListener('click', () => showView('home'));
        
        elements.listName.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') createList();
        });
        
        elements.joinCode.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') joinList();
        });
        
        elements.newItem.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                const item = elements.newItem.value.trim();
                if (item) showCategoryModal(item);
            }
        });
        
        elements.addItemBtn.addEventListener('click', () => {
            const item = elements.newItem.value.trim();
            if (item) showCategoryModal(item);
        });
        
        elements.searchInput.addEventListener('input', filterCategories);
        elements.copyCodeBtn.addEventListener('click', copyCode);
        elements.addCustomCategory.addEventListener('click', addCustomCategory);
        elements.customCategory.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') addCustomCategory();
        });
        elements.confirmAddBtn.addEventListener('click', confirmAddItem);
        elements.cancelAddBtn.addEventListener('click', () => {
            elements.categoryModal.classList.add('hidden');
            elements.newItem.value = '';
        });

        // Initialize
        showView('home');
    </script>
</body>
</html>

