<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Joc de Desenat cu Leul</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap');

        :root {
            --primary: #FF9F43;
            --secondary: #54a0ff;
            --accent: #ff6b6b;
            --success: #1dd1a1;
            --bg: #feca57;
            --dark: #576574;
        }

        * {
            box-sizing: border-box;
            user-select: none;
            -webkit-user-select: none;
            touch-action: none;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Fredoka One', cursive;
            background-color: var(--bg);
            background-image: radial-gradient(#ff9f43 15%, transparent 16%), radial-gradient(#ff9f43 15%, transparent 16%);
            background-size: 60px 60px;
            background-position: 0 0, 30px 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
        }

        .game-container {
            width: 100%;
            max-width: 600px;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            position: relative;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            padding: 10px 20px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 8px 0 rgba(0,0,0,0.1);
            margin-bottom: 10px;
            border: 4px solid var(--dark);
            z-index: 10;
        }

        .star-count {
            font-size: 1.5rem;
            color: var(--accent);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* Target Area with Ghost Overlay */
        .target-area {
            background: white;
            width: 140px;
            height: 140px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 8px 0 rgba(0,0,0,0.1);
            border: 6px solid var(--secondary);
            position: relative;
            z-index: 2;
            margin-bottom: -20px;
            transition: transform 0.3s;
        }

        .target-char {
            font-size: 5rem;
            color: var(--dark);
            line-height: 1;
            z-index: 2;
        }

        /* Canvas Area */
        .canvas-wrapper {
            position: relative;
            width: 90vw;
            max-width: 400px;
            aspect-ratio: 1 / 1;
            background: white;
            border-radius: 30px;
            box-shadow: 0 10px 0 rgba(0,0,0,0.1);
            border: 6px solid var(--dark);
            overflow: hidden;
            z-index: 1;
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
            cursor: crosshair;
        }

        /* Ghost Overlay on Canvas */
        .ghost-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 5;
        }

        .ghost-overlay.visible {
            opacity: 0.3;
        }

        .ghost-char {
            font-size: 15rem;
            font-weight: bold;
            color: var(--secondary);
            border: 4px dashed var(--secondary);
            border-radius: 20px;
            padding: 10px;
            transform: rotate(-10deg);
        }

        .controls {
            width: 100%;
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
            z-index: 10;
        }

        button {
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-family: inherit;
            font-weight: bold;
            font-size: 1.2rem;
            cursor: pointer;
            transition: transform 0.1s;
            box-shadow: 0 6px 0 rgba(0,0,0,0.2);
            text-transform: uppercase;
            letter-spacing: 1px;
            color: white;
        }

        button:active {
            transform: translateY(6px);
            box-shadow: none;
        }

        .btn-clear {
            background-color: var(--accent);
            font-size: 1rem;
            padding: 15px 20px;
        }

        .btn-check {
            background-color: var(--success);
            flex-grow: 1;
            max-width: 200px;
            font-size: 1.5rem;
        }

        /* Feedback Overlay */
        .feedback-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            border-radius: 20px;
        }

        .feedback-overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        .feedback-img {
            width: 150px;
            height: 150px;
            object-fit: contain;
            margin-bottom: 10px;
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .feedback-text {
            font-size: 2rem;
            margin-bottom: 20px;
            text-align: center;
            color: var(--dark);
            padding: 0 20px;
        }

        .btn-next {
            background-color: var(--secondary);
            font-size: 1.5rem;
            padding: 15px 40px;
        }

        .btn-try-again {
            background-color: var(--accent);
            font-size: 1.5rem;
            padding: 15px 40px;
        }

        @keyframes popIn {
            0% { transform: scale(0) rotate(-180deg); }
            100% { transform: scale(1) rotate(0deg); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px) rotate(-5deg); }
            75% { transform: translateX(10px) rotate(5deg); }
        }

        .shake {
            animation: shake 0.4s ease-in-out;
        }

        #confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 200;
        }

        .color-picker {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            background: white;
            padding: 10px;
            border-radius: 50px;
            border: 4px solid var(--dark);
            box-shadow: 0 4px 0 rgba(0,0,0,0.1);
            z-index: 10;
        }

        .color-option {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 2px solid white;
            cursor: pointer;
            transition: transform 0.2s;
            box-shadow: 0 2px 0 rgba(0,0,0,0.2);
        }

        .color-option.active {
            transform: scale(1.3);
            border-color: var(--dark);
        }

    </style>
</head>
<body>

    <canvas id="confetti-canvas"></canvas>

    <div class="game-container">
        <header>
            <div class="star-count">‚≠ê <span id="score">0</span></div>
            <div style="font-size: 1.2rem; color: var(--dark);">DeseneazƒÉ!</div>
        </header>

        <div class="target-area">
            <div class="target-char" id="target-display">A</div>
        </div>

        <div class="canvas-wrapper" id="canvas-container">
            <canvas id="drawing-board"></canvas>
            
            <!-- Ghost Overlay for Guidance -->
            <div class="ghost-overlay" id="ghost-overlay">
                <div class="ghost-char" id="ghost-char">A</div>
            </div>

            <!-- Feedback Overlay -->
            <div class="feedback-overlay" id="feedback">
                <img src="" alt="icon" class="feedback-img" id="feedback-img">
                <div class="feedback-text" id="feedback-msg">Bravo!</div>
                <button class="btn-next" id="btn-next" onclick="nextLevel()">ContinuƒÉ ‚ûú</button>
                <button class="btn-try-again" id="btn-try" onclick="closeFeedback()" style="display:none;">√éncearcƒÉ din nou</button>
            </div>
        </div>

        <div class="color-picker" id="color-picker">
            <!-- Colors generated by JS -->
        </div>

        <div class="controls">
            <button class="btn-clear" onclick="clearCanvas()">üóëÔ∏è »òterge</button>
            <button class="btn-check" onclick="checkDrawing()">VerificƒÉ!</button>
        </div>
    </div>

    <script>
        const state = {
            score: 0,
            currentChar: '',
            isDrawing: false,
            lastX: 0,
            lastY: 0,
            brushColor: '#292F36',
            brushSize: 20
        };

        const canvas = document.getElementById('drawing-board');
        const ctx = canvas.getContext('2d');
        const container = document.getElementById('canvas-container');
        const targetDisplay = document.getElementById('target-display');
        const scoreEl = document.getElementById('score');
        const feedbackOverlay = document.getElementById('feedback');
        const feedbackImg = document.getElementById('feedback-img');
        const feedbackMsg = document.getElementById('feedback-msg');
        const colorPicker = document.getElementById('color-picker');
        const ghostOverlay = document.getElementById('ghost-overlay');
        const ghostChar = document.getElementById('ghost-char');
        const btnNext = document.getElementById('btn-next');
        const btnTry = document.getElementById('btn-try');

        // Assets from generation
        const assets = {
            success: "https://image.qwenlm.ai/public_source/8d557df8-9236-441c-a4b8-270f826bf109/1c27097e3-0db9-44a1-833a-860692b00c94.png",
            retry: "https://image.qwenlm.ai/public_source/8d557df8-9236-441c-a4b8-270f826bf109/13431b32a-d4a0-47fb-ab19-169002ae66b1.png"
        };

        const colors = ['#292F36', '#ff6b6b', '#54a0ff', '#1dd1a1', '#feca57', '#5f27cd'];
        const charSets = [
            ['O', 'I', 'L', 'T'],
            ['A', 'V', 'H', 'X'],
            ['1', '7', '4'],
            ['C', 'U', 'S'],
            ['D', 'P', 'B'],
            ['2', '3', '5']
        ];

        function init() {
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            setupColors();
            
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);

            canvas.addEventListener('touchstart', handleTouchStart, { passive: false });
            canvas.addEventListener('touchmove', handleTouchMove, { passive: false });
            canvas.addEventListener('touchend', stopDrawing);

            pickNewCharacter();
        }

        function setupColors() {
            colors.forEach((color, index) => {
                const dot = document.createElement('div');
                dot.className = `color-option ${index === 0 ? 'active' : ''}`;
                dot.style.backgroundColor = color;
                dot.onclick = () => {
                    state.brushColor = color;
                    state.brushSize = color === '#292F36' ? 20 : 25;
                    document.querySelectorAll('.color-option').forEach(el => el.classList.remove('active'));
                    dot.classList.add('active');
                };
                colorPicker.appendChild(dot);
            });
        }

        function resizeCanvas() {
            const rect = container.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = rect.height;
            
            ctx.lineJoin = 'round';
            ctx.lineCap = 'round';
            ctx.lineWidth = state.brushSize;
            ctx.strokeStyle = state.brushColor;
        }

        function pickNewCharacter() {
            const setIndex = Math.floor(Math.random() * charSets.length);
            const set = charSets[setIndex];
            state.currentChar = set[Math.floor(Math.random() * set.length)];
            
            targetDisplay.textContent = state.currentChar;
            ghostChar.textContent = state.currentChar;
            
            targetDisplay.style.transform = 'scale(0)';
            setTimeout(() => {
                targetDisplay.style.transition = 'transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
                targetDisplay.style.transform = 'scale(1)';
            }, 50);
        }

        function getPos(e) {
            const rect = canvas.getBoundingClientRect();
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            return {
                x: clientX - rect.left,
                y: clientY - rect.top
            };
        }

        function startDrawing(e) {
            state.isDrawing = true;
            const pos = getPos(e);
            state.lastX = pos.x;
            state.lastY = pos.y;
            
            ctx.beginPath();
            ctx.arc(state.lastX, state.lastY, ctx.lineWidth / 2, 0, Math.PI * 2);
            ctx.fillStyle = state.brushColor;
            ctx.fill();
        }

        function draw(e) {
            if (!state.isDrawing) return;
            const pos = getPos(e);
            ctx.beginPath();
            ctx.moveTo(state.lastX, state.lastY);
            ctx.lineTo(pos.x, pos.y);
            ctx.stroke();
            state.lastX = pos.x;
            state.lastY = pos.y;
        }

        function stopDrawing() {
            state.isDrawing = false;
            ctx.beginPath();
        }

        function handleTouchStart(e) {
            e.preventDefault();
            startDrawing(e);
        }

        function handleTouchMove(e) {
            e.preventDefault();
            draw(e);
        }

        function clearCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ghostOverlay.classList.remove('visible');
        }

        function checkDrawing() {
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;
            let coloredPixels = 0;
            let blackPixels = 0;
            
            for (let i = 0; i < data.length; i += 4) {
                const alpha = data[i + 3];
                if (alpha > 0) {
                    coloredPixels++;
                    if (data[i] < 50 && data[i+1] < 50 && data[i+2] < 50) {
                        blackPixels++;
                    }
                }
            }

            const totalPixels = canvas.width * canvas.height;
            const fillPercentage = coloredPixels / totalPixels;
            const blackRatio = blackPixels / coloredPixels;

            if (fillPercentage < 0.02) {
                showFeedback(false, "E prea gol!", true);
                return;
            }

            if (blackRatio > 0.8) {
                showFeedback(false, "Folose»ôte culori!", true);
                return;
            }

            handleSuccess();
        }

        function handleSuccess() {
            state.score += 1;
            scoreEl.textContent = state.score;
            showFeedback(true, "SUPER! E»ôti un artist!", false);
            fireConfetti();
        }

        function showFeedback(success, text, showGhostHint) {
            feedbackOverlay.classList.add('active');
            
            if (success) {
                feedbackImg.src = assets.success;
                feedbackMsg.textContent = text;
                feedbackMsg.style.color = "var(--success)";
                btnNext.style.display = 'block';
                btnTry.style.display = 'none';
                ghostOverlay.classList.remove('visible');
            } else {
                feedbackImg.src = assets.retry;
                feedbackMsg.textContent = text;
                feedbackMsg.style.color = "var(--accent)";
                btnNext.style.display = 'none';
                btnTry.style.display = 'block';
                
                // Show the ghost outline hint if they failed
                if (showGhostHint) {
                    ghostOverlay.classList.add('visible');
                }
                
                container.classList.add('shake');
                setTimeout(() => container.classList.remove('shake'), 500);
            }
        }

        function closeFeedback() {
            feedbackOverlay.classList.remove('active');
            // Keep the ghost overlay visible so they can trace it
        }

        function nextLevel() {
            feedbackOverlay.classList.remove('active');
            clearCanvas();
            pickNewCharacter();
        }

        // Confetti
        const confettiCanvas = document.getElementById('confetti-canvas');
        const cCtx = confettiCanvas.getContext('2d');
        let particles = [];

        function resizeConfetti() {
            confettiCanvas.width = window.innerWidth;
            confettiCanvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resizeConfetti);
        resizeConfetti();

        function fireConfetti() {
            particles = [];
            const colors = ['#FF9F43', '#54a0ff', '#ff6b6b', '#1dd1a1', '#feca57'];
            for (let i = 0; i < 150; i++) {
                particles.push({
                    x: window.innerWidth / 2,
                    y: window.innerHeight / 2,
                    vx: (Math.random() - 0.5) * 25,
                    vy: (Math.random() - 0.5) * 25 - 5,
                    size: Math.random() * 15 + 5,
                    color: colors[Math.floor(Math.random() * colors.length)],
                    life: 100,
                    rotation: Math.random() * 360,
                    rotationSpeed: (Math.random() - 0.5) * 10
                });
            }
            animateConfetti();
        }

        function animateConfetti() {
            if (particles.length === 0) {
                cCtx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
                return;
            }
            cCtx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
            for (let i = 0; i < particles.length; i++) {
                let p = particles[i];
                p.x += p.vx;
                p.y += p.vy;
                p.vy += 0.8;
                p.life--;
                p.size *= 0.96;
                p.rotation += p.rotationSpeed;
                cCtx.save();
                cCtx.translate(p.x, p.y);
                cCtx.rotate(p.rotation * Math.PI / 180);
                cCtx.fillStyle = p.color;
                cCtx.fillRect(-p.size/2, -p.size/2, p.size, p.size);
                cCtx.restore();
            }
            particles = particles.filter(p => p.life > 0);
            requestAnimationFrame(animateConfetti);
        }

        init();
    </script>
</body>
</html>


