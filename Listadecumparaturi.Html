<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Lista de CumpÄƒrÄƒturi</title>
  <style>
    :root {
      --primary: #4a6fa5;
      --secondary: #6b8cbc;
      --accent: #ff6b6b;
      --background: #f8f9fa;
      --card-bg: #ffffff;
      --text: #333333;
      --success: #28a745;
    }
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      background-color: var(--background);
      color: var(--text);
      line-height: 1.6;
      padding: 16px;
    }
    .view {
      display: none;
    }
    .view.active {
      display: block;
    }
    .header {
      text-align: center;
      margin-bottom: 24px;
    }
    .header h1 {
      font-size: 1.8rem;
      margin-bottom: 8px;
      color: var(--primary);
    }
    .header p {
      color: #666;
      font-size: 0.95rem;
    }
    .btn {
      background-color: var(--primary);
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
      transition: background-color 0.2s;
      width: 100%;
      margin: 8px 0;
    }
    .btn:hover {
      background-color: var(--secondary);
    }
    .btn-accent {
      background-color: var(--accent);
    }
    .btn-accent:hover {
      background-color: #ff5252;
    }
    .btn-save {
      background-color: var(--success);
    }
    .btn-save:hover {
      background-color: #218838;
    }
    .input-group {
      margin: 16px 0;
    }
    label {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
    }
    input {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 1rem;
    }
    .error {
      color: #d32f2f;
      font-size: 0.875rem;
      margin-top: 6px;
      min-height: 1.2em;
    }
    .category-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px;
      background-color: var(--primary);
      color: white;
      border-radius: 8px 8px 0 0;
      cursor: pointer;
    }
    .items-container {
      border: 1px solid #ddd;
      border-top: none;
      border-radius: 0 0 8px 8px;
      max-height: 200px;
      overflow-y: auto;
    }
    .item {
      display: flex;
      align-items: center;
      padding: 10px 12px;
      border-bottom: 1px solid #eee;
    }
    .item:last-child {
      border-bottom: none;
    }
    .item.completed .item-text {
      text-decoration: line-through;
      color: #888;
    }
    .item-text {
      flex: 1;
      margin: 0 12px;
    }
    .item-actions button {
      background: none;
      border: none;
      color: #666;
      cursor: pointer;
      font-size: 1.2rem;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .item-actions button:hover {
      color: var(--accent);
    }
    .back-btn {
      background: none;
      border: none;
      color: var(--primary);
      font-size: 1rem;
      margin-bottom: 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .back-btn:hover {
      text-decoration: underline;
    }
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .modal-content {
      background: white;
      padding: 24px;
      border-radius: 12px;
      width: 90%;
      max-width: 400px;
    }
    .hidden {
      display: none !important;
    }
    .modal-visible {
      display: flex !important;
    }
  </style>
</head>
<body>
  <!-- VIEWS -->
  <div id="homeView" class="view active">
    <div class="header">
      <h1>Lista de CumpÄƒrÄƒturi</h1>
      <p>PartajeazÄƒ o listÄƒ cu alÈ›ii folosind un cod unic!</p>
    </div>
    <button id="createBtn" class="btn">CreeazÄƒ o listÄƒ nouÄƒ</button>
    <button id="joinBtn" class="btn">IntrÄƒ Ã®ntr-o listÄƒ existentÄƒ</button>
  </div>

  <div id="createView" class="view">
    <button class="back-btn" id="backFromCreate">&larr; Ãnapoi</button>
    <div class="header">
      <h1>CreeazÄƒ ListÄƒ</h1>
    </div>
    <div class="input-group">
      <label for="listName">Numele listei</label>
      <input type="text" id="listName" placeholder="Ex: CumpÄƒrÄƒturi supermarket" />
    </div>
    <div class="error" id="createError"></div>
    <button id="confirmCreate" class="btn">CreeazÄƒ ListÄƒ</button>
  </div>

  <div id="joinView" class="view">
    <button class="back-btn" id="backFromJoin">&larr; Ãnapoi</button>
    <div class="header">
      <h1>IntrÄƒ Ã®n ListÄƒ</h1>
      <p>Introdu codul primit de la creator</p>
    </div>
    <div class="input-group">
      <label for="joinCode">Cod (6 cifre)</label>
      <input type="text" id="joinCode" placeholder="Ex: 123456" maxlength="6" />
    </div>
    <div class="error" id="joinError"></div>
    <button id="confirmJoin" class="btn">IntrÄƒ</button>
  </div>

  <div id="listView" class="view">
    <button class="back-btn" id="backFromList">&larr; IeÈ™i din listÄƒ</button>
    <div class="header">
      <h1 id="listTitle">Lista ta</h1>
      <p id="listCodeDisplay" style="font-size: 0.9rem; color: #666;"></p>
    </div>
    
    <div id="categoriesContainer"></div>

    <button id="addItemBtn" class="btn">+ AdaugÄƒ articol</button>
    <button id="saveListBtn" class="btn btn-save">ğŸ’¾ SalveazÄƒ Lista</button>
  </div>

  <!-- MODAL: Selectare categorie pentru adÄƒugare -->
  <div id="addModal" class="modal">
    <div class="modal-content">
      <h2>SelecteazÄƒ categoria</h2>
      <div id="addCategoryList" style="margin: 16px 0;"></div>
      <input type="text" id="newItemInput" placeholder="Ce vrei sÄƒ adaugi?" style="width:100%; padding:12px; margin:16px 0; border:1px solid #ddd; border-radius:8px; font-size:1rem;" />
      <button id="confirmAddItemBtn" class="btn">AdaugÄƒ articol</button>
      <button id="cancelAddItemBtn" class="btn btn-accent" style="background:#ccc; color:black;">RenunÈ›Äƒ</button>
    </div>
  </div>

  <!-- MODAL: Selectare categorie destinaÈ›ie (mutare) -->
  <div id="moveModal" class="modal">
    <div class="modal-content">
      <h2>MutÄƒ Ã®n categoria</h2>
      <div id="moveCategoryList" style="margin: 16px 0;"></div>
      <input type="text" id="newCategoryInput" placeholder="Nume categorie nouÄƒ" style="width:100%; padding:12px; margin:8px 0; border:1px solid #ddd; border-radius:6px;" />
      <button id="createNewCategoryBtn" class="btn">CreeazÄƒ categorie nouÄƒ</button>
      <button id="cancelMoveBtn" class="btn btn-accent" style="background:#ccc; color:black; margin-top:8px;">RenunÈ›Äƒ</button>
    </div>
  </div>

  <script>
    // -------------------------------
    // CATEGORIES
    // -------------------------------
    const defaultCategories = [
      'Fructe',
      'Legume', 
      'Lactate', 
      'PÃ¢ine', 
      'Cereale', 
      'Carne', 
      'PeÈ™te', 
      'BÄƒuturi', 
      'Dulciuri', 
      'Altele'
    ];

    // -------------------------------
    // UI Elements
    // -------------------------------
    const elements = {
      homeView: document.getElementById('homeView'),
      createView: document.getElementById('createView'),
      joinView: document.getElementById('joinView'),
      listView: document.getElementById('listView'),
      listName: document.getElementById('listName'),
      joinCode: document.getElementById('joinCode'),
      createError: document.getElementById('createError'),
      joinError: document.getElementById('joinError'),
      listTitle: document.getElementById('listTitle'),
      listCodeDisplay: document.getElementById('listCodeDisplay'),
      categoriesContainer: document.getElementById('categoriesContainer'),
      addItemBtn: document.getElementById('addItemBtn'),
      saveListBtn: document.getElementById('saveListBtn'),
      // Modals
      addModal: document.getElementById('addModal'),
      moveModal: document.getElementById('moveModal'),
      addCategoryList: document.getElementById('addCategoryList'),
      moveCategoryList: document.getElementById('moveCategoryList'),
      newItemInput: document.getElementById('newItemInput'),
      newCategoryInput: document.getElementById('newCategoryInput'),
      // Back buttons
      backFromCreate: document.getElementById('backFromCreate'),
      backFromJoin: document.getElementById('backFromJoin'),
      backFromList: document.getElementById('backFromList'),
      // Confirm buttons
      confirmCreate: document.getElementById('confirmCreate'),
      confirmJoin: document.getElementById('confirmJoin'),
      confirmAddItemBtn: document.getElementById('confirmAddItemBtn'),
      cancelAddItemBtn: document.getElementById('cancelAddItemBtn'),
      createNewCategoryBtn: document.getElementById('createNewCategoryBtn'),
      cancelMoveBtn: document.getElementById('cancelMoveBtn')
    };

    let currentList = null;
    let expandedCategories = {};
    let selectedItemCategory = null;
    let itemToMoveId = null;
    let currentListId = null;

    // -------------------------------
    // UTILS
    // -------------------------------
    function showView(viewId) {
      document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
      document.getElementById(viewId).classList.add('active');
    }

    function showError(element, message) {
      element.textContent = message;
      setTimeout(() => element.textContent = '', 3000);
    }

    function generateCode() {
      return Math.floor(100000 + Math.random() * 900000).toString();
    }

    // LocalStorage functions
    function saveListsToStorage(lists) {
      localStorage.setItem('shoppingLists', JSON.stringify(lists));
    }

    function loadListsFromStorage() {
      const saved = localStorage.getItem('shoppingLists');
      return saved ? JSON.parse(saved) : {};
    }

    // -------------------------------
    // LIST MANAGEMENT
    // -------------------------------
    function renderList() {
      if (!currentList) return;
      
      elements.listTitle.textContent = currentList.name;
      elements.listCodeDisplay.textContent = `Cod listÄƒ: ${currentList.code}`;
      elements.categoriesContainer.innerHTML = '';

      currentList.categories.forEach(category => {
        const isExpanded = expandedCategories[category.name] ?? true;
        const categoryEl = document.createElement('div');
        categoryEl.className = 'category';
        categoryEl.innerHTML = `
          <div class="category-header" data-category="${category.name}">
            <span>${category.name}</span>
            <span>${category.items.filter(i => !i.completed).length} rÄƒmase</span>
          </div>
          <div class="items-container ${isExpanded ? '' : 'hidden'}" data-category="${category.name}">
            ${category.items.map(item => `
              <div class="item ${item.completed ? 'completed' : ''}" data-item-id="${item.id}">
                <input type="checkbox" ${item.completed ? 'checked' : ''} data-item-id="${item.id}" data-category-id="${category.id}" />
                <span class="item-text">${item.text}</span>
                <div class="item-actions">
                  <button class="move-btn" data-item-id="${item.id}" title="MutÄƒ">ğŸ”ƒ</button>
                  <button class="delete-btn" data-item-id="${item.id}" data-category-id="${category.id}" title="È˜terge">ğŸ—‘ï¸</button>
                </div>
              </div>
            `).join('')}
          </div>
        `;
        elements.categoriesContainer.appendChild(categoryEl);
      });

      // Event listeners pentru checkbox, move, delete
      document.querySelectorAll('.category-header').forEach(header => {
        header.addEventListener('click', () => {
          const catName = header.dataset.category;
          expandedCategories[catName] = !expandedCategories[catName];
          const container = document.querySelector(`.items-container[data-category="${catName}"]`);
          container.classList.toggle('hidden');
        });
      });

      document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
        cb.addEventListener('change', (e) => {
          const itemId = e.target.dataset.itemId;
          const categoryId = e.target.dataset.categoryId;
          const completed = e.target.checked;
          
          // Update currentList
          currentList.categories = currentList.categories.map(cat => {
            if (cat.id === categoryId) {
              cat.items = cat.items.map(item => {
                if (item.id === itemId) {
                  item.completed = completed;
                }
                return item;
              });
            }
            return cat;
          });
          
          renderList();
        });
      });

      document.querySelectorAll('.delete-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const itemId = btn.dataset.itemId;
          const categoryId = btn.dataset.categoryId;
          
          currentList.categories = currentList.categories.map(cat => {
            if (cat.id === categoryId) {
              cat.items = cat.items.filter(item => item.id !== itemId);
            }
            return cat;
          });
          
          renderList();
        });
      });

      document.querySelectorAll('.move-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          itemToMoveId = btn.dataset.itemId;
          openMoveModal();
        });
      });
    }

    function createList() {
      const name = elements.listName.value.trim();
      if (!name) {
        showError(elements.createError, 'Introdu un nume pentru listÄƒ');
        return;
      }

      const code = generateCode();
      currentListId = Date.now().toString();
      
      // CreeazÄƒ categoriile
      const categories = defaultCategories.map((name, index) => ({
        id: `${currentListId}-${index}`,
        name: name,
        items: []
      }));

      currentList = {
        id: currentListId,
        name: name,
        code: code,
        categories: categories
      };

      // SalveazÄƒ Ã®n localStorage
      const lists = loadListsFromStorage();
      lists[currentListId] = currentList;
      saveListsToStorage(lists);

      expandedCategories = {};
      renderList();
      showView('listView');
      elements.listName.value = '';
    }

    function joinList() {
      const code = elements.joinCode.value.trim();
      if (!code) {
        showError(elements.joinError, 'Introdu un cod');
        return;
      }

      const lists = loadListsFromStorage();
      const foundList = Object.values(lists).find(list => list.code === code);
      
      if (!foundList) {
        showError(elements.joinError, 'Cod invalid. ÃncearcÄƒ din nou.');
        return;
      }

      currentList = foundList;
      currentListId = foundList.id;
      expandedCategories = {};
      renderList();
      showView('listView');
      elements.joinCode.value = '';
    }

    function saveCurrentList() {
      if (!currentList || !currentListId) return;
      
      const lists = loadListsFromStorage();
      lists[currentListId] = currentList;
      saveListsToStorage(lists);
      
      // Show success feedback
      const originalName = currentList.name;
      elements.listTitle.textContent = `${originalName} (SalvatÄƒ!)`;
      setTimeout(() => {
        elements.listTitle.textContent = originalName;
      }, 2000);
    }

    function openAddModal() {
      elements.addCategoryList.innerHTML = '';
      currentList.categories.forEach(cat => {
        const btn = document.createElement('button');
        btn.className = 'btn';
        btn.textContent = cat.name;
        btn.addEventListener('click', () => {
          selectedItemCategory = cat.id;
          elements.newItemInput.focus();
        });
        elements.addCategoryList.appendChild(btn);
      });
      elements.newItemInput.value = '';
      elements.addModal.classList.add('modal-visible');
    }

    function confirmAddItem() {
      const text = elements.newItemInput.value.trim();
      if (!text || !selectedItemCategory) return;

      // GÄƒseÈ™te categoria selectatÄƒ
      currentList.categories = currentList.categories.map(cat => {
        if (cat.id === selectedItemCategory) {
          cat.items.push({
            id: Date.now().toString(),
            text: text,
            completed: false
          });
        }
        return cat;
      });

      elements.addModal.classList.remove('modal-visible');
      elements.newItemInput.value = '';
      selectedItemCategory = null;
      renderList();
    }

    function openMoveModal() {
      elements.moveCategoryList.innerHTML = '';
      currentList.categories.forEach(cat => {
        const btn = document.createElement('button');
        btn.className = 'btn';
        btn.textContent = cat.name;
        btn.addEventListener('click', () => {
          // GÄƒseÈ™te categoria sursÄƒ È™i articolul
          let sourceCategory = null;
          let itemToMove = null;
          
          for (const category of currentList.categories) {
            const foundItem = category.items.find(item => item.id === itemToMoveId);
            if (foundItem) {
              sourceCategory = category;
              itemToMove = foundItem;
              break;
            }
          }

          if (!itemToMove) return;

          // EliminÄƒ din categoria sursÄƒ
          sourceCategory.items = sourceCategory.items.filter(item => item.id !== itemToMoveId);
          
          // AdaugÄƒ Ã®n categoria destinaÈ›ie
          const targetCategory = currentList.categories.find(cat2 => cat2.id === cat.id);
          if (targetCategory) {
            targetCategory.items.push(itemToMove);
          }

          elements.moveModal.classList.remove('modal-visible');
          renderList();
        });
        elements.moveCategoryList.appendChild(btn);
      });
      elements.newCategoryInput.value = '';
      elements.moveModal.classList.add('modal-visible');
    }

    function createNewCategory() {
      const categoryName = elements.newCategoryInput.value.trim();
      if (!categoryName || !itemToMoveId) return;

      // GÄƒseÈ™te categoria sursÄƒ È™i articolul
      let sourceCategory = null;
      let itemToMove = null;
      
      for (const category of currentList.categories) {
        const foundItem = category.items.find(item => item.id === itemToMoveId);
        if (foundItem) {
          sourceCategory = category;
          itemToMove = foundItem;
          break;
        }
      }

      if (!itemToMove) return;

      // EliminÄƒ din categoria sursÄƒ
      sourceCategory.items = sourceCategory.items.filter(item => item.id !== itemToMoveId);
      
      // CreeazÄƒ categorie nouÄƒ
      const newCategoryId = `${currentListId}-${Date.now()}`;
      currentList.categories.push({
        id: newCategoryId,
        name: categoryName,
        items: [itemToMove]
      });

      elements.moveModal.classList.remove('modal-visible');
      elements.newCategoryInput.value = '';
      renderList();
    }

    // -------------------------------
    // EVENT LISTENERS
    // -------------------------------
    elements.createBtn.addEventListener('click', () => showView('createView'));
    elements.joinBtn.addEventListener('click', () => showView('joinView'));

    elements.backFromCreate.addEventListener('click', () => showView('homeView'));
    elements.backFromJoin.addEventListener('click', () => showView('homeView'));
    elements.backFromList.addEventListener('click', () => {
      currentList = null;
      currentListId = null;
      showView('homeView');
    });

    elements.confirmCreate.addEventListener('click', createList);
    elements.confirmJoin.addEventListener('click', joinList);
    elements.saveListBtn.addEventListener('click', saveCurrentList);

    elements.addItemBtn.addEventListener('click', openAddModal);
    elements.confirmAddItemBtn.addEventListener('click', confirmAddItem);

    elements.cancelAddItemBtn.addEventListener('click', () => {
      elements.addModal.classList.remove('modal-visible');
      selectedItemCategory = null;
      elements.newItemInput.value = '';
    });

    elements.createNewCategoryBtn.addEventListener('click', createNewCategory);
    elements.cancelMoveBtn.addEventListener('click', () => {
      elements.moveModal.classList.remove('modal-visible');
      itemToMoveId = null;
      elements.newCategoryInput.value = '';
    });

    // Close modals on outside click
    window.addEventListener('click', (e) => {
      if (e.target === elements.addModal) {
        elements.addModal.classList.remove('modal-visible');
        selectedItemCategory = null;
        elements.newItemInput.value = '';
      }
      if (e.target === elements.moveModal) {
        elements.moveModal.classList.remove('modal-visible');
        itemToMoveId = null;
        elements.newCategoryInput.value = '';
      }
    });

    // Enter key support
    elements.newItemInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        confirmAddItem();
      }
    });

    elements.newCategoryInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        createNewCategory();
      }
    });
  </script>
</body>
</html>

