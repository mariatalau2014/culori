<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Super Jocuri Educa»õionale</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Comic+Sans+MS&display=swap" rel="stylesheet">
<style>
:root {
--boy-bg: #E3F2FD; --boy-primary: #2196F3; --boy-secondary: #4FC3F7; --boy-accent: #4CAF50;
--girl-bg: #FCE4EC; --girl-primary: #EC407A; --girl-secondary: #F48FB1; --girl-accent: #AB47BC;
--pro-bg: #263238; --pro-card: #37474F; --pro-text: #ECEFF1; --pro-accent: #00E5FF;
--text-color: #455A64; --card-bg: #FFFFFF; --success: #66BB6A; --error: #EF5350;
--timer-warning: #FF9800; --timer-danger: #F44336; --gold: #FFD700; --silver: #C0C0C0; --bronze: #CD7F32;
}
* { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Comic Sans MS', 'Chalkboard SE', sans-serif; user-select: none; }
body { background-color: var(--girl-bg); background-image: radial-gradient(#F8BBD0 15%, transparent 16%), radial-gradient(#F8BBD0 15%, transparent 16%); background-size: 60px 60px; background-position: 0 0, 30px 30px; color: var(--text-color); min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; overflow-x: hidden; transition: background 0.5s ease; }
body.boy-theme { background-color: var(--boy-bg); background-image: radial-gradient(#BBDEFB 15%, transparent 16%), radial-gradient(#BBDEFB 15%, transparent 16%); }
body.pro-theme { background-color: var(--pro-bg); background-image: radial-gradient(#455A64 15%, transparent 16%); color: var(--pro-text); }
.background-shapes { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; overflow: hidden; pointer-events: none; }
.shape { position: absolute; opacity: 0.4; animation: float 15s infinite linear; }
@keyframes float { 0% { transform: translateY(100vh) rotate(0deg); } 100% { transform: translateY(-100px) rotate(360deg); } }
.container { width: 90%; max-width: 900px; text-align: center; padding: 2rem; }
h1 { font-size: 3rem; margin-bottom: 2rem; color: var(--girl-primary); text-shadow: 2px 2px 0px #FFF; transition: color 0.5s; font-family: 'Fredoka One', cursive; }
body.boy-theme h1 { color: var(--boy-primary); text-shadow: none; }
body.pro-theme h1 { color: var(--pro-accent); text-shadow: 0 0 10px rgba(0, 229, 255, 0.5); }
.menu-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 2rem; width: 100%; margin-bottom: 2rem; }
.big-card { background: var(--card-bg); border-radius: 30px; padding: 2rem; cursor: pointer; transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); box-shadow: 0 10px 0 rgba(0,0,0,0.1); border: 5px solid #FFF; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 250px; position: relative; }
body.pro-theme .big-card { background: var(--pro-card); color: var(--pro-text); border: 3px solid var(--pro-accent); }
.big-card:hover { transform: translateY(-10px) scale(1.02); box-shadow: 0 20px 0 rgba(0,0,0,0.1); }
.big-card-icon { font-size: 5rem; margin-bottom: 1rem; filter: drop-shadow(0 5px 5px rgba(0,0,0,0.2)); }
.big-card-title { font-weight: 900; font-size: 1.8rem; margin-bottom: 0.5rem; font-family: 'Fredoka One', cursive; }
body.pro-theme .big-card-title { color: var(--pro-text); }
body:not(.pro-theme) .big-card-title { color: var(--text-color); }
.big-card-desc { font-size: 1.1rem; line-height: 1.4; font-weight: 600; opacity: 0.8; }

/* Stiluri specifice pentru sub-meniuri matematice */
.sub-menu-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1.5rem; width: 100%; }
.card { background: var(--card-bg); border-radius: 25px; padding: 1.5rem; cursor: pointer; transition: all 0.3s; box-shadow: 0 8px 0 rgba(0,0,0,0.1); border: 4px solid #FFF; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 180px; }
body.pro-theme .card { background: var(--pro-card); color: var(--pro-text); border: 2px solid var(--pro-accent); }
.card:hover { transform: translateY(-8px); box-shadow: 0 15px 0 rgba(0,0,0,0.1); }
.card.kg-card { border-bottom: 6px solid var(--boy-accent); }
.card.easy-card { border-bottom: 6px solid var(--girl-secondary); }
.card.pro-card { border-bottom: 6px solid var(--pro-accent); }
.card-icon { font-size: 3rem; margin-bottom: 0.5rem; }
.card-title { font-weight: 900; font-size: 1.3rem; margin-bottom: 0.5rem; }
.card-desc { font-size: 0.9rem; line-height: 1.4; font-weight: 600; opacity: 0.8; }

.game-area { display: none; background: var(--card-bg); border-radius: 30px; padding: 2.5rem; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 100%; max-width: 600px; animation: popIn 0.5s; border: 5px solid var(--girl-secondary); transition: border-color 0.5s, background 0.5s, color 0.5s; }
body.boy-theme .game-area { border-color: var(--boy-secondary); }
body.pro-theme .game-area { border-color: var(--pro-accent); background: var(--pro-card); color: var(--pro-text); }
@keyframes popIn { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1); } }
.stats-bar { display: flex; justify-content: space-between; margin-bottom: 1rem; font-size: 1.3rem; font-weight: 800; color: var(--girl-primary); background: #F8BBD0; padding: 10px 20px; border-radius: 50px; transition: all 0.5s; }
body.boy-theme .stats-bar { color: var(--boy-primary); background: #BBDEFB; }
body.pro-theme .stats-bar { color: var(--pro-bg); background: var(--pro-accent); }
.timer-container { width: 100%; height: 15px; background-color: #eee; border-radius: 10px; margin-bottom: 1.5rem; overflow: hidden; border: 2px solid #ddd; }
.timer-bar { height: 100%; width: 100%; background-color: var(--success); transition: width 1s linear, background-color 0.5s; }
.visual-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; margin: 20px 0; min-height: 80px; align-items: center; }
.ball { width: 45px; height: 45px; border-radius: 50%; box-shadow: inset -3px -3px 10px rgba(0,0,0,0.1), 3px 3px 5px rgba(0,0,0,0.15); animation: bounce 2s infinite ease-in-out; border: 2px solid rgba(255,255,255,0.3); }
@keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-12px); } }
.sequence-display { font-size: 3.5rem; font-weight: 900; letter-spacing: 5px; margin: 20px 0; }
body:not(.pro-theme) .sequence-display { color: var(--text-color); }
body.pro-theme .sequence-display { color: var(--pro-text); }
.missing-number { color: var(--girl-primary); border-bottom: 4px dashed var(--girl-primary); padding: 0 10px; }
body.boy-theme .missing-number { color: var(--boy-primary); border-bottom-color: var(--boy-primary); }
body.pro-theme .missing-number { color: var(--pro-accent); border-bottom-color: var(--pro-accent); }
.problem-display { font-size: 4rem; font-weight: 900; margin: 1rem 0; color: var(--girl-primary); transition: color 0.5s; }
body.boy-theme .problem-display { color: var(--boy-primary); }
body.pro-theme .problem-display { color: var(--pro-accent); }
.input-group { display: flex; gap: 1rem; justify-content: center; margin-bottom: 1.5rem; }
input[type="number"], input[type="text"] { width: 130px; padding: 0.8rem; font-size: 2.2rem; text-align: center; border: 3px solid var(--girl-secondary); border-radius: 20px; outline: none; transition: all 0.3s; font-family: inherit; background: #FFF; }
body.pro-theme input[type="number"], body.pro-theme input[type="text"] { border-color: var(--pro-accent); background: #263238; color: white; }
body:not(.pro-theme) input[type="number"] { color: var(--text-color); }
input[type="number"]:focus, input[type="text"]:focus { border-color: var(--girl-primary); transform: scale(1.05); }
body.boy-theme input[type="number"]:focus { border-color: var(--boy-primary); }
body.pro-theme input[type="number"]:focus { border-color: var(--pro-accent); }
input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
input[type=number] { -moz-appearance: textfield; }
.choices-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-top: 2rem; }
.choice-btn { background: white; border: 4px solid var(--boy-secondary); border-radius: 20px; padding: 1.5rem; font-size: 2rem; font-weight: 900; color: var(--boy-primary); cursor: pointer; transition: all 0.2s; box-shadow: 0 6px 0 #0277BD; font-family: inherit; }
.choice-btn:active { transform: translateY(6px); box-shadow: none; }
.choice-btn:hover { background: #E1F5FE; }
.btn { padding: 1rem 2rem; font-size: 1.3rem; border: none; border-radius: 50px; cursor: pointer; font-weight: 900; transition: all 0.2s; color: white; font-family: inherit; text-transform: uppercase; letter-spacing: 1px; box-shadow: 0 5px 0 rgba(0,0,0,0.1); }
.btn:active { transform: translateY(4px); box-shadow: none; }
.btn-primary { background-color: var(--girl-primary); box-shadow: 0 5px 0 #C2185B; transition: background 0.5s, box-shadow 0.5s; }
body.boy-theme .btn-primary { background-color: var(--boy-primary); box-shadow: 0 5px 0 #1565C0; }
body.pro-theme .btn-primary { background-color: var(--pro-accent); color: var(--pro-bg); box-shadow: 0 5px 0 #00B8D4; }
.btn-secondary { background-color: #B0BEC5; box-shadow: 0 5px 0 #78909C; margin-top: 1rem; font-size: 1rem; padding: 0.8rem 1.5rem; }
.feedback { height: 3rem; margin-top: 1rem; font-weight: 900; font-size: 1.3rem; line-height: 1.4; }
.feedback.correct { color: var(--success); }
.feedback.wrong { color: var(--error); }
.back-btn { position: absolute; top: 20px; left: 20px; background: white; border: none; padding: 10px 20px; border-radius: 50px; cursor: pointer; font-weight: 900; box-shadow: 0 4px 10px rgba(0,0,0,0.1); display: flex; align-items: center; gap: 8px; z-index: 10; font-family: inherit; color: var(--girl-primary); transition: all 0.5s; }
body.boy-theme .back-btn { color: var(--boy-primary); }
body.pro-theme .back-btn { color: var(--pro-bg); background: var(--pro-accent); }
.back-btn:hover { transform: scale(1.1); }
.award-container, .leaderboard-container { display: none; flex-direction: column; align-items: center; justify-content: center; animation: popIn 0.8s; background: white; padding: 2rem; border-radius: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); max-width: 500px; margin: 0 auto; }
.award-icon { font-size: 8rem; margin: 1rem 0; filter: drop-shadow(0 10px 10px rgba(0,0,0,0.2)); animation: float 3s infinite ease-in-out; }
.award-title { font-size: 3rem; font-weight: 900; margin-bottom: 1rem; text-transform: uppercase; }
.award-gold { color: var(--gold); text-shadow: 2px 2px 0 #B8860B; }
.award-silver { color: var(--silver); text-shadow: 2px 2px 0 #78909C; }
.award-bronze { color: var(--bronze); text-shadow: 2px 2px 0 #8D6E63; }
.award-mention { color: var(--boy-primary); text-shadow: 2px 2px 0 #1565C0; }
.award-try { color: var(--error); text-shadow: 2px 2px 0 #C62828; }
.final-score { font-size: 2rem; color: var(--text-color); margin-bottom: 1rem; font-weight: bold; }
.name-input-group { margin: 1.5rem 0; display: flex; flex-direction: column; gap: 10px; align-items: center; }
.name-input-group label { font-size: 1.2rem; font-weight: bold; color: var(--text-color); }
.name-input-group input { width: 100%; font-size: 1.5rem; padding: 0.5rem; }
.leaderboard-table { width: 100%; border-collapse: collapse; margin: 1rem 0; font-size: 1.1rem; }
.leaderboard-table th { background: var(--girl-primary); color: white; padding: 10px; border-radius: 10px 10px 0 0; }
body.pro-theme .leaderboard-table th { background: var(--pro-accent); color: var(--pro-bg); }
body.boy-theme .leaderboard-table th { background: var(--boy-primary); }
.leaderboard-table td { padding: 10px; border-bottom: 1px solid #eee; text-align: center; }
.leaderboard-table tr:nth-child(even) { background-color: #f9f9f9; }
.leaderboard-table tr:first-child td { font-weight: bold; color: var(--gold); }
.leaderboard-table tr:nth-child(2) td { font-weight: bold; color: var(--silver); }
.leaderboard-table tr:nth-child(3) td { font-weight: bold; color: var(--bronze); }

/* Stiluri pentru Jocul de SƒÉrituri */
#jumpGameContainer {
    display: none;
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background: #222;
    z-index: 200;
    touch-action: none;
}
#jumpCanvas { display: block; width: 100%; height: 100%; }
#jumpUI {
    position: absolute; top: 20px; left: 20px; color: white;
    font-size: 22px; font-weight: bold; text-shadow: 2px 2px 4px #000;
    z-index: 10; pointer-events: none; display: flex; flex-direction: column; gap: 10px;
}
#jumpMenu {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.9); display: flex; flex-direction: column;
    justify-content: center; align-items: center; color: white; z-index: 20;
}
#jumpWinScreen {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(46, 213, 115, 0.95); display: none;
    flex-direction: column; justify-content: center; align-items: center;
    color: white; z-index: 30; text-align: center;
}

@media (max-width: 600px) {
h1 { font-size: 2rem; }
.problem-display { font-size: 3rem; }
.menu-grid, .sub-menu-grid { grid-template-columns: 1fr; }
.card, .big-card { min-height: 160px; }
.choices-grid { grid-template-columns: 1fr; }
.award-icon { font-size: 6rem; }
.award-title { font-size: 2rem; }
}
</style>
</head>
<body>
<div class="background-shapes" id="bg-shapes"></div>

<!-- Meniu Principal -->
<div class="container" id="mainContainer">
    <h1>Super Jocuri</h1>
    <div class="menu-grid">
        <!-- Buton Joc Matematic -->
        <div class="big-card" onclick="openMathMenu()">
            <div class="big-card-icon">üßÆ</div>
            <div class="big-card-title">Joc Matematic</div>
            <div class="big-card-desc">Exerci»õii de adunare, scƒÉdere, √Ænmul»õire »ôi multe altele!</div>
        </div>
        <!-- Buton Joc SƒÉrituri -->
        <div class="big-card" onclick="openJumpGame()">
            <div class="big-card-icon">ü¶ï</div>
            <div class="big-card-title">Aventura Eroului</div>
            <div class="big-card-desc">Sari peste obstacole »ôi c√¢»ôtigƒÉ trofee!</div>
        </div>
    </div>
</div>

<!-- Interfa»õƒÉ Joc Matematic -->
<button class="back-btn" id="mathBackBtn" style="display: none;" onclick="showMainMenu()">‚Üê √énapoi</button>
<div class="container" id="mathContainer" style="display: none;">
    <div id="mathMainMenu">
        <h1>Alege Nivelul</h1>
        <div class="sub-menu-grid" id="mathMenuGrid"></div>
        <button class="btn btn-secondary" onclick="showMainMenu()" style="margin-top: 2rem;">√énapoi la Meniu</button>
    </div>
    <div id="mathSubMenu" style="display: none;">
        <h2 id="mathSubMenuTitle">ActivitƒÉ»õi:</h2>
        <div class="sub-menu-grid" id="mathSubMenuGrid"></div>
        <button class="btn btn-secondary" onclick="openMathMenu()" style="margin-top: 2rem;">√énapoi</button>
    </div>
    <div id="mathGameArea" class="game-area">
        <div class="stats-bar">
            <span id="mathScoreDisplay">Scor: 100</span>
            <span id="mathProgressDisplay">Exerci»õiul: 1/20</span>
        </div>
        <div class="timer-container"><div class="timer-bar" id="mathTimerBar"></div></div>
        <div id="mathGameContent"></div>
        <div id="mathChoicesContainer" class="choices-grid" style="display: none;"></div>
        <div id="mathInputContainer" class="input-group" style="display: none;">
            <input type="number" id="mathAnswerInput" placeholder="?" autocomplete="off" step="0.1">
            <button class="btn btn-primary" onclick="checkMathAnswer()">VerificƒÉ</button>
        </div>
        <div class="feedback" id="mathFeedbackText"></div>
        <button class="btn btn-secondary" onclick="openMathMenu()">Ie»ôire</button>
    </div>
    <div id="mathAwardScreen" class="award-container">
        <div class="award-icon" id="mathAwardIcon">üèÜ</div>
        <div class="award-title" id="mathAwardTitle">Premiul 1</div>
        <div class="final-score" id="mathFinalScoreText">Scor Final: 100</div>
        <div class="name-input-group" id="mathNameInputGroup" style="display: none;">
            <label for="mathPlayerName">Introdu numele tƒÉu:</label>
            <input type="text" id="mathPlayerName" placeholder="Nume..." maxlength="15">
            <button class="btn btn-primary" onclick="saveMathScore()">SalveazƒÉ Scorul</button>
        </div>
        <button class="btn btn-secondary" id="mathCloseAwardBtn" onclick="openMathMenu()" style="display: none;">√énapoi</button>
    </div>
    <div id="mathLeaderboardScreen" class="leaderboard-container">
        <h2 id="mathLeaderboardTitle">Clasament</h2>
        <table class="leaderboard-table">
            <thead><tr><th>#</th><th>Nume</th><th>Scor</th></tr></thead>
            <tbody id="mathLeaderboardBody"></tbody>
        </table>
        <button class="btn btn-secondary" onclick="openMathMenu()">√énapoi</button>
    </div>
</div>

<!-- Interfa»õƒÉ Joc SƒÉrituri -->
<div id="jumpGameContainer">
    <canvas id="jumpCanvas"></canvas>
    <div id="jumpUI">
        <div class="badge">‚≠ê Scor: <span id="jumpScoreVal">0</span></div>
        <div class="badge">üö© Sta»õia: <span id="jumpStationVal">0</span>/15</div>
    </div>
    <div id="jumpMenu">
        <h1>Alege Eroul</h1>
        <div style="margin-bottom: 20px;">
            <button class="btn selected" id="jumpBtnGirl" onclick="setJumpChar('girl')">üåü Fata</button>
            <button class="btn" id="jumpBtnBoy" onclick="setJumpChar('boy')">ü¶ï BƒÉiat</button>
        </div>
        <button class="btn" id="jumpStartBtn" onclick="startJumpGame()" style="background:#2ed573; margin-top:30px;">START JOC</button>
        <p style="margin-top: 20px;">ApasƒÉ oriunde pentru a sƒÉri SUS!</p>
        <button class="btn btn-secondary" onclick="closeJumpGame()" style="margin-top: 20px;">√énapoi la Meniu</button>
    </div>
    <div id="jumpWinScreen">
        <h1 style="font-size: 50px;">VICTORIE! üèÜ</h1>
        <p style="font-size: 24px; color: #fff;">Ai trecut prin toate cele 15 sta»õii!</p>
        <button class="btn" onclick="closeJumpGame()" style="background:#fff; color:#2ed573; margin-top:30px;">√énapoi la Meniu</button>
    </div>
</div>

<script>
// ==========================================
// LOGICA GENERALƒÇ & NAVIGARE
// ==========================================
function showMainMenu() {
    document.getElementById('mainContainer').style.display = 'block';
    document.getElementById('mathContainer').style.display = 'none';
    document.getElementById('mathBackBtn').style.display = 'none';
    closeJumpGame();
}

function openMathMenu() {
    document.getElementById('mainContainer').style.display = 'none';
    document.getElementById('mathContainer').style.display = 'block';
    document.getElementById('mathBackBtn').style.display = 'flex';
    document.getElementById('mathBackBtn').onclick = showMainMenu;
    document.getElementById('mathMainMenu').style.display = 'block';
    document.getElementById('mathSubMenu').style.display = 'none';
    document.getElementById('mathGameArea').style.display = 'none';
    document.getElementById('mathAwardScreen').style.display = 'none';
    document.getElementById('mathLeaderboardScreen').style.display = 'none';
    renderMathMainMenu();
}

function openJumpGame() {
    document.getElementById('mainContainer').style.display = 'none';
    document.getElementById('mathContainer').style.display = 'none';
    document.getElementById('jumpGameContainer').style.display = 'block';
    initJumpGame();
}

function closeJumpGame() {
    jumpGameRunning = false;
    document.getElementById('jumpGameContainer').style.display = 'none';
    document.getElementById('jumpMenu').style.display = 'flex';
    document.getElementById('jumpWinScreen').style.display = 'none';
}

// ==========================================
// LOGICA JOC MATEMATIC (Codul Original + Fix RƒÉspuns)
// ==========================================
let mathCurrentMode = '';
let mathScore = 100;
let mathCurrentAnswer = 0;
let mathTimeLeft = 0;
let mathMaxTime = 0;
let mathTimerInterval;
let mathDifficultyLevel = 1;
let mathProblemHTML = '';
let mathQuestionCount = 0;
const MAX_QUESTIONS = 20;
let mathCurrentSubMenuKey = '';
let isMathGameEnding = false;

const mathMenus = {
'kg': { title: 'GrƒÉdini»õƒÉ', theme: 'boy', items: [
{ id: 'kg_count', icon: 'üöó', title: 'NumƒÉrƒÉ Obiecte', desc: 'C√¢te ma»ôinu»õe sunt?' },
{ id: 'kg_sequence', icon: 'ü§ñ', title: '»òir Numeric', desc: 'ContinuƒÉ »ôirul (1-10)' },
{ id: 'kg_add', icon: '‚öΩ', title: 'AdunƒÉri Vizuale', desc: 'AdunƒÉ bilele' }
]},
'easy_menu': { title: 'Clasa 1 - 2 (FƒÉrƒÉ Trecere)', theme: 'girl', items: [
{ id: 'easy_math', icon: 'ü¶Ñ', title: 'Calcule', desc: 'AdunƒÉri »ôi scƒÉderi simple' },
{ id: 'easy_seq', icon: 'üî¢', title: '»òiruri Numerice', desc: 'GƒÉse»ôte urmƒÉtorul numƒÉr' },
{ id: 'easy_comp', icon: '‚öñÔ∏è', title: 'Compara»õii', desc: 'Care e mai mare?' }
]},
'max_menu': { title: 'Clasa 1 - 2 (Cu Trecere)', theme: 'girl', items: [
{ id: 'max_math', icon: 'üëë', title: 'Calcule Avansate', desc: 'Cu trecere peste ordin' },
{ id: 'max_seq', icon: 'üß©', title: '»òiruri Complexe', desc: 'Salturi de 2, 5, 10' },
{ id: 'max_eq', icon: '‚ùì', title: 'Ecua»õii Simple', desc: 'GƒÉse»ôte numƒÉrul lipsƒÉ' }
]},
'med_menu': { title: 'Clasa 3 - 4', theme: 'girl', items: [
{ id: 'med_math', icon: 'üå∏', title: '√énmul»õiri & √émpƒÉr»õiri', desc: 'Tabelele √Ænmul»õirii' },
{ id: 'med_round', icon: 'üéØ', title: 'Rotunjiri', desc: 'La zece sau sutƒÉ' },
{ id: 'med_order', icon: 'üìù', title: 'Ordinea Opera»õiilor', desc: 'Calcul cu paranteze' }
]},
'hard_menu': { title: 'Clasa 5+', theme: 'girl', items: [
{ id: 'hard_frac', icon: 'üç∞', title: 'Frac»õii', desc: 'AdunƒÉri cu frac»õii' },
{ id: 'hard_dec', icon: 'üíß', title: 'Zecimale', desc: 'Calcule cu virgulƒÉ' },
{ id: 'hard_pow', icon: '‚ö°', title: 'Puteri & Radicali', desc: 'Calcul avansat' }
]},
'pro_menu': { title: '5 Pro (Avansat)', theme: 'pro', items: [
{ id: 'pro_cong', icon: '‚öõÔ∏è', title: 'Congruen»õe', desc: 'AritmeticƒÉ modularƒÉ (mod n)' },
{ id: 'pro_last', icon: 'üî¢', title: 'Ultima CifrƒÉ', desc: 'DeterminƒÉ ultima cifrƒÉ' },
{ id: 'pro_div', icon: '‚ûó', title: 'Criterii Divizibilitate', desc: 'Restul √ÆmpƒÉr»õirii' }
]}
};

function initMath() {
    createBackgroundShapes();
    renderMathMainMenu();
    document.getElementById('mathAnswerInput').addEventListener("keypress", function(event) {
        if (event.key === "Enter") checkMathAnswer();
    });
}

function createBackgroundShapes() {
    const container = document.getElementById('bg-shapes');
    const colors = ['#FFCC80', '#FFAB91', '#FFE082', '#A5D6A7', '#90CAF9'];
    for(let i=0; i<12; i++) {
        const shape = document.createElement('div');
        shape.classList.add('shape');
        const size = Math.random() * 60 + 30;
        const color = colors[Math.floor(Math.random() * colors.length)];
        shape.style.width = `${size}px`;
        shape.style.height = `${size}px`;
        shape.style.left = `${Math.random() * 100}%`;
        shape.style.backgroundColor = color;
        shape.style.borderRadius = Math.random() > 0.5 ? '50%' : '15%';
        shape.style.animationDuration = `${Math.random() * 10 + 15}s`;
        shape.style.animationDelay = `-${Math.random() * 20}s`;
        container.appendChild(shape);
    }
}

function renderMathMainMenu() {
    const grid = document.getElementById('mathMenuGrid');
    grid.innerHTML = '';
    Object.keys(mathMenus).forEach(key => {
        const menuData = mathMenus[key];
        const card = document.createElement('div');
        card.className = `card ${menuData.theme === 'boy' ? 'kg-card' : (menuData.theme === 'pro' ? 'pro-card' : 'easy-card')}`;
        const lbBtn = document.createElement('button');
        lbBtn.className = 'card-lb-btn';
        lbBtn.innerHTML = 'üèÜ';
        lbBtn.title = 'Vezi Clasament';
        lbBtn.onclick = (e) => { e.stopPropagation(); showMathLeaderboard(key); };
        card.innerHTML = `<div class="card-icon">${menuData.items[0].icon}</div><div class="card-title">${menuData.title}</div><div class="card-desc">${menuData.items[0].desc}</div>`;
        card.appendChild(lbBtn);
        card.onclick = () => openMathSubmenu(key);
        grid.appendChild(card);
    });
}

function openMathSubmenu(menuKey) {
    mathCurrentSubMenuKey = menuKey;
    const menuData = mathMenus[menuKey];
    if(!menuData) return;
    document.getElementById('mathMainMenu').style.display = 'none';
    document.getElementById('mathSubMenu').style.display = 'block';
    document.getElementById('mathSubMenuTitle').textContent = menuData.title;
    const subGrid = document.getElementById('mathSubMenuGrid');
    subGrid.innerHTML = '';
    document.body.classList.remove('boy-theme', 'pro-theme');
    if(menuData.theme === 'boy') document.body.classList.add('boy-theme');
    if(menuData.theme === 'pro') document.body.classList.add('pro-theme');
    menuData.items.forEach(item => {
        const card = document.createElement('div');
        card.className = `card ${menuData.theme === 'boy' ? 'kg-card' : (menuData.theme === 'pro' ? 'pro-card' : 'easy-card')}`;
        card.innerHTML = `<div class="card-icon">${item.icon}</div><div class="card-title">${item.title}</div><div class="card-desc">${item.desc}</div>`;
        card.onclick = () => startMathGame(item.id);
        subGrid.appendChild(card);
    });
}

function startMathGame(mode) {
    mathCurrentMode = mode;
    mathScore = 100;
    mathQuestionCount = 0;
    mathDifficultyLevel = 1;
    isMathGameEnding = false;
    updateMathStats();
    document.getElementById('mathSubMenu').style.display = 'none';
    document.getElementById('mathGameArea').style.display = 'block';
    document.getElementById('mathAwardScreen').style.display = 'none';
    document.getElementById('mathLeaderboardScreen').style.display = 'none';
    const isBoy = mode.startsWith('kg');
    const isPro = mode.startsWith('pro');
    if(isBoy) {
        document.body.classList.add('boy-theme');
        document.getElementById('mathChoicesContainer').style.display = 'grid';
        document.getElementById('mathInputContainer').style.display = 'none';
    } else {
        if(isPro) document.body.classList.add('pro-theme');
        else document.body.classList.remove('boy-theme', 'pro-theme');
        document.getElementById('mathChoicesContainer').style.display = 'none';
        document.getElementById('mathInputContainer').style.display = 'flex';
    }
    nextMathProblem();
    if(!isBoy) document.getElementById('mathAnswerInput').focus();
}

function updateMathStats() {
    document.getElementById('mathScoreDisplay').textContent = `Scor: ${mathScore}`;
    document.getElementById('mathProgressDisplay').textContent = `Exerci»õiul: ${mathQuestionCount + 1}/${MAX_QUESTIONS}`;
}

function startMathTimer(seconds) {
    clearInterval(mathTimerInterval);
    mathMaxTime = seconds;
    mathTimeLeft = seconds;
    updateMathTimerVisuals();
    mathTimerInterval = setInterval(() => {
        mathTimeLeft--;
        updateMathTimerVisuals();
        if (mathTimeLeft <= 0) { clearInterval(mathTimerInterval); handleMathTimeout(); }
    }, 1000);
}

function updateMathTimerVisuals() {
    const percentage = (mathTimeLeft / mathMaxTime) * 100;
    document.getElementById('mathTimerBar').style.width = `${percentage}%`;
    if (percentage > 50) document.getElementById('mathTimerBar').style.backgroundColor = 'var(--success)';
    else if (percentage > 20) document.getElementById('mathTimerBar').style.backgroundColor = 'var(--timer-warning)';
    else document.getElementById('mathTimerBar').style.backgroundColor = 'var(--timer-danger)';
}

function handleMathTimeout() { 
    showMathCorrectAnswer(true); 
}

function getRandomInt(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }

function generateMathChoices(correctAnswer, minVal, maxVal) {
    let choices = new Set();
    choices.add(correctAnswer);
    while(choices.size < 3) {
        let offset = getRandomInt(-5, 5);
        let wrong = correctAnswer + offset;
        if(wrong >= minVal && wrong <= maxVal && wrong !== correctAnswer) choices.add(wrong);
        else { let r = getRandomInt(minVal, maxVal); if(r !== correctAnswer) choices.add(r); }
    }
    return Array.from(choices).sort(() => Math.random() - 0.5);
}

function renderMathChoices(choices) {
    const container = document.getElementById('mathChoicesContainer');
    container.innerHTML = '';
    choices.forEach(val => {
        const btn = document.createElement('button');
        btn.className = 'choice-btn';
        btn.textContent = val;
        btn.onclick = () => handleMathChoiceClick(val);
        container.appendChild(btn);
    });
}

function handleMathChoiceClick(val) {
    if(isMathGameEnding) return;
    let isCorrect = (val === mathCurrentAnswer);
    processMathResult(isCorrect);
}

function checkMathAnswer() {
    const isBoy = mathCurrentMode.startsWith('kg');
    if(isBoy) return;
    if(isMathGameEnding) return;
    const userVal = parseFloat(document.getElementById('mathAnswerInput').value);
    if (isNaN(userVal)) return;
    let isCorrect = false;
    if(mathCurrentMode === 'easy_comp') {
        isCorrect = (userVal === mathCurrentAnswer);
    } else {
        isCorrect = (Math.abs(userVal - mathCurrentAnswer) < 0.01);
    }
    processMathResult(isCorrect);
}

function processMathResult(isCorrect) {
    if(isCorrect) {
        document.getElementById('mathFeedbackText').textContent = "Bravo! Corect! üéâ";
        document.getElementById('mathFeedbackText').className = "feedback correct";
        mathDifficultyLevel = 1;
    } else {
        mathScore -= 5;
        updateMathStats();
        document.getElementById('mathFeedbackText').textContent = "Gre»ôit! Vezi rƒÉspunsul corect mai sus. üò¢";
        document.getElementById('mathFeedbackText').className = "feedback wrong";
        mathDifficultyLevel++;
        showMathCorrectAnswer(false);
        return; 
    }
    if (mathQuestionCount >= MAX_QUESTIONS) {
        isMathGameEnding = true;
        setTimeout(endMathGame, 1500);
    } else {
        setTimeout(nextMathProblem, 1500);
    }
}

function nextMathProblem() {
    if (mathQuestionCount >= MAX_QUESTIONS) { endMathGame(); return; }
    mathQuestionCount++;
    updateMathStats();
    document.getElementById('mathAnswerInput').value = '';
    document.getElementById('mathFeedbackText').textContent = '';
    document.getElementById('mathFeedbackText').className = 'feedback';
    document.getElementById('mathGameContent').innerHTML = '';
    document.getElementById('mathChoicesContainer').innerHTML = '';
    mathProblemHTML = '';
    if (mathCurrentMode.startsWith('kg')) { if (mathDifficultyLevel === 1) startMathTimer(30); else startMathTimer(40); } 
    else { if (mathDifficultyLevel === 1) startMathTimer(20); else startMathTimer(30); }

    // Generare probleme (codul original pƒÉstrat)
    if (mathCurrentMode === 'kg_count') {
        const maxCount = mathDifficultyLevel === 1 ? 5 : 10;
        const count = getRandomInt(1, maxCount);
        mathCurrentAnswer = count;
        let html = '<div class="visual-container">';
        const icons = ['üöó', '‚öΩ', 'üöÄ', 'ü§ñ', 'üö≤'];
        const icon = icons[Math.floor(Math.random() * icons.length)];
        for(let i=0; i<count; i++) html += `<div style="font-size: 3rem; animation: bounce 2s infinite; animation-delay: ${i*0.1}s">${icon}</div>`;
        html += '</div><p style="font-size: 1.3rem; color: #546E7A; font-weight:bold;">C√¢te sunt?</p>';
        document.getElementById('mathGameContent').innerHTML = html;
        renderMathChoices(generateMathChoices(mathCurrentAnswer, 1, maxCount + 2));
    }
    else if (mathCurrentMode === 'kg_sequence') {
        const start = getRandomInt(0, mathDifficultyLevel === 1 ? 3 : 6);
        let sequence = [];
        for(let i=0; i<3; i++) sequence.push(start + i);
        mathCurrentAnswer = start + 3;
        document.getElementById('mathGameContent').innerHTML = `<p style="font-size: 1.3rem; color: #546E7A; font-weight:bold;">CompleteazƒÉ codul:</p><div class="sequence-display">${sequence.join(' , ')} , <span class="missing-number">?</span></div>`;
        renderMathChoices(generateMathChoices(mathCurrentAnswer, 0, 10));
    }
    else if (mathCurrentMode === 'kg_add') {
        const maxNum = mathDifficultyLevel === 1 ? 4 : 9;
        const n1 = getRandomInt(1, maxNum);
        const n2 = getRandomInt(1, maxNum);
        mathCurrentAnswer = n1 + n2;
        let html = '<div class="visual-container">';
        for(let i=0; i<n1; i++) html += `<div style="font-size: 2.5rem;">‚öΩ</div>`;
        html += '<div style="width:20px; font-weight:900; color:#2196F3; font-size:1.5rem;">+</div>';
        for(let i=0; i<n2; i++) html += `<div style="font-size: 2.5rem;">‚öΩ</div>`;
        html += '</div>';
        document.getElementById('mathGameContent').innerHTML = html + `<div class="problem-display">${n1} + ${n2} = ?</div>`;
        renderMathChoices(generateMathChoices(mathCurrentAnswer, 2, maxNum * 2 + 2));
    }
    else if (mathCurrentMode === 'easy_math') {
        const rangeMax = mathDifficultyLevel === 1 ? 50 : 90;
        const op = Math.random() > 0.5 ? '+' : '-';
        let n1 = getRandomInt(10, rangeMax);
        let n2;
        if(op === '+') {
            let d1_10 = Math.floor(n1 / 10); let d1_1 = n1 % 10;
            let d2_10 = getRandomInt(0, 9 - d1_10); let d2_1 = getRandomInt(0, 9 - d1_1);
            n2 = (d2_10 * 10) + d2_1; if(n2===0) n2=1;
            mathCurrentAnswer = n1 + n2;
        } else {
            let d1_10 = Math.floor(n1 / 10); let d1_1 = n1 % 10;
            let d2_10 = getRandomInt(0, d1_10); let d2_1 = getRandomInt(0, d1_1);
            n2 = (d2_10 * 10) + d2_1; if(n2===0) n2=1; if(n2 >= n1) n2 = getRandomInt(1, n1-1);
            mathCurrentAnswer = n1 - n2;
        }
        mathProblemHTML = `<div class="problem-display">${n1} ${op} ${n2} = ?</div>`;
        document.getElementById('mathGameContent').innerHTML = mathProblemHTML;
    }
    else if (mathCurrentMode === 'easy_seq') {
        const start = getRandomInt(1, 20);
        const step = 1;
        let seq = [start, start+step, start+step*2];
        mathCurrentAnswer = start + step*3;
        mathProblemHTML = `<div class="sequence-display">${seq.join(', ')}, <span class="missing-number">?</span></div>`;
        document.getElementById('mathGameContent').innerHTML = mathProblemHTML;
    }
    else if (mathCurrentMode === 'easy_comp') {
        const n1 = getRandomInt(10, 50);
        const n2 = getRandomInt(10, 50);
        mathCurrentAnswer = n1 > n2 ? 1 : 2;
        mathProblemHTML = `<div style="font-size:1.5rem; color:#666;">ComparƒÉ numerele:</div><div class="problem-display">${n1} <span class="missing-number">?</span> ${n2}</div><div style="font-size:1.2rem; color:#666;">(1 st√¢nga, 2 dreapta)</div>`;
        document.getElementById('mathGameContent').innerHTML = mathProblemHTML;
    }
    else if (mathCurrentMode === 'max_math') {
        const op = Math.random() > 0.5 ? '+' : '-';
        let n1, n2;
        if(op === '+') {
            let u1 = getRandomInt(1, 9); let u2 = getRandomInt(10-u1, 9);
            let t1 = getRandomInt(1, 8); let t2 = getRandomInt(0, 9-t1);
            n1 = t1*10+u1; n2 = t2*10+u2; mathCurrentAnswer = n1+n2;
        } else {
            let u1 = getRandomInt(0, 8); let u2 = getRandomInt(u1+1, 9);
            let t1 = getRandomInt(2, 9); let t2 = getRandomInt(0, t1-1);
            n1 = t1*10+u1; n2 = t2*10+u2; mathCurrentAnswer = n1-n2;
        }
        mathProblemHTML = `<div class="problem-display">${n1} ${op} ${n2} = ?</div>`;
        document.getElementById('mathGameContent').innerHTML = mathProblemHTML;
    }
    else if (mathCurrentMode === 'max_seq') {
        const step = mathDifficultyLevel === 1 ? 2 : 5;
        const start = getRandomInt(1, 10);
        let seq = [start, start+step, start+step*2];
        mathCurrentAnswer = start + step*3;
        mathProblemHTML = `<div class="sequence-display">${seq.join(', ')}, <span class="missing-number">?</span></div>`;
        document.getElementById('mathGameContent').innerHTML = mathProblemHTML;
    }
    else if (mathCurrentMode === 'max_eq') {
        const res = getRandomInt(10, 50);
        const add = getRandomInt(1, 9);
        mathCurrentAnswer = res - add;
        mathProblemHTML = `<div class="problem-display"><span class="missing-number">?</span> + ${add} = ${res}</div>`;
        document.getElementById('mathGameContent').innerHTML = mathProblemHTML;
    }
    else if (mathCurrentMode === 'med_math') {
        const n1 = getRandomInt(2, 9);
        const n2 = getRandomInt(2, 9);
        mathCurrentAnswer = n1 * n2;
        mathProblemHTML = `<div class="problem-display">${n1} √ó ${n2} = ?</div>`;
        document.getElementById('mathGameContent').innerHTML = mathProblemHTML;
    }
    else if (mathCurrentMode === 'med_round') {
        const num = getRandomInt(15, 985);
        const roundTo = mathDifficultyLevel === 1 ? 10 : 100;
        mathCurrentAnswer = Math.round(num / roundTo) * roundTo;
        mathProblemHTML = `<div style="font-size:1.5rem; color:#666;">Rotunjire la ${roundTo}:</div><div class="problem-display">${num} ‚âà <span class="missing-number">?</span></div>`;
        document.getElementById('mathGameContent').innerHTML = mathProblemHTML;
    }
    else if (mathCurrentMode === 'med_order') {
        const a = getRandomInt(2, 5);
        const b = getRandomInt(2, 5);
        const c = getRandomInt(1, 10);
        mathCurrentAnswer = (a + b) * c;
        mathProblemHTML = `<div class="problem-display">(${a} + ${b}) √ó ${c} = ?</div>`;
        document.getElementById('mathGameContent').innerHTML = mathProblemHTML;
    }
    else if (mathCurrentMode === 'hard_frac') {
        const den = getRandomInt(2, 9);
        const n1 = getRandomInt(1, den-1);
        const n2 = getRandomInt(1, den-n1);
        mathCurrentAnswer = (n1 + n2) / den;
        mathProblemHTML = `<div style="font-size:1.5rem; color:#666;">Calcul (zecimal):</div><div class="problem-display">${n1}/${den} + ${n2}/${den} = <span class="missing-number">?</span></div>`;
        document.getElementById('mathGameContent').innerHTML = mathProblemHTML;
    }
    else if (mathCurrentMode === 'hard_dec') {
        const n1 = getRandomInt(10, 50) / 10;
        const n2 = getRandomInt(10, 50) / 10;
        mathCurrentAnswer = n1 + n2;
        mathProblemHTML = `<div class="problem-display">${n1} + ${n2} = <span class="missing-number">?</span></div>`;
        document.getElementById('mathGameContent').innerHTML = mathProblemHTML;
    }
    else if (mathCurrentMode === 'hard_pow') {
        const base = getRandomInt(2, 5);
        const exp = getRandomInt(2, 3);
        mathCurrentAnswer = Math.pow(base, exp);
        mathProblemHTML = `<div class="problem-display">${base}<sup>${exp}</sup> = <span class="missing-number">?</span></div>`;
        document.getElementById('mathGameContent').innerHTML = mathProblemHTML;
    }
    else if (mathCurrentMode === 'pro_cong') {
        const n = mathDifficultyLevel === 1 ? getRandomInt(2, 5) : getRandomInt(6, 12);
        const a = getRandomInt(10, 100);
        mathCurrentAnswer = a % n;
        mathProblemHTML = `<div style="font-size:1.5rem; color:#666;">Congruen»õƒÉ:</div><div class="problem-display">${a} ‚â° <span class="missing-number">?</span> (mod ${n})</div>`;
        document.getElementById('mathGameContent').innerHTML = mathProblemHTML;
    }
    else if (mathCurrentMode === 'pro_last') {
        const base = getRandomInt(11, 99);
        const exp = getRandomInt(2, 5);
        mathCurrentAnswer = Math.pow(base, exp) % 10;
        mathProblemHTML = `<div style="font-size:1.5rem; color:#666;">Ultima cifrƒÉ:</div><div class="problem-display">${base}<sup>${exp}</sup> ‚Üí <span class="missing-number">?</span></div>`;
        document.getElementById('mathGameContent').innerHTML = mathProblemHTML;
    }
    else if (mathCurrentMode === 'pro_div') {
        const div = mathDifficultyLevel === 1 ? 3 : 7;
        const a = getRandomInt(20, 100);
        mathCurrentAnswer = a % div;
        mathProblemHTML = `<div style="font-size:1.5rem; color:#666;">Restul √ÆmpƒÉr»õirii:</div><div class="problem-display">${a} : ${div} rest <span class="missing-number">?</span></div>`;
        document.getElementById('mathGameContent').innerHTML = mathProblemHTML;
    }
}

function endMathGame() {
    clearInterval(mathTimerInterval);
    document.getElementById('mathGameArea').style.display = 'none';
    document.getElementById('mathAwardScreen').style.display = 'flex';
    document.getElementById('mathFinalScoreText').textContent = `Scor Final: ${mathScore}`;
    let icon = '', title = '', titleClass = '', showInput = false;
    if (mathScore === 100) { icon = 'üèÜ'; title = 'PREMIUL 1'; titleClass = 'award-gold'; showInput = true; } 
    else if (mathScore === 95) { icon = 'ü•à'; title = 'PREMIUL 2'; titleClass = 'award-silver'; showInput = true; } 
    else if (mathScore === 90) { icon = 'ü•â'; title = 'PREMIUL 3'; titleClass = 'award-bronze'; showInput = true; } 
    else if (mathScore >= 70 && mathScore <= 85) { icon = 'üéñÔ∏è'; title = 'MEN»öIUNE'; titleClass = 'award-mention'; showInput = true; } 
    else { icon = 'üí™'; title = '√éNCEARCƒÇ DIN NOU'; titleClass = 'award-try'; showInput = false; }
    document.getElementById('mathAwardIcon').textContent = icon;
    document.getElementById('mathAwardTitle').textContent = title;
    document.getElementById('mathAwardTitle').className = 'award-title ' + titleClass;
    if(showInput) { document.getElementById('mathNameInputGroup').style.display = 'flex'; document.getElementById('mathCloseAwardBtn').style.display = 'none'; document.getElementById('mathPlayerName').value = ''; document.getElementById('mathPlayerName').focus(); } 
    else { document.getElementById('mathNameInputGroup').style.display = 'none'; document.getElementById('mathCloseAwardBtn').style.display = 'inline-block'; }
}

function saveMathScore() {
    const name = document.getElementById('mathPlayerName').value.trim() || "Anonim";
    const leaderboardKey = `math_leaderboard_${mathCurrentMode}`;
    try {
        let scores = JSON.parse(localStorage.getItem(leaderboardKey) || "[]");
        scores.push({ name: name, score: mathScore, date: new Date().toLocaleDateString() });
        scores.sort((a, b) => b.score - a.score);
        scores = scores.slice(0, 10);
        localStorage.setItem(leaderboardKey, JSON.stringify(scores));
        document.getElementById('mathNameInputGroup').style.display = 'none';
        document.getElementById('mathCloseAwardBtn').style.display = 'inline-block';
    } catch (e) {
        console.error("Eroare la salvarea scorului:", e);
        alert("A apƒÉrut o eroare la salvarea scorului.");
    }
}

function showMathLeaderboard(categoryKey) {
    const key = categoryKey || mathCurrentSubMenuKey;
    const menuData = mathMenus[key];
    if (!menuData) return;
    document.getElementById('mathGameArea').style.display = 'none';
    document.getElementById('mathAwardScreen').style.display = 'none';
    document.getElementById('mathSubMenu').style.display = 'none';
    document.getElementById('mathMainMenu').style.display = 'none';
    document.getElementById('mathLeaderboardScreen').style.display = 'flex';
    document.getElementById('mathBackBtn').style.display = 'flex';
    document.getElementById('mathBackBtn').onclick = () => { document.getElementById('mathLeaderboardScreen').style.display = 'none'; if(categoryKey) document.getElementById('mathMainMenu').style.display = 'block'; else document.getElementById('mathSubMenu').style.display = 'block'; };
    document.getElementById('mathLeaderboardTitle').textContent = `Clasament: ${menuData.title}`;
    let allScores = [];
    if (menuData.items && Array.isArray(menuData.items)) {
        menuData.items.forEach(item => {
            try {
                const itemKey = `math_leaderboard_${item.id}`;
                const itemScores = JSON.parse(localStorage.getItem(itemKey) || "[]");
                allScores = allScores.concat(itemScores);
            } catch (e) { console.warn(`Eroare la citirea scorurilor pentru ${item.id}:`, e); }
        });
    }
    allScores.sort((a, b) => b.score - a.score);
    allScores = allScores.slice(0, 10);
    const tbody = document.getElementById('mathLeaderboardBody');
    tbody.innerHTML = '';
    if(allScores.length === 0) { tbody.innerHTML = '<tr><td colspan="3">Nu existƒÉ √ÆncƒÉ scoruri.</td></tr>'; } 
    else {
        allScores.forEach((entry, index) => {
            const row = `<tr><td>${index + 1}</td><td>${entry.name}</td><td>${entry.score}</td></tr>`;
            tbody.innerHTML += row;
        });
    }
}

function showMathCorrectAnswer(isTimeout) {
    if(mathProblemHTML) {
        const correctedHTML = mathProblemHTML.replace(
            /<span class="missing-number">\?<\/span>/g, 
            `<span style="color:var(--success); font-weight:900; border-bottom: 4px solid var(--success);">${mathCurrentAnswer}</span>`
        );
        document.getElementById('mathGameContent').innerHTML = correctedHTML;
    }
    if(isTimeout) {
        document.getElementById('mathFeedbackText').innerHTML = `Timp expirat! <br>RƒÉspunsul corect este <strong>${mathCurrentAnswer}</strong>. (-5 puncte)`;
    } else {
        document.getElementById('mathFeedbackText').innerHTML = `Gre»ôit! <br>RƒÉspunsul corect este <strong>${mathCurrentAnswer}</strong>. (-5 puncte)`;
    }
    document.getElementById('mathFeedbackText').className = "feedback wrong";
    mathScore -= 5;
    updateMathStats();
    mathDifficultyLevel++;
    document.getElementById('mathAnswerInput').value = '';
    if (mathQuestionCount >= MAX_QUESTIONS) {
        isMathGameEnding = true;
        setTimeout(endMathGame, 3000);
    } else {
        setTimeout(nextMathProblem, 3000);
    }
}

// ==========================================
// LOGICA JOC SƒÇRITURI (Codul Original)
// ==========================================
const jumpCanvas = document.getElementById('jumpCanvas');
const jumpCtx = jumpCanvas.getContext('2d');
const jumpScoreEl = document.getElementById('jumpScoreVal');
const jumpStationEl = document.getElementById('jumpStationVal');
const jumpMenu = document.getElementById('jumpMenu');
const jumpWinScreen = document.getElementById('jumpWinScreen');
const jumpBtnGirl = document.getElementById('jumpBtnGirl');
const jumpBtnBoy = document.getElementById('jumpBtnBoy');

let jumpGameRunning = false;
let jumpScore = 0;
let jumpStation = 0;
const maxStations = 15;
let jumpFrame = 0;
let jumpSpeed = 6;
let jumpCharType = 'girl';
const jumpGravity = 0.5;
const jumpPower = -20; 
const jumpGroundH = 100;
const jumpPlayer = { x: 100, y: 0, size: 80, dy: 0, angle: 0, grounded: false };
let jumpObstacles = [];

const jumpThemes = [
    {bg: ['#ff9a9e', '#fecfef'], ground: '#6ab04c'}, {bg: ['#4facfe', '#00f2fe'], ground: '#0097e6'},
    {bg: ['#fddb92', '#d1fdff'], ground: '#eccc68'}, {bg: ['#96fbc4', '#f9f586'], ground: '#2ed573'},
    {bg: ['#c2e9fb', '#a1c4fd'], ground: '#3742fa'}, {bg: ['#ffecd2', '#fcb69f'], ground: '#ff7f50'},
    {bg: ['#e0c3fc', '#8ec5fc'], ground: '#a55eea'}, {bg: ['#ffecd2', '#ffd1ff'], ground: '#ff4757'},
    {bg: ['#d299c2', '#fef9d7'], ground: '#8c7ae6'}, {bg: ['#85FFBD', '#FFFB7D'], ground: '#26de81'},
    {bg: ['#C9FFBF', '#FFAFBD'], ground: '#fc5c65'}, {bg: ['#FAD961', '#F76B1C'], ground: '#e58e26'},
    {bg: ['#B5FFFC', '#D5FFEA'], ground: '#0be881'}, {bg: ['#FFDEE9', '#B5FFFC'], ground: '#4834d4'},
    {bg: ['#F6D365', '#FDA085'], ground: '#be2edd'}, {bg: ['#667eea', '#764ba2'], ground: '#ffffff'}
];

function initJumpGame() {
    resizeJumpCanvas();
    window.addEventListener('resize', resizeJumpCanvas);
    window.addEventListener('pointerdown', function(e) {
        if(e.target.tagName === 'BUTTON') return;
        jumpDoJump();
    });
    window.addEventListener('keydown', function(e) {
        if ((e.code === 'Space' || e.code === 'ArrowUp') && jumpGameRunning) jumpDoJump();
    });
}

function resizeJumpCanvas() {
    jumpCanvas.width = window.innerWidth;
    jumpCanvas.height = window.innerHeight;
    if(!jumpGameRunning) {
        jumpPlayer.y = jumpCanvas.height - jumpGroundH - jumpPlayer.size;
        jumpPlayer.x = jumpCanvas.width * 0.15;
        drawJump();
    } else {
        jumpPlayer.x = jumpCanvas.width * 0.15;
    }
}

window.setJumpChar = function(type) {
    jumpCharType = type;
    if(type === 'girl') {
        jumpBtnGirl.classList.add('selected');
        jumpBtnBoy.classList.remove('selected');
    } else {
        jumpBtnBoy.classList.add('selected');
        jumpBtnGirl.classList.remove('selected');
    }
};

window.startJumpGame = function() {
    jumpMenu.style.display = 'none';
    jumpGameRunning = true;
    jumpScore = 0;
    jumpStation = 0;
    jumpSpeed = 6;
    jumpFrame = 0;
    jumpObstacles = [];
    jumpPlayer.y = jumpCanvas.height - jumpGroundH - jumpPlayer.size;
    jumpPlayer.dy = 0;
    updateJumpUI();
    jumpLoop();
};

function jumpDoJump() {
    if (!jumpGameRunning) return;
    if (jumpPlayer.grounded || jumpPlayer.y > jumpCanvas.height - jumpGroundH - jumpPlayer.size - 10) {
        jumpPlayer.dy = jumpPower;
        jumpPlayer.grounded = false;
    }
}

function updateJumpUI() {
    jumpScoreEl.innerText = jumpScore;
    jumpStationEl.innerText = Math.min(jumpStation, maxStations);
}

function jumpLoop() {
    if (!jumpGameRunning) return;
    requestAnimationFrame(jumpLoop);
    jumpFrame++;
    updateJump();
    drawJump();
}

function updateJump() {
    jumpPlayer.dy += jumpGravity;
    jumpPlayer.y += jumpPlayer.dy;
    if (jumpPlayer.y + jumpPlayer.size > jumpCanvas.height - jumpGroundH) {
        jumpPlayer.y = jumpCanvas.height - jumpGroundH - jumpPlayer.size;
        jumpPlayer.dy = 0;
        jumpPlayer.grounded = true;
        jumpPlayer.angle = 0;
    } else {
        jumpPlayer.grounded = false;
        jumpPlayer.angle += 0.1;
    }
    if (jumpFrame % Math.floor(1000 / jumpSpeed) === 0) {
        let oh = 40 + Math.random() * 40;
        jumpObstacles.push({ x: jumpCanvas.width, y: jumpCanvas.height - jumpGroundH - oh, w: 40, h: oh, passed: false });
    }
    for (let i = 0; i < jumpObstacles.length; i++) {
        let o = jumpObstacles[i];
        o.x -= jumpSpeed;
        if (jumpPlayer.x < o.x + o.w && jumpPlayer.x + jumpPlayer.size > o.x &&
            jumpPlayer.y < o.y + o.h && jumpPlayer.y + jumpPlayer.size > o.y) {
            jumpGameOver();
        }
        if (o.x + o.w < jumpPlayer.x && !o.passed) {
            jumpScore++;
            if (jumpScore % 5 === 0) {
                jumpStation++;
                jumpSpeed += 0.5;
                if (jumpStation >= maxStations) {
                    jumpGameWin();
                    return;
                }
            }
            updateJumpUI();
            o.passed = true;
        }
    }
    if (jumpObstacles.length > 0 && jumpObstacles[0].x < -50) jumpObstacles.shift();
}

function drawJump() {
    let t = jumpThemes[Math.min(jumpStation, jumpThemes.length - 1)];
    let grad = jumpCtx.createLinearGradient(0, 0, 0, jumpCanvas.height);
    grad.addColorStop(0, t.bg[0]);
    grad.addColorStop(1, t.bg[1]);
    jumpCtx.fillStyle = grad;
    jumpCtx.fillRect(0, 0, jumpCanvas.width, jumpCanvas.height);
    jumpCtx.fillStyle = t.ground;
    jumpCtx.fillRect(0, jumpCanvas.height - jumpGroundH, jumpCanvas.width, jumpGroundH);
    jumpCtx.fillStyle = "rgba(255,255,255,0.3)";
    jumpCtx.fillRect(0, jumpCanvas.height - jumpGroundH, jumpCanvas.width, 10);
    jumpCtx.fillStyle = "#ff4757";
    jumpObstacles.forEach(o => {
        jumpCtx.beginPath();
        jumpCtx.moveTo(o.x, o.y + o.h);
        jumpCtx.lineTo(o.x + o.w/2, o.y);
        jumpCtx.lineTo(o.x + o.w, o.y + o.h);
        jumpCtx.fill();
    });
    jumpCtx.save();
    jumpCtx.translate(jumpPlayer.x + jumpPlayer.size/2, jumpPlayer.y + jumpPlayer.size/2);
    jumpCtx.rotate(jumpPlayer.angle);
    jumpCtx.font = jumpPlayer.size + "px Arial";
    jumpCtx.textAlign = "center";
    jumpCtx.textBaseline = "middle";
    jumpCtx.fillText(jumpCharType === 'girl' ? "üåü" : "ü¶ï", 0, 0);
    jumpCtx.restore();
}

function jumpGameOver() {
    jumpGameRunning = false;
    jumpMenu.style.display = 'flex';
    document.querySelector('#jumpMenu h1').innerText = "Joc Terminat!\nScor: " + jumpScore;
    document.getElementById('jumpStartBtn').innerText = "√éncearcƒÉ Din Nou";
}

function jumpGameWin() {
    jumpGameRunning = false;
    jumpWinScreen.style.display = 'flex';
}

// Ini»õializare
initMath();
</script>
</body>
</html>

