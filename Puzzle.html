<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom Image Puzzle</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #f4f4f4;
            margin: 0;
            padding: 15px;
            color: #333;
        }
        h1 {
            margin-bottom: 10px;
        }
        #controls {
            margin: 15px 0;
        }
        label {
            font-weight: bold;
            margin-right: 10px;
        }
        select, button, input[type="file"] {
            padding: 6px 12px;
            margin: 0 8px;
            font-size: 14px;
            border-radius: 4px;
            border: 1px solid #ccc;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        input[type="file"] {
            max-width: 200px;
        }
        #game-area {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-top: 10px;
        }
        #puzzle-board {
            display: grid;
            gap: 2px;
            background-color: #333;
            border: 2px solid #000;
        }
        .puzzle-cell {
            background-color: #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            color: #666;
        }
        #pieces-container {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            background-color: #eee;
            padding: 8px;
            border: 1px dashed #999;
            max-width: 500px;
        }
        .piece {
            cursor: pointer;
            border: 1px solid #666;
            box-shadow: 1px 1px 3px rgba(0,0,0,0.2);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .piece:hover {
            transform: scale(1.05);
            box-shadow: 2px 2px 5px rgba(0,0,0,0.3);
        }
        .piece.selected {
            border: 2px solid #e74c3c;
            transform: scale(1.03);
        }
        #message {
            margin-top: 15px;
            font-size: 18px;
            font-weight: bold;
            min-height: 26px;
        }
        #win-message {
            color: #27ae60;
        }
        #instructions {
            max-width: 600px;
            margin: 10px auto;
            padding: 10px;
            background-color: #fff;
            border-radius: 5px;
            font-size: 14px;
            color: #555;
        }
        #preview {
            margin-top: 10px;
            max-width: 200px;
            max-height: 200px;
            display: none;
            border: 1px solid #ccc;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <h1>Custom Image Puzzle</h1>
    
    <div id="instructions">
        1. Upload your image<br>
        2. Choose puzzle size<br>
        3. Click "Start Game"<br>
        4. Each puzzle piece shows a unique part of your image!
    </div>

    <div id="controls">
        <input type="file" id="image-upload" accept="image/*">
        <br><br>
        <img id="preview" alt="Image preview">
        <br><br>
        <label for="size-select">Puzzle Size:</label>
        <select id="size-select">
            <option value="3">3√ó3 (9 pieces)</option>
            <option value="4">4√ó4 (16 pieces)</option>
            <option value="5">5√ó5 (25 pieces)</option>
            <option value="10">10√ó10 (100 pieces)</option>
        </select>
        <button id="start-btn">Start Game</button>
        <button id="reset-btn">Reset</button>
    </div>

    <div id="message"></div>

    <div id="game-area">
        <div id="puzzle-board"></div>
        <div id="pieces-container"></div>
    </div>

    <script>
        let uploadedImage = null;
        let imgWidth = 0;
        let imgHeight = 0;
        let gridSize = 3;
        let boardState = [];
        let selectedPiece = null;
        let piecesData = [];

        const imageUpload = document.getElementById('image-upload');
        const preview = document.getElementById('preview');
        const sizeSelect = document.getElementById('size-select');
        const startBtn = document.getElementById('start-btn');
        const resetBtn = document.getElementById('reset-btn');

        imageUpload.addEventListener('change', handleImageUpload);
        startBtn.addEventListener('click', startGame);
        resetBtn.addEventListener('click', resetGame);

        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                uploadedImage = e.target.result;
                preview.src = uploadedImage;
                preview.style.display = 'inline-block';
                
                const img = new Image();
                img.onload = () => {
                    imgWidth = img.width;
                    imgHeight = img.height;
                };
                img.src = uploadedImage;
                
                document.getElementById('message').textContent = '';
            };
            reader.readAsDataURL(file);
        }

        function startGame() {
            if (!uploadedImage) {
                document.getElementById('message').textContent = '‚ö†Ô∏è Please upload an image first!';
                return;
            }

            gridSize = parseInt(sizeSelect.value);
            if (gridSize < 3 || gridSize > 10) {
                document.getElementById('message').textContent = '‚ö†Ô∏è Choose a grid size between 3 and 10.';
                return;
            }

            initGame();
        }

        function resetGame() {
            document.getElementById('message').textContent = '';
            selectedPiece = null;
            if (uploadedImage) {
                initGame();
            }
        }

        function initGame() {
            document.getElementById('puzzle-board').innerHTML = '';
            document.getElementById('pieces-container').innerHTML = '';
            boardState = Array(gridSize * gridSize).fill(null);
            selectedPiece = null;
            piecesData = [];

            // CreeazƒÉ datele pentru fiecare piesƒÉ (coordonate unice)
            for (let id = 0; id < gridSize * gridSize; id++) {
                const row = Math.floor(id / gridSize);
                const col = id % gridSize;
                piecesData.push({
                    id: id,
                    row: row,
                    col: col
                });
            }

            // AmestecƒÉ piesele
            shuffleArray(piecesData);

            const board = document.getElementById('puzzle-board');
            board.style.gridTemplateColumns = `repeat(${gridSize}, 1fr)`;
            board.style.gridTemplateRows = `repeat(${gridSize}, 1fr)`;
            const cellSize = Math.min(400 / gridSize, 60);
            board.style.width = `${gridSize * cellSize}px`;
            board.style.height = `${gridSize * cellSize}px`;

            for (let i = 0; i < gridSize * gridSize; i++) {
                const cell = document.createElement('div');
                cell.className = 'puzzle-cell';
                cell.dataset.index = i;
                cell.style.width = `${cellSize}px`;
                cell.style.height = `${cellSize}px`;
                cell.addEventListener('click', () => placePiece(i));
                board.appendChild(cell);
            }

            const container = document.getElementById('pieces-container');
            const pieceSize = Math.min(50, 300 / gridSize);

            piecesData.forEach(piece => {
                const pieceElement = document.createElement('div');
                pieceElement.className = 'piece';
                pieceElement.dataset.id = piece.id;
                pieceElement.style.width = `${pieceSize}px`;
                pieceElement.style.height = `${pieceSize}px`;
                pieceElement.style.backgroundImage = `url(${uploadedImage})`;
                pieceElement.style.backgroundSize = `${imgWidth}px ${imgHeight}px`;

                const pieceWidth = imgWidth / gridSize;
                const pieceHeight = imgHeight / gridSize;
                pieceElement.style.backgroundPosition = `-${piece.col * pieceWidth}px -${piece.row * pieceHeight}px`;

                pieceElement.addEventListener('click', () => selectPiece(pieceElement, piece.id));
                container.appendChild(pieceElement);
            });
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function selectPiece(element, id) {
            if (selectedPiece) {
                selectedPiece.element.classList.remove('selected');
            }
            selectedPiece = { element, id };
            element.classList.add('selected');
        }

        function placePiece(index) {
            if (!selectedPiece) return;
            if (boardState[index] !== null) return;

            const cell = document.querySelector(`.puzzle-cell[data-index="${index}"]`);
            cell.innerHTML = '';

            const pieceDiv = document.createElement('div');
            pieceDiv.style.width = '100%';
            pieceDiv.style.height = '100%';
            pieceDiv.style.backgroundImage = `url(${uploadedImage})`;
            pieceDiv.style.backgroundSize = `${imgWidth}px ${imgHeight}px`;

            // GƒÉse»ôte datele piesei selectate
            const pieceData = piecesData.find(p => p.id === selectedPiece.id);
            if (pieceData) {
                const pieceWidth = imgWidth / gridSize;
                const pieceHeight = imgHeight / gridSize;
                pieceDiv.style.backgroundPosition = `-${pieceData.col * pieceWidth}px -${pieceData.row * pieceHeight}px`;
            }

            cell.appendChild(pieceDiv);
            boardState[index] = selectedPiece.id;
            selectedPiece.element.remove();
            selectedPiece = null;

            checkWin();
        }

        function checkWin() {
            // VerificƒÉ dacƒÉ fiecare pozi»õie con»õine piesa corectƒÉ
            let win = true;
            for (let i = 0; i < boardState.length; i++) {
                if (boardState[i] !== i) {
                    win = false;
                    break;
                }
            }
            if (win) {
                document.getElementById('message').textContent = 'üéâ FelicitƒÉri! Ai rezolvat puzzle-ul!';
                document.getElementById('message').id = 'win-message';
            }
        }
    </script>
</body>
</html>


