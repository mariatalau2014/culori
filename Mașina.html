

<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>üèéÔ∏è VitezƒÉ 150 km/h</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      touch-action: none;
    }
    body {
      background: linear-gradient(180deg, #0a0a0a 0%, #1a1a2e 50%, #0f3460 100%);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      font-family: 'Arial Black', 'Impact', sans-serif;
      overflow: hidden;
      user-select: none;
    }
    #gameContainer {
      position: relative;
      width: 420px;
      max-width: 98vw;
    }
    canvas {
      background: linear-gradient(180deg, #0a0a0a 0%, #0a0a0a 35%, #1a1a1a 35%, #2a2a2a 100%);
      border: 5px solid #ff0040;
      border-radius: 15px 15px 0 0;
      display: block;
      margin: 0 auto;
      box-shadow: 0 0 50px rgba(255, 0, 64, 0.7);
    }
    
    /* === ZONE DE CONTROL === */
    #touchControls {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 140px;
      display: flex;
      z-index: 5;
    }
    .touchZone {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.1s;
    }
    .touchZone:active, .touchZone.active {
      background: rgba(255, 0, 64, 0.3);
    }
    .touchZone.left {
      border-right: 3px dashed rgba(255, 0, 64, 0.4);
    }
    .touchHint {
      font-size: 50px;
      opacity: 0.3;
    }
    
    /* === VOLAN === */
    #steeringWheel {
      position: absolute;
      bottom: 15px;
      left: 50%;
      transform: translateX(-50%);
      width: 100px;
      height: 100px;
      z-index: 20;
    }
    #wheelBase {
      position: absolute;
      width: 100%;
      height: 100%;
      background: linear-gradient(145deg, #1a1a1a, #0d0d0d);
      border-radius: 50%;
      border: 4px solid #ff0040;
      box-shadow: 0 4px 20px rgba(255, 0, 64, 0.8), inset 0 2px 8px rgba(255,255,255,0.1);
    }
    #wheelRim {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 85px;
      height: 85px;
      border-radius: 50%;
      border: 8px solid #ff0040;
      background: transparent;
    }
    #wheelCenter {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 35px;
      height: 35px;
      background: linear-gradient(145deg, #ff0040, #cc0033);
      border-radius: 50%;
      border: 3px solid #ff6666;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      box-shadow: 0 2px 15px rgba(255, 0, 64, 0.7);
    }
    #wheelSpoke1, #wheelSpoke2, #wheelSpoke3 {
      position: absolute;
      top: 50%;
      left: 50%;
      background: linear-gradient(90deg, #ff0040, #ff6666);
      transform-origin: left center;
      border-radius: 5px;
    }
    #wheelSpoke1 {
      width: 45px;
      height: 8px;
      transform: translate(-50%, -50%) rotate(90deg);
    }
    #wheelSpoke2 {
      width: 45px;
      height: 8px;
      transform: translate(-50%, -50%) rotate(-30deg);
    }
    #wheelSpoke3 {
      width: 45px;
      height: 8px;
      transform: translate(-50%, -50%) rotate(210deg);
    }
    #wheelRotation {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      transition: transform 0.05s ease-out;
    }
    #wheelIndicator {
      position: absolute;
      top: 6px;
      left: 50%;
      transform: translateX(-50%);
      width: 6px;
      height: 12px;
      background: #ff6666;
      border-radius: 3px;
      box-shadow: 0 0 15px #ff6666;
    }
    #speedDisplay {
      position: absolute;
      bottom: -35px;
      left: 50%;
      transform: translateX(-50%);
      color: #ff0040;
      font-size: 20px;
      font-weight: bold;
      white-space: nowrap;
      text-shadow: 0 0 15px #ff0040;
    }
    #scoreDisplay {
      position: absolute;
      bottom: -58px;
      left: 50%;
      transform: translateX(-50%);
      color: #00ff88;
      font-size: 18px;
      font-weight: bold;
      white-space: nowrap;
      text-shadow: 0 0 15px #00ff88;
    }
    
    /* === BUTON PAUZƒÇ === */
    #pauseBtn {
      position: absolute;
      bottom: 145px;
      right: 10px;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      font-size: 20px;
      z-index: 25;
      border: 3px solid #ff0040;
      background: linear-gradient(145deg, #0f3460, #0a2540);
      color: #00ff88;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: 0 3px 15px rgba(0, 255, 136, 0.5);
    }
    #pauseBtn:active {
      transform: scale(0.9);
    }
    
    /* === ECRANE === */
    #startScreen, #gameOver, #levelUp, #pauseScreen {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: calc(100% - 120px);
      background: rgba(10, 10, 10, 0.97);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      color: #ff0040;
      border-radius: 15px 15px 0 0;
      text-align: center;
      padding: 20px;
      z-index: 30;
    }
    #startScreen h1 {
      font-size: 38px;
      margin-bottom: 12px;
      color: #ff0040;
      text-shadow: 0 0 25px #ff0040;
      letter-spacing: 3px;
      animation: glow 1.5s infinite;
    }
    @keyframes glow {
      0%, 100% { text-shadow: 0 0 20px #ff0040; }
      50% { text-shadow: 0 0 40px #ff0040, 0 0 60px #ff0040; }
    }
    #gameOver h2, #levelUp h2 {
      font-size: 34px;
      margin-bottom: 15px;
      color: #ff0040;
      text-shadow: 0 0 20px #ff0040;
    }
    .info-text {
      margin: 10px 0;
      font-size: 16px;
      max-width: 300px;
      color: #00ff88;
      font-weight: bold;
      line-height: 1.4;
    }
    .emoji-row {
      font-size: 35px;
      margin: 8px 0;
    }
    .stat-row {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      margin: 8px 0;
      padding: 12px 18px;
      background: rgba(255, 0, 64, 0.2);
      border-radius: 10px;
      font-size: 16px;
      font-weight: bold;
      color: #ff0040;
      border: 2px solid #ff0040;
    }
    .speed-stat {
      background: rgba(0, 255, 136, 0.2);
      color: #00ff88;
      border-color: #00ff88;
    }
    .actionBtn {
      margin-top: 20px;
      background: linear-gradient(145deg, #ff0040, #cc0033);
      color: white;
      border: none;
      padding: 18px 45px;
      border-radius: 30px;
      font-size: 22px;
      font-weight: bold;
      font-family: 'Arial Black', sans-serif;
      cursor: pointer;
      box-shadow: 0 5px 25px rgba(255, 0, 64, 0.7);
      transition: all 0.2s;
      border: 3px solid #ff6666;
      text-transform: uppercase;
      letter-spacing: 2px;
    }
    .actionBtn:active {
      transform: scale(0.95);
    }
    .hidden {
      display: none !important;
    }
    
    /* === POWER-UP INDICATOR === */
    #powerUpIndicator {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 8px;
      z-index: 10;
    }
    .power-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      border: 3px solid white;
      box-shadow: 0 4px 15px rgba(0,0,0,0.5);
    }
    .shield { background: linear-gradient(145deg, #00d9ff, #0099cc); }
    .speed { background: linear-gradient(145deg, #ff6666, #ff0040); }
    .double { background: linear-gradient(145deg, #ffd700, #ffaa00); }
    
    /* === SPEED LINES === */
    .speed-line {
      position: absolute;
      width: 4px;
      height: 80px;
      background: linear-gradient(180deg, transparent, #ff0040, transparent);
      animation: speedFall 0.25s linear infinite;
    }
    @keyframes speedFall {
      0% { transform: translateY(-100px); opacity: 0; }
      50% { opacity: 1; }
      100% { transform: translateY(550px); opacity: 0; }
    }
    
    /* === VIBRA»öIE === */
    @keyframes vibrate {
      0%, 100% { transform: translateX(-50%) rotate(0deg); }
      25% { transform: translateX(-50%) rotate(-6deg); }
      75% { transform: translateX(-50%) rotate(6deg); }
    }
    .vibrating {
      animation: vibrate 0.08s infinite;
    }
    
    /* === EXPLOSION EFFECT === */
    .explosion {
      position: absolute;
      width: 100px;
      height: 100px;
      background: radial-gradient(circle, #ff6666 0%, #ff0040 50%, transparent 70%);
      border-radius: 50%;
      animation: explode 0.4s ease-out forwards;
    }
    @keyframes explode {
      0% { transform: scale(0.5); opacity: 1; }
      100% { transform: scale(2.5); opacity: 0; }
    }
    
    /* === SPEED METER === */
    #speedMeter {
      position: absolute;
      top: 60px;
      right: 15px;
      width: 70px;
      height: 70px;
      background: rgba(0, 0, 0, 0.8);
      border: 3px solid #00ff88;
      border-radius: 50%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 10;
      box-shadow: 0 0 20px rgba(0, 255, 136, 0.5);
    }
    #speedValue {
      font-size: 24px;
      color: #00ff88;
      font-weight: bold;
      text-shadow: 0 0 10px #00ff88;
    }
    #speedLabel {
      font-size: 10px;
      color: #00ff88;
    }
  </style>
</head>
<body>
  <div id="gameContainer">
    <canvas id="game" width="420" height="520"></canvas>
    
    <!-- ZONE DE CONTROL -->
    <div id="touchControls">
      <div class="touchZone left" id="touchLeft">
        <span class="touchHint">‚¨ÖÔ∏è</span>
      </div>
      <div class="touchZone right" id="touchRight">
        <span class="touchHint">‚û°Ô∏è</span>
      </div>
    </div>
    
    <!-- BUTON PAUZƒÇ -->
    <button id="pauseBtn">‚è∏Ô∏è</button>
    
    <!-- SPEED METER -->
    <div id="speedMeter">
      <div id="speedValue">0</div>
      <div id="speedLabel">km/h</div>
    </div>
    
    <!-- POWER-UP INDICATOR -->
    <div id="powerUpIndicator"></div>
    
    <!-- VOLAN -->
    <div id="steeringWheel">
      <div id="wheelRotation">
        <div id="wheelBase"></div>
        <div id="wheelRim"></div>
        <div id="wheelSpoke1"></div>
        <div id="wheelSpoke2"></div>
        <div id="wheelSpoke3"></div>
        <div id="wheelCenter">üèéÔ∏è</div>
        <div id="wheelIndicator"></div>
      </div>
      <div id="speedDisplay">‚ö° VITEZA: <span id="speedVal">150</span> km/h</div>
      <div id="scoreDisplay">‚≠ê PUNCTE: <span id="scoreVal">0</span> / 50</div>
    </div>
    
    <!-- ECRANE -->
    <div id="startScreen">
      <h1>üèéÔ∏è 150 KM/H üèéÔ∏è</h1>
      <p class="info-text">üë¶ Salut, pilot de curse!</p>
      <div class="emoji-row">üñêÔ∏è Atinge ST√ÇNGA sau DREAPTA!</div>
      <div class="emoji-row">üéÆ Sau √Ænv√¢rte VOLANUL!</div>
      <div class="stat-row speed-stat">üöÄ VITEZA MAXIMƒÇ: 150 km/h</div>
      <div class="stat-row">üüß EVITƒÇ OBSTACOLELE!</div>
      <div class="stat-row">üí• DACƒÇ TE LOVE»òTI - PIERZI!</div>
      <div class="stat-row">‚≠ê ADUNƒÇ 50 DE PUNCTE!</div>
      <button class="actionBtn" id="startBtn">üöÄ START!</button>
    </div>
    
    <div id="gameOver" class="hidden">
      <h2>üí• CRASH!</h2>
      <div class="stat-row">
        <span>‚≠ê Puncte:</span>
        <span id="finalScore">0</span>
      </div>
      <div class="stat-row speed-stat">
        <span>üöÄ VitezƒÉ:</span>
        <span id="finalSpeed">0</span> km/h
      </div>
      <div class="stat-row">
        <span>üèÜ Record:</span>
        <span id="personalBest">0</span>
      </div>
      <p id="message" class="info-text">Mai √ÆncearcƒÉ, campionule!</p>
      <button class="actionBtn" id="restartBtn">üîÑ DIN NOU!</button>
    </div>
    
    <div id="levelUp" class="hidden">
      <h2>üéâ NIVEL NOU!</h2>
      <p id="levelUpText" class="info-text">Viteza cre»ôte!</p>
      <div class="emoji-row">üèéÔ∏èüí®üî•</div>
      <button class="actionBtn" id="continueBtn">‚ñ∂ CONTINUƒÇ!</button>
    </div>
    
    <div id="pauseScreen" class="hidden">
      <h2>‚è∏Ô∏è PAUZƒÇ</h2>
      <p class="info-text">ApasƒÉ pe buton pentru a continua!</p>
      <div class="emoji-row">üèéÔ∏è</div>
      <button class="actionBtn" id="resumeBtn">‚ñ∂ CONTINUƒÇ!</button>
    </div>
  </div>

  <script>
    // === CONFIG ===
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const scoreVal = document.getElementById('scoreVal');
    const speedVal = document.getElementById('speedVal');
    const speedValue = document.getElementById('speedValue');
    const finalScoreEl = document.getElementById('finalScore');
    const finalSpeedEl = document.getElementById('finalSpeed');
    const personalBestEl = document.getElementById('personalBest');
    const messageEl = document.getElementById('message');
    const levelUpText = document.getElementById('levelUpText');
    const startScreen = document.getElementById('startScreen');
    const gameOverScreen = document.getElementById('gameOver');
    const levelUpScreen = document.getElementById('levelUp');
    const pauseScreen = document.getElementById('pauseScreen');
    const powerUpIndicator = document.getElementById('powerUpIndicator');
    const wheelRotation = document.getElementById('wheelRotation');
    const touchLeft = document.getElementById('touchLeft');
    const touchRight = document.getElementById('touchRight');
    
    const startBtn = document.getElementById('startBtn');
    const restartBtn = document.getElementById('restartBtn');
    const continueBtn = document.getElementById('continueBtn');
    const resumeBtn = document.getElementById('resumeBtn');
    const pauseBtn = document.getElementById('pauseBtn');

    // === AUDIO ===
    let soundEnabled = true;
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    
    function playSound(type) {
      if (!soundEnabled) return;
      try {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        
        const now = audioCtx.currentTime;
        
        switch(type) {
          case 'score':
            osc.frequency.setValueAtTime(440, now);
            osc.frequency.setValueAtTime(554, now + 0.06);
            osc.frequency.setValueAtTime(659, now + 0.12);
            gain.gain.setValueAtTime(0.15, now);
            gain.gain.exponentialRampToValueAtTime(0.01, now + 0.18);
            osc.start(now);
            osc.stop(now + 0.18);
            break;
          case 'powerup':
            osc.frequency.setValueAtTime(523, now);
            osc.frequency.exponentialRampToValueAtTime(1047, now + 0.2);
            gain.gain.setValueAtTime(0.2, now);
            gain.gain.exponentialRampToValueAtTime(0.01, now + 0.2);
            osc.start(now);
            osc.stop(now + 0.2);
            break;
          case 'collision':
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(150, now);
            osc.frequency.exponentialRampToValueAtTime(40, now + 0.35);
            gain.gain.setValueAtTime(0.35, now);
            gain.gain.exponentialRampToValueAtTime(0.01, now + 0.35);
            osc.start(now);
            osc.stop(now + 0.35);
            break;
          case 'win':
            const notes = [523, 659, 784, 1047, 1319, 1568];
            notes.forEach((freq, i) => {
              setTimeout(() => {
                const o = audioCtx.createOscillator();
                const g = audioCtx.createGain();
                o.connect(g);
                g.connect(audioCtx.destination);
                o.frequency.value = freq;
                o.type = 'square';
                g.gain.setValueAtTime(0.15, audioCtx.currentTime);
                g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.12);
                o.start();
                o.stop(audioCtx.currentTime + 0.12);
              }, i * 100);
            });
            break;
        }
      } catch(e) {}
    }

    // === STARE JOC ===
    let gameRunning = false;
    let gamePaused = false;
    let score = 0;
    let baseSpeed = 8;
    let currentSpeed = 8;
    let level = 1;
    let animationId;
    let highScore = localStorage.getItem('carGameHighScore') || 0;
    
    // Viteza √Æn km/h pentru afi»ôaj
    const SPEED_DISPLAY = 150;
    
    // === MA»òINA ===
    const car = {
      x: canvas.width / 2 - 30,
      y: canvas.height - 110,
      width: 60,
      height: 80,
      speed: 10,
      color: '#ff0040',
      shield: false,
      shieldTime: 0,
      angle: 0
    };
    
    // === OBSTACOLE ===
    let obstacles = [];
    let powerUps = [];
    const obstacleColors = ['#ff6666', '#ffd700', '#ff8c00'];
    const powerUpTypes = [
      { color: '#00d9ff', effect: 'shield', icon: 'üõ°Ô∏è', duration: 3500 },
      { color: '#00ff88', effect: 'speed', icon: '‚ö°', duration: 2500 },
      { color: '#ffd700', effect: 'double', icon: 'üíé', duration: 3000 }
    ];
    
    // === NIVELURI (VITEZE MARI) ===
    const levels = [
      { score: 0, speed: 8, obstacleRate: 1200, name: 'ROOKIE', kmh: 150 },
      { score: 15, speed: 10, obstacleRate: 1000, name: 'RACER', kmh: 180 },
      { score: 30, speed: 12, obstacleRate: 800, name: 'PRO', kmh: 220 },
      { score: 45, speed: 14, obstacleRate: 600, name: 'LEGEND', kmh: 250 }
    ];
    
    // === CONTROALE ===
    let steeringAngle = 0;
    let lastObstacleTime = 0;
    let lastPowerUpTime = 0;
    
    // === VOLAN ===
    let isDragging = false;
    const maxSteerAngle = 45;
    
    function updateSteering(clientX) {
      const rect = document.getElementById('steeringWheel').getBoundingClientRect();
      const centerX = rect.left + rect.width / 2;
      const deltaX = clientX - centerX;
      const maxDelta = 60;
      steeringAngle = Math.max(-1, Math.min(1, deltaX / maxDelta));
      
      const rotation = steeringAngle * maxSteerAngle;
      wheelRotation.style.transform = `rotate(${rotation}deg)`;
    }
    
    document.getElementById('steeringWheel').addEventListener('mousedown', (e) => {
      if (!gameRunning || gamePaused) return;
      isDragging = true;
      updateSteering(e.clientX);
    });
    
    document.addEventListener('mousemove', (e) => {
      if (!isDragging) return;
      updateSteering(e.clientX);
    });
    
    document.addEventListener('mouseup', () => {
      isDragging = false;
      steeringAngle = 0;
      wheelRotation.style.transform = 'rotate(0deg)';
    });
    
    document.getElementById('steeringWheel').addEventListener('touchstart', (e) => {
      if (!gameRunning || gamePaused) return;
      e.preventDefault();
      isDragging = true;
      updateSteering(e.touches[0].clientX);
    }, { passive: false });
    
    document.addEventListener('touchmove', (e) => {
      if (!isDragging) return;
      updateSteering(e.touches[0].clientX);
    }, { passive: false });
    
    document.addEventListener('touchend', () => {
      isDragging = false;
      steeringAngle = 0;
      wheelRotation.style.transform = 'rotate(0deg)';
    });
    
    // === ZONE TOUCH ===
    function handleTouchLeft(e) {
      e.preventDefault();
      if (!gameRunning || gamePaused) return;
      steeringAngle = -1;
      wheelRotation.style.transform = `rotate(-${maxSteerAngle}deg)`;
      touchLeft.classList.add('active');
    }
    
    function handleTouchRight(e) {
      e.preventDefault();
      if (!gameRunning || gamePaused) return;
      steeringAngle = 1;
      wheelRotation.style.transform = `rotate(${maxSteerAngle}deg)`;
      touchRight.classList.add('active');
    }
    
    function releaseTouch() {
      steeringAngle = 0;
      wheelRotation.style.transform = 'rotate(0deg)';
      touchLeft.classList.remove('active');
      touchRight.classList.remove('active');
    }
    
    touchLeft.addEventListener('touchstart', handleTouchLeft, { passive: false });
    touchLeft.addEventListener('touchend', releaseTouch);
    touchLeft.addEventListener('mousedown', handleTouchLeft);
    touchLeft.addEventListener('mouseup', releaseTouch);
    touchLeft.addEventListener('mouseleave', releaseTouch);
    
    touchRight.addEventListener('touchstart', handleTouchRight, { passive: false });
    touchRight.addEventListener('touchend', releaseTouch);
    touchRight.addEventListener('mousedown', handleTouchRight);
    touchRight.addEventListener('mouseup', releaseTouch);
    touchRight.addEventListener('mouseleave', releaseTouch);
    
    // === TASTATURƒÇ ===
    window.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowLeft') {
        steeringAngle = -1;
        wheelRotation.style.transform = `rotate(-${maxSteerAngle}deg)`;
      }
      if (e.key === 'ArrowRight') {
        steeringAngle = 1;
        wheelRotation.style.transform = `rotate(${maxSteerAngle}deg)`;
      }
      if (e.key === 'Escape' && gameRunning) togglePause();
      if (e.key === ' ' && gameRunning) togglePause();
    });
    
    window.addEventListener('keyup', (e) => {
      if (e.key === 'ArrowLeft' || e.key === 'ArrowRight') {
        steeringAngle = 0;
        wheelRotation.style.transform = 'rotate(0deg)';
      }
    });
    
    // === BUTOANE ===
    pauseBtn.addEventListener('click', () => {
      if (gameRunning) togglePause();
    });
    
    function resetCar() {
      car.x = canvas.width / 2 - 30;
      car.shield = false;
      car.angle = 0;
      updatePowerUpIndicator();
      steeringAngle = 0;
      wheelRotation.style.transform = 'rotate(0deg)';
    }
    
    // === START JOC ===
    function startGame() {
      startScreen.classList.add('hidden');
      gameOverScreen.classList.add('hidden');
      levelUpScreen.classList.add('hidden');
      pauseScreen.classList.add('hidden');
      
      score = 0;
      level = 1;
      baseSpeed = levels[0].speed;
      currentSpeed = baseSpeed;
      scoreVal.textContent = score;
      speedVal.textContent = levels[0].kmh;
      speedValue.textContent = levels[0].kmh;
      
      resetCar();
      obstacles = [];
      powerUps = [];
      lastObstacleTime = Date.now();
      lastPowerUpTime = Date.now();
      
      gameRunning = true;
      gamePaused = false;
      gameLoop();
      spawnLoop();
    }
    
    startBtn.addEventListener('click', startGame);
    restartBtn.addEventListener('click', startGame);
    continueBtn.addEventListener('click', () => {
      levelUpScreen.classList.add('hidden');
      gameRunning = true;
      gameLoop();
      spawnLoop();
    });
    resumeBtn.addEventListener('click', togglePause);
    
    // === PAUZƒÇ ===
    function togglePause() {
      if (!gameRunning) return;
      gamePaused = !gamePaused;
      if (gamePaused) {
        cancelAnimationFrame(animationId);
        pauseScreen.classList.remove('hidden');
      } else {
        pauseScreen.classList.add('hidden');
        gameLoop();
        spawnLoop();
      }
    }
    
    // === SPAWN ===
    function spawnLoop() {
      if (!gameRunning || gamePaused) return;
      
      const currentLevel = levels[Math.min(level - 1, levels.length - 1)];
      const now = Date.now();
      
      if (now - lastObstacleTime > currentLevel.obstacleRate) {
        spawnObstacle();
        lastObstacleTime = now;
      }
      
      if (now - lastPowerUpTime > 4000) {
        if (Math.random() < 0.6) spawnPowerUp();
        lastPowerUpTime = now;
      }
      
      setTimeout(spawnLoop, 80);
    }
    
    function spawnObstacle() {
      if (!gameRunning || gamePaused) return;
      const color = obstacleColors[Math.floor(Math.random() * obstacleColors.length)];
      const width = 50 + Math.random() * 35;
      obstacles.push({
        x: Math.random() * (canvas.width - width),
        y: -60,
        width: width,
        height: 50,
        color: color,
        passed: false,
        emoji: ['üüß', 'üöß', 'ü™®', 'üõ¢Ô∏è'][Math.floor(Math.random() * 4)]
      });
    }
    
    function spawnPowerUp() {
      if (!gameRunning || gamePaused) return;
      const type = powerUpTypes[Math.floor(Math.random() * powerUpTypes.length)];
      powerUps.push({
        x: Math.random() * (canvas.width - 45),
        y: -50,
        width: 45,
        height: 45,
        ...type,
        collected: false
      });
    }
    
    // === COLIZIUNE ===
    function checkCollision(a, b) {
      return a.x < b.x + b.width && a.x + a.width > b.x &&
             a.y < b.y + b.height && a.y + a.height > b.y;
    }
    
    // === POWER-UP ===
    function updatePowerUpIndicator() {
      powerUpIndicator.innerHTML = '';
      if (car.shield) {
        const icon = document.createElement('div');
        icon.className = 'power-icon shield';
        icon.textContent = 'üõ°Ô∏è';
        powerUpIndicator.appendChild(icon);
      }
    }
    
    function activatePowerUp(type) {
      playSound('powerup');
      switch(type) {
        case 'shield':
          car.shield = true;
          car.shieldTime = Date.now() + 3500;
          break;
        case 'speed':
          currentSpeed = Math.min(16, currentSpeed + 3);
          const currentLevel = levels[Math.min(level - 1, levels.length - 1)];
          speedVal.textContent = currentLevel.kmh + 50;
          speedValue.textContent = currentLevel.kmh + 50;
          setTimeout(() => {
            currentSpeed = baseSpeed;
            speedVal.textContent = currentLevel.kmh;
            speedValue.textContent = currentLevel.kmh;
          }, 2500);
          break;
        case 'double':
          score = Math.min(50, score + 3);
          scoreVal.textContent = score;
          break;
      }
      updatePowerUpIndicator();
    }
    
    function checkPowerUpExpiry() {
      const now = Date.now();
      if (car.shield && now > car.shieldTime) {
        car.shield = false;
        updatePowerUpIndicator();
      }
    }
    
    function checkLevelUp() {
      const nextLevel = levels[Math.min(level, levels.length - 1)];
      if (score >= nextLevel.score && level < levels.length) {
        level++;
        baseSpeed = levels[level - 1].speed;
        currentSpeed = baseSpeed;
        speedVal.textContent = levels[level - 1].kmh;
        speedValue.textContent = levels[level - 1].kmh;
        playSound('win');
        gameRunning = false;
        cancelAnimationFrame(animationId);
        levelUpText.textContent = `Nivel ${level}: ${levels[level-1].name} - ${levels[level-1].kmh} km/h!`;
        levelUpScreen.classList.remove('hidden');
      }
    }
    
    function checkWin() {
      if (score >= 50) {
        gameRunning = false;
        cancelAnimationFrame(animationId);
        messageEl.textContent = 'E»òTI UN LEGENDƒÇ A CURSELOR! üèÜüî•';
        playSound('win');
        createExplosion(canvas.width/2, canvas.height/2);
        endGame();
      }
    }
    
    // === EXPLOSION EFFECT ===
    function createExplosion(x, y) {
      const explosion = document.createElement('div');
      explosion.className = 'explosion';
      explosion.style.left = (x - 50) + 'px';
      explosion.style.top = (y - 50) + 'px';
      document.getElementById('gameContainer').appendChild(explosion);
      setTimeout(() => explosion.remove(), 400);
    }
    
    // === DESENARE ===
    function drawCar() {
      ctx.save();
      ctx.translate(car.x + car.width/2, car.y + car.height/2);
      ctx.rotate(car.angle * Math.PI / 180);
      ctx.translate(-car.width/2, -car.height/2);
      
      // UmbrƒÉ
      ctx.fillStyle = 'rgba(0,0,0,0.5)';
      ctx.fillRect(5, 5, car.width, car.height);
      
      // Corp ma»ôinƒÉ - formƒÉ de curse
      ctx.fillStyle = car.color;
      ctx.beginPath();
      ctx.moveTo(12, 0);
      ctx.lineTo(car.width - 12, 0);
      ctx.lineTo(car.width, 22);
      ctx.lineTo(car.width, car.height - 12);
      ctx.lineTo(car.width - 12, car.height);
      ctx.lineTo(12, car.height);
      ctx.lineTo(0, car.height - 12);
      ctx.lineTo(0, 22);
      ctx.closePath();
      ctx.fill();
      
      // Dungi de curse
      ctx.fillStyle = '#0a0a0a';
      ctx.fillRect(car.width/2 - 10, 0, 20, car.height);
      
      // BordurƒÉ dungi
      ctx.strokeStyle = '#ff6666';
      ctx.lineWidth = 3;
      ctx.strokeRect(car.width/2 - 10, 0, 20, car.height);
      
      // Geam
      ctx.fillStyle = '#00ff88';
      ctx.beginPath();
      ctx.moveTo(18, 28);
      ctx.lineTo(car.width - 18, 28);
      ctx.lineTo(car.width - 14, 48);
      ctx.lineTo(14, 48);
      ctx.closePath();
      ctx.fill();
      
      // AripioarƒÉ spate
      ctx.fillStyle = '#0a0a0a';
      ctx.fillRect(8, car.height - 18, car.width - 16, 15);
      
      // Ro»õi
      ctx.fillStyle = '#0a0a0a';
      ctx.fillRect(-10, 20, 14, 25);
      ctx.fillRect(car.width - 4, 20, 14, 25);
      ctx.fillRect(-10, car.height - 28, 14, 25);
      ctx.fillRect(car.width - 4, car.height - 28, 14, 25);
      
      // Detalii ro»õi
      ctx.fillStyle = '#ff0040';
      ctx.beginPath();
      ctx.arc(-2, 32, 6, 0, Math.PI * 2);
      ctx.arc(car.width + 2, 32, 6, 0, Math.PI * 2);
      ctx.arc(-2, car.height - 15, 6, 0, Math.PI * 2);
      ctx.arc(car.width + 2, car.height - 15, 6, 0, Math.PI * 2);
      ctx.fill();
      
      // Faruri
      ctx.fillStyle = '#ffd700';
      ctx.beginPath();
      ctx.ellipse(18, 4, 10, 6, 0, 0, Math.PI * 2);
      ctx.ellipse(car.width - 18, 4, 10, 6, 0, 0, Math.PI * 2);
      ctx.fill();
      
      // LuminƒÉ faruri
      ctx.fillStyle = 'rgba(255, 215, 0, 0.4)';
      ctx.beginPath();
      ctx.moveTo(12, 0);
      ctx.lineTo(5, -40);
      ctx.lineTo(25, -40);
      ctx.lineTo(25, 0);
      ctx.fill();
      ctx.beginPath();
      ctx.moveTo(car.width - 25, 0);
      ctx.lineTo(car.width - 25, -40);
      ctx.lineTo(car.width - 5, -40);
      ctx.lineTo(car.width - 12, 0);
      ctx.fill();
      
      // Flame la spate (vitezƒÉ mare)
      const flameIntensity = currentSpeed / 14;
      ctx.fillStyle = `rgba(255, ${100 - flameIntensity * 50}, 0, 0.9)`;
      for (let i = 0; i < 3; i++) {
        const fx = car.width/2 - 15 + i * 15;
        const fy = car.height + 5 + Math.random() * 20 * flameIntensity;
        ctx.beginPath();
        ctx.moveTo(fx - 5, car.height);
        ctx.lineTo(fx, fy);
        ctx.lineTo(fx + 5, car.height);
        ctx.closePath();
        ctx.fill();
      }
      
      // Scut
      if (car.shield) {
        ctx.strokeStyle = 'rgba(0, 217, 255, 0.9)';
        ctx.lineWidth = 4;
        ctx.beginPath();
        ctx.ellipse(car.width/2, car.height/2, car.width * 0.85, car.height * 0.75, 0, 0, Math.PI * 2);
        ctx.stroke();
        ctx.fillStyle = 'rgba(0, 217, 255, 0.15)';
        ctx.fill();
        
        // Particule scut
        for (let i = 0; i < 8; i++) {
          const angle = Date.now() / 150 + i * (Math.PI * 2 / 8);
          const px = car.width/2 + Math.cos(angle) * car.width * 0.7;
          const py = car.height/2 + Math.sin(angle) * car.height * 0.6;
          ctx.fillStyle = 'rgba(0, 217, 255, 0.8)';
          ctx.beginPath();
          ctx.arc(px, py, 4, 0, Math.PI * 2);
          ctx.fill();
        }
      }
      
      ctx.restore();
    }
    
    function drawObstacle(obs) {
      ctx.fillStyle = 'rgba(0,0,0,0.5)';
      ctx.fillRect(obs.x + 5, obs.y + 5, obs.width, obs.height);
      
      const gradient = ctx.createLinearGradient(obs.x, obs.y, obs.x, obs.y + obs.height);
      gradient.addColorStop(0, obs.color);
      gradient.addColorStop(1, 'rgba(0,0,0,0.5)');
      ctx.fillStyle = gradient;
      ctx.fillRect(obs.x, obs.y, obs.width, obs.height);
      
      ctx.strokeStyle = 'rgba(255,255,255,0.7)';
      ctx.lineWidth = 3;
      ctx.strokeRect(obs.x, obs.y, obs.width, obs.height);
      
      // Dungi pericol
      ctx.fillStyle = 'rgba(0,0,0,0.4)';
      for (let i = 0; i < 4; i++) {
        ctx.beginPath();
        ctx.moveTo(obs.x + i * 18, obs.y);
        ctx.lineTo(obs.x + i * 18 + 18, obs.y + obs.height);
        ctx.lineTo(obs.x + i * 18 + 12, obs.y + obs.height);
        ctx.lineTo(obs.x + i * 18 - 6, obs.y);
        ctx.closePath();
        ctx.fill();
      }
      
      ctx.fillStyle = 'white';
      ctx.font = 'bold 30px Arial';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillText(obs.emoji, obs.x + obs.width/2, obs.y + obs.height/2);
    }
    
    function drawPowerUp(pu) {
      const glow = ctx.createRadialGradient(
        pu.x + pu.width/2, pu.y + pu.height/2, 0,
        pu.x + pu.width/2, pu.y + pu.height/2, pu.width * 1.8
      );
      glow.addColorStop(0, pu.color + 'BB');
      glow.addColorStop(1, 'transparent');
      ctx.fillStyle = glow;
      ctx.fillRect(pu.x - 20, pu.y - 20, pu.width + 40, pu.height + 40);
      
      ctx.fillStyle = pu.color;
      ctx.beginPath();
      ctx.arc(pu.x + pu.width/2, pu.y + pu.height/2, pu.width/2, 0, Math.PI * 2);
      ctx.fill();
      
      ctx.strokeStyle = 'white';
      ctx.lineWidth = 4;
      ctx.stroke();
      
      // Puls effect
      const pulse = 1 + Math.sin(Date.now() / 80) * 0.15;
      ctx.save();
      ctx.translate(pu.x + pu.width/2, pu.y + pu.height/2);
      ctx.scale(pulse, pulse);
      ctx.fillStyle = 'white';
      ctx.font = 'bold 30px Arial';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillText(pu.icon, 0, 0);
      ctx.restore();
    }
    
    function drawRoad() {
      // Asfalt
      ctx.fillStyle = '#1a1a1a';
      ctx.fillRect(25, 0, canvas.width - 50, canvas.height);
      
      // Linii laterale
      ctx.fillStyle = '#fff';
      ctx.fillRect(30, 0, 10, canvas.height);
      ctx.fillRect(canvas.width - 40, 0, 10, canvas.height);
      
      // Linii ro»ôii pe margini (animate)
      ctx.fillStyle = '#ff0040';
      const stripeHeight = 40;
      const stripeGap = 30;
      const offset = (Date.now() / 30 * currentSpeed) % (stripeHeight + stripeGap);
      for (let y = -offset; y < canvas.height; y += stripeHeight + stripeGap) {
        ctx.fillRect(25, y, 5, stripeHeight);
        ctx.fillRect(canvas.width - 30, y, 5, stripeHeight);
      }
      
      // Linii centrale animate
      ctx.setLineDash([50, 40]);
      ctx.lineDashOffset = -Date.now() / 25 * currentSpeed;
      ctx.strokeStyle = '#ffd700';
      ctx.lineWidth = 8;
      ctx.beginPath();
      ctx.moveTo(canvas.width / 2, 0);
      ctx.lineTo(canvas.width / 2, canvas.height);
      ctx.stroke();
      ctx.setLineDash([]);
      
      // Speed lines (multe pentru vitezƒÉ mare)
      ctx.fillStyle = 'rgba(255, 0, 64, 0.15)';
      for (let i = 0; i < 15; i++) {
        const x = 35 + i * 25;
        const y = ((Date.now() / 40 * currentSpeed) + i * 50) % canvas.height;
        ctx.fillRect(x, y, 5, 70);
      }
    }
    
    function drawGrid() {
      // Grid effect pentru senza»õia de vitezƒÉ extremƒÉ
      ctx.strokeStyle = 'rgba(255, 0, 64, 0.2)';
      ctx.lineWidth = 1;
      const gridOffset = (Date.now() / 20 * currentSpeed) % 50;
      for (let y = gridOffset; y < canvas.height; y += 50) {
        ctx.beginPath();
        ctx.moveTo(25, y);
        ctx.lineTo(canvas.width - 25, y);
        ctx.stroke();
      }
      
      // Linii verticale
      for (let x = 50; x < canvas.width - 25; x += 60) {
        ctx.beginPath();
        ctx.moveTo(x, 0);
        ctx.lineTo(x, canvas.height);
        ctx.stroke();
      }
    }
    
    // === UPDATE ===
    function update() {
      checkPowerUpExpiry();
      
      // Mi»ôcare ma»ôinƒÉ
      if (steeringAngle !== 0) {
        car.x += steeringAngle * car.speed;
        car.angle = steeringAngle * 20;
        
        if (car.x < 30) car.x = 30;
        if (car.x > canvas.width - car.width - 30) car.x = canvas.width - car.width - 30;
      } else {
        car.angle *= 0.8;
      }
      
      // Obstacole
      for (let i = obstacles.length - 1; i >= 0; i--) {
        const obs = obstacles[i];
        obs.y += currentSpeed;
        
        if (!obs.passed && obs.y > car.y + car.height) {
          obs.passed = true;
          score++;
          scoreVal.textContent = score;
          playSound('score');
          checkLevelUp();
          checkWin();
        }
        
        if (checkCollision(car, obs)) {
          if (car.shield) {
            car.shield = false;
            obstacles.splice(i, 1);
            updatePowerUpIndicator();
            playSound('powerup');
            createExplosion(obs.x + obs.width/2, obs.y + obs.height/2);
            document.getElementById('steeringWheel').classList.add('vibrating');
            setTimeout(() => {
              document.getElementById('steeringWheel').classList.remove('vibrating');
            }, 250);
          } else {
            // GAME OVER - fƒÉrƒÉ scut
            createExplosion(car.x + car.width/2, car.y + car.height/2);
            playSound('collision');
            endGame();
            return;
          }
        }
        
        if (obs.y > canvas.height) obstacles.splice(i, 1);
      }
      
      // Power-ups
      for (let i = powerUps.length - 1; i >= 0; i--) {
        const pu = powerUps[i];
        pu.y += currentSpeed;
        
        if (checkCollision(car, pu)) {
          activatePowerUp(pu.effect);
          powerUps.splice(i, 1);
          continue;
        }
        
        if (pu.y > canvas.height) powerUps.splice(i, 1);
      }
    }
    
    // === GAME OVER ===
    function endGame() {
      gameRunning = false;
      cancelAnimationFrame(animationId);
      
      finalScoreEl.textContent = score;
      finalSpeedEl.textContent = levels[Math.min(level - 1, levels.length - 1)].kmh;
      
      if (score > highScore) {
        highScore = score;
        localStorage.setItem('carGameHighScore', highScore);
        personalBestEl.textContent = highScore + ' üî•';
      } else {
        personalBestEl.textContent = highScore;
      }
      
      if (score >= 50) {
        messageEl.textContent = 'E»òTI O LEGENDƒÇ! üèÜüî•';
      } else if (score >= 35) {
        messageEl.textContent = 'FOARTE BINE, CAMPIONULE! üí™';
      } else if (score >= 20) {
        messageEl.textContent = 'BINE! MAI PO»öI MAI REPEDE! üöÄ';
      } else {
        messageEl.textContent = '√éNCEARCƒÇ DIN NOU, EROULE! üèéÔ∏è';
      }
      
      gameOverScreen.classList.remove('hidden');
    }
    
    // === GAME LOOP ===
    function gameLoop() {
      if (!gameRunning || gamePaused) return;
      
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      drawGrid();
      drawRoad();
      powerUps.forEach(drawPowerUp);
      obstacles.forEach(drawObstacle);
      drawCar();
      
      update();
      
      animationId = requestAnimationFrame(gameLoop);
    }
    
    // === PREVENIRE SCROLL ===
    document.addEventListener('touchmove', (e) => {
      if (gameRunning) e.preventDefault();
    }, { passive: false });
    
    // === INIT AUDIO ===
    document.addEventListener('click', () => {
      if (audioCtx.state === 'suspended') audioCtx.resume();
    }, { once: true });
  </script>
</body>
</html>




