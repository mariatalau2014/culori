<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>üèéÔ∏è Turbo Hold</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      touch-action: none;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      user-select: none;
    }
    body {
      background: linear-gradient(180deg, #0a0a0a 0%, #1a1a2e 50%, #0f3460 100%);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      font-family: 'Arial Black', 'Impact', sans-serif;
      overflow: hidden;
    }
    #gameContainer {
      position: relative;
      width: 420px;
      max-width: 98vw;
    }
    canvas {
      background: linear-gradient(180deg, #0a0a0a 0%, #0a0a0a 35%, #1a1a1a 35%, #2a2a2a 100%);
      border: 5px solid #ff0040;
      border-radius: 15px 15px 0 0;
      display: block;
      margin: 0 auto;
      box-shadow: 0 0 50px rgba(255, 0, 64, 0.7);
    }
    
    /* === ZONE DE CONTROL === */
    #touchControls {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 200px;
      display: flex;
      z-index: 5;
    }
    .touchZone {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .touchZone:active, .touchZone.active {
      background: rgba(255, 0, 64, 0.3);
    }
    .touchZone.left {
      border-right: 3px dashed rgba(255, 0, 64, 0.4);
    }
    .touchHint {
      font-size: 50px;
      opacity: 0.3;
      color: white;
    }
    
    /* === TURBO BUTTON === */
    #turboButton {
      position: absolute;
      bottom: 110px;
      left: 50%;
      transform: translateX(-50%);
      width: 130px;
      height: 130px;
      border-radius: 50%;
      border: 6px solid #ff0040;
      background: linear-gradient(145deg, #ff0040, #cc0033);
      color: white;
      font-size: 16px;
      font-weight: bold;
      z-index: 100;
      box-shadow: 0 5px 30px rgba(255, 0, 64, 0.8);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-transform: uppercase;
      letter-spacing: 2px;
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
    }
    #turboButton.active {
      box-shadow: 0 0 40px #ff0040, 0 0 80px #ff0040;
      animation: turboPulse 0.15s infinite;
    }
    @keyframes turboPulse {
      0%, 100% { transform: translateX(-50%) scale(1); }
      50% { transform: translateX(-50%) scale(0.95); }
    }
    #turboButton span:first-child {
      font-size: 40px;
      margin-bottom: 3px;
    }
    
    /* === VOLAN === */
    #steeringWheel {
      position: absolute;
      bottom: 15px;
      left: 50%;
      transform: translateX(-50%);
      width: 100px;
      height: 100px;
      z-index: 100;
    }
    #wheelBase {
      position: absolute;
      width: 100%;
      height: 100%;
      background: linear-gradient(145deg, #1a1a1a, #0d0d0d);
      border-radius: 50%;
      border: 4px solid #ff0040;
      box-shadow: 0 4px 20px rgba(255, 0, 64, 0.8);
    }
    #wheelRim {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 85px;
      height: 85px;
      border-radius: 50%;
      border: 8px solid #ff0040;
      background: transparent;
    }
    #wheelCenter {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 35px;
      height: 35px;
      background: linear-gradient(145deg, #ff0040, #cc0033);
      border-radius: 50%;
      border: 3px solid #ff6666;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }
    #wheelSpoke1, #wheelSpoke2, #wheelSpoke3 {
      position: absolute;
      top: 50%;
      left: 50%;
      background: linear-gradient(90deg, #ff0040, #ff6666);
      transform-origin: left center;
      border-radius: 5px;
    }
    #wheelSpoke1 { width: 45px; height: 8px; transform: translate(-50%, -50%) rotate(90deg); }
    #wheelSpoke2 { width: 45px; height: 8px; transform: translate(-50%, -50%) rotate(-30deg); }
    #wheelSpoke3 { width: 45px; height: 8px; transform: translate(-50%, -50%) rotate(210deg); }
    #wheelRotation {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      transition: transform 0.05s ease-out;
    }
    #wheelIndicator {
      position: absolute;
      top: 6px;
      left: 50%;
      transform: translateX(-50%);
      width: 6px;
      height: 12px;
      background: #ff6666;
      border-radius: 3px;
    }
    
    /* === SPEED METER === */
    #speedMeter {
      position: absolute;
      top: 60px;
      right: 15px;
      width: 95px;
      height: 95px;
      background: rgba(0, 0, 0, 0.9);
      border: 4px solid #00ff88;
      border-radius: 50%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 50;
    }
    #speedValue {
      font-size: 32px;
      color: #00ff88;
      font-weight: bold;
    }
    #speedLabel {
      font-size: 11px;
      color: #00ff88;
    }
    #speedBar {
      position: absolute;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      width: 70px;
      height: 8px;
      background: rgba(255,255,255,0.2);
      border-radius: 4px;
      overflow: hidden;
    }
    #speedBarFill {
      height: 100%;
      background: linear-gradient(90deg, #00ff88, #ffdd44, #ff4444);
      width: 20%;
    }
    #turboMode {
      position: absolute;
      top: 5px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 10px;
      color: #ff0040;
      font-weight: bold;
      display: none;
    }
    #turboMode.active { display: block; }
    
    /* === SCORE === */
    #scoreDisplay {
      position: absolute;
      top: 60px;
      left: 15px;
      background: rgba(0, 0, 0, 0.9);
      border: 3px solid #ffd700;
      border-radius: 15px;
      padding: 10px 15px;
      z-index: 50;
    }
    #scoreValue {
      font-size: 22px;
      color: #ffd700;
      font-weight: bold;
    }
    #scoreLabel {
      font-size: 11px;
      color: #ffd700;
    }
    
    /* === BUTON PAUZƒÇ === */
    #pauseBtn {
      position: absolute;
      top: 10px;
      right: 10px;
      width: 45px;
      height: 45px;
      border-radius: 50%;
      font-size: 20px;
      z-index: 100;
      border: 3px solid #ff0040;
      background: #0f3460;
      color: #00ff88;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }
    
    /* === ECRANE === */
    #startScreen, #gameOver {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: calc(100% - 180px);
      background: rgba(10, 10, 10, 0.98);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      color: #ff0040;
      border-radius: 15px 15px 0 0;
      text-align: center;
      padding: 20px;
      z-index: 200;
    }
    #startScreen h1, #gameOver h2 {
      font-size: 30px;
      margin-bottom: 15px;
      text-shadow: 0 0 20px #ff0040;
    }
    .info-text {
      margin: 8px 0;
      font-size: 14px;
      color: #00ff88;
      font-weight: bold;
    }
    .emoji-row {
      font-size: 30px;
      margin: 8px 0;
    }
    .stat-row {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin: 8px 0;
      padding: 10px 15px;
      background: rgba(255, 0, 64, 0.2);
      border-radius: 10px;
      font-size: 14px;
      font-weight: bold;
      color: #ff0040;
      border: 2px solid #ff0040;
    }
    .turbo-info {
      background: rgba(255, 0, 64, 0.3);
      border: 2px solid #ff0040;
      padding: 12px 18px;
      border-radius: 10px;
      margin: 10px 0;
    }
    .actionBtn {
      margin-top: 15px;
      background: linear-gradient(145deg, #ff0040, #cc0033);
      color: white;
      border: none;
      padding: 16px 40px;
      border-radius: 30px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 5px 25px rgba(255, 0, 64, 0.7);
      border: 3px solid #ff6666;
    }
    .hidden { display: none !important; }
    
    /* === SCREEN SHAKE === */
    .shaking {
      animation: screenShake 0.2s infinite;
    }
    @keyframes screenShake {
      0%, 100% { transform: translate(0, 0); }
      25% { transform: translate(-4px, -4px); }
      50% { transform: translate(4px, 4px); }
      75% { transform: translate(-4px, 4px); }
    }
  </style>
</head>
<body>
  <div id="gameContainer">
    <canvas id="game" width="420" height="520"></canvas>
    
    <div id="touchControls">
      <div class="touchZone left" id="touchLeft">
        <span class="touchHint">‚¨ÖÔ∏è</span>
      </div>
      <div class="touchZone right" id="touchRight">
        <span class="touchHint">‚û°Ô∏è</span>
      </div>
    </div>
    
    <button id="pauseBtn">‚è∏Ô∏è</button>
    
    <div id="speedMeter">
      <div id="turboMode">TURBO!</div>
      <div id="speedValue">50</div>
      <div id="speedLabel">km/h</div>
      <div id="speedBar"><div id="speedBarFill"></div></div>
    </div>
    
    <div id="scoreDisplay">
      <div id="scoreValue">0 / 50</div>
      <div id="scoreLabel">‚≠ê PUNCTE</div>
    </div>
    
    <button id="turboButton">
      <span>üöÄ</span>
      <span>TURBO</span>
    </button>
    
    <div id="steeringWheel">
      <div id="wheelRotation">
        <div id="wheelBase"></div>
        <div id="wheelRim"></div>
        <div id="wheelSpoke1"></div>
        <div id="wheelSpoke2"></div>
        <div id="wheelSpoke3"></div>
        <div id="wheelCenter">üèéÔ∏è</div>
        <div id="wheelIndicator"></div>
      </div>
    </div>
    
    <div id="startScreen">
      <h1>üèéÔ∏è TURBO HOLD üèéÔ∏è</h1>
      <p class="info-text">üë¶ »öine apƒÉsat TURBO pentru vitezƒÉ!</p>
      <div class="emoji-row">üñêÔ∏è Atinge st√¢nga/dreapta pentru viraj!</div>
      <div class="turbo-info">
        <p class="info-text" style="color: #ff6666;">‚ö° »öINE APƒÇSAT BUTONUL MARE ‚ö°</p>
        <p class="info-text">Viteza cre»ôte RAPID!</p>
        <p class="info-text">Max: <span style="color: #ff0040;">350 km/h</span></p>
      </div>
      <div class="stat-row">üüß EVITƒÇ OBSTACOLELE!</div>
      <div class="stat-row">üí• DACƒÇ TE LOVE»òTI - PIERZI!</div>
      <button class="actionBtn" id="startBtn">üöÄ START!</button>
    </div>
    
    <div id="gameOver" class="hidden">
      <h2>üí• CRASH!</h2>
      <div class="stat-row">
        <span>‚≠ê Puncte:</span>
        <span id="finalScore">0</span>
      </div>
      <div class="stat-row">
        <span>üöÄ VitezƒÉ:</span>
        <span id="finalSpeed">0</span> km/h
      </div>
      <p id="message" class="info-text">Mai √ÆncearcƒÉ!</p>
      <button class="actionBtn" id="restartBtn">üîÑ DIN NOU!</button>
    </div>
  </div>

  <script>
    // === ELEMENTE ===
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const scoreValue = document.getElementById('scoreValue');
    const speedValue = document.getElementById('speedValue');
    const speedBarFill = document.getElementById('speedBarFill');
    const turboMode = document.getElementById('turboMode');
    const turboButton = document.getElementById('turboButton');
    const finalScoreEl = document.getElementById('finalScore');
    const finalSpeedEl = document.getElementById('finalSpeed');
    const messageEl = document.getElementById('message');
    const startScreen = document.getElementById('startScreen');
    const gameOverScreen = document.getElementById('gameOver');
    const wheelRotation = document.getElementById('wheelRotation');
    const touchLeft = document.getElementById('touchLeft');
    const touchRight = document.getElementById('touchRight');
    const gameContainer = document.getElementById('gameContainer');
    
    // === STARE JOC ===
    let gameRunning = false;
    let gamePaused = false;
    let score = 0;
    let currentSpeed = 50;
    let targetSpeed = 50;
    let isTurbo = false;
    let turboTimer = null;
    let animationId = null;
    let highScore = localStorage.getItem('carHighScore') || 0;
    
    // === MA»òINA ===
    const car = {
      x: canvas.width / 2 - 30,
      y: canvas.height - 110,
      width: 60,
      height: 80,
      steerSpeed: 6,
      color: '#ff0040',
      angle: 0
    };
    
    // === OBSTACOLE ===
    let obstacles = [];
    let lastObstacleTime = 0;
    
    // === CONTROALE ===
    let steerLeft = false;
    let steerRight = false;
    let wheelAngle = 0;
    const maxWheelAngle = 45;
    
    // === SUNETE ===
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    
    function playSound(type) {
      try {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        
        if (type === 'score') {
          osc.frequency.setValueAtTime(440, audioCtx.currentTime);
          osc.frequency.setValueAtTime(659, audioCtx.currentTime + 0.1);
          gain.gain.setValueAtTime(0.15, audioCtx.currentTime);
          gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.15);
          osc.start();
          osc.stop(audioCtx.currentTime + 0.15);
        } else if (type === 'crash') {
          osc.type = 'sawtooth';
          osc.frequency.setValueAtTime(150, audioCtx.currentTime);
          osc.frequency.exponentialRampToValueAtTime(50, audioCtx.currentTime + 0.3);
          gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
          gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
          osc.start();
          osc.stop(audioCtx.currentTime + 0.3);
        } else if (type === 'turbo') {
          osc.frequency.setValueAtTime(300, audioCtx.currentTime);
          osc.frequency.exponentialRampToValueAtTime(600, audioCtx.currentTime + 0.2);
          gain.gain.setValueAtTime(0.15, audioCtx.currentTime);
          gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);
          osc.start();
          osc.stop(audioCtx.currentTime + 0.2);
        } else if (type === 'win') {
          [523, 659, 784, 1047].forEach((freq, i) => {
            setTimeout(() => {
              const o = audioCtx.createOscillator();
              const g = audioCtx.createGain();
              o.connect(g);
              g.connect(audioCtx.destination);
              o.frequency.value = freq;
              g.gain.setValueAtTime(0.15, audioCtx.currentTime);
              g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.15);
              o.start();
              o.stop(audioCtx.currentTime + 0.15);
            }, i * 100);
          });
        }
      } catch(e) {}
    }
    
    // === TURBO BUTTON - FIXAT ===
    function startTurbo() {
      if (!gameRunning || gamePaused || isTurbo) return;
      
      console.log('TURBO START!');
      isTurbo = true;
      turboButton.classList.add('active');
      turboMode.classList.add('active');
      gameContainer.classList.add('shaking');
      playSound('turbo');
      
      // Clear any existing timer
      if (turboTimer) clearInterval(turboTimer);
      
      // Cre»ôte viteza FOARTE RAPID
      turboTimer = setInterval(function() {
        if (targetSpeed < 350) {
          targetSpeed += 30; // +30 km/h la fiecare 50ms
          if (targetSpeed > 350) targetSpeed = 350;
          updateSpeedDisplay();
        }
      }, 50);
    }
    
    function stopTurbo() {
      if (!isTurbo) return;
      
      console.log('TURBO STOP!');
      if (turboTimer) {
        clearInterval(turboTimer);
        turboTimer = null;
      }
      
      isTurbo = false;
      turboButton.classList.remove('active');
      turboMode.classList.remove('active');
      gameContainer.classList.remove('shaking');
      targetSpeed = 50;
      updateSpeedDisplay();
    }
    
    // Mouse events pentru turbo button
    turboButton.addEventListener('mousedown', function(e) {
      e.preventDefault();
      e.stopPropagation();
      startTurbo();
    });
    
    turboButton.addEventListener('mouseup', function(e) {
      e.preventDefault();
      e.stopPropagation();
      stopTurbo();
    });
    
    turboButton.addEventListener('mouseleave', function(e) {
      e.preventDefault();
      stopTurbo();
    });
    
    // Touch events pentru turbo button
    turboButton.addEventListener('touchstart', function(e) {
      e.preventDefault();
      e.stopPropagation();
      startTurbo();
    }, { passive: false });
    
    turboButton.addEventListener('touchend', function(e) {
      e.preventDefault();
      e.stopPropagation();
      stopTurbo();
    });
    
    turboButton.addEventListener('touchcancel', function(e) {
      e.preventDefault();
      stopTurbo();
    });
    
    // === ZONE TOUCH PENTRU VIRAJ ===
    function handleLeftStart(e) {
      e.preventDefault();
      if (!gameRunning || gamePaused) return;
      steerLeft = true;
      steerRight = false;
      wheelAngle = -maxWheelAngle;
      wheelRotation.style.transform = 'rotate(' + wheelAngle + 'deg)';
      touchLeft.classList.add('active');
    }
    
    function handleRightStart(e) {
      e.preventDefault();
      if (!gameRunning || gamePaused) return;
      steerRight = true;
      steerLeft = false;
      wheelAngle = maxWheelAngle;
      wheelRotation.style.transform = 'rotate(' + wheelAngle + 'deg)';
      touchRight.classList.add('active');
    }
    
    function handleRelease(e) {
      e.preventDefault();
      steerLeft = false;
      steerRight = false;
      wheelAngle = 0;
      wheelRotation.style.transform = 'rotate(0deg)';
      touchLeft.classList.remove('active');
      touchRight.classList.remove('active');
    }
    
    touchLeft.addEventListener('touchstart', handleLeftStart, { passive: false });
    touchLeft.addEventListener('touchend', handleRelease);
    touchLeft.addEventListener('mousedown', handleLeftStart);
    touchLeft.addEventListener('mouseup', handleRelease);
    touchLeft.addEventListener('mouseleave', handleRelease);
    
    touchRight.addEventListener('touchstart', handleRightStart, { passive: false });
    touchRight.addEventListener('touchend', handleRelease);
    touchRight.addEventListener('mousedown', handleRightStart);
    touchRight.addEventListener('mouseup', handleRelease);
    touchRight.addEventListener('mouseleave', handleRelease);
    
    // === TASTATURƒÇ ===
    window.addEventListener('keydown', function(e) {
      if (e.key === 'ArrowLeft') {
        steerLeft = true;
        steerRight = false;
        wheelAngle = -maxWheelAngle;
        wheelRotation.style.transform = 'rotate(' + wheelAngle + 'deg)';
      }
      if (e.key === 'ArrowRight') {
        steerRight = true;
        steerLeft = false;
        wheelAngle = maxWheelAngle;
        wheelRotation.style.transform = 'rotate(' + wheelAngle + 'deg)';
      }
      if (e.key === ' ' && gameRunning && !gamePaused) {
        startTurbo();
      }
      if (e.key === 'Escape') {
        if (gameRunning) {
          gameRunning = false;
          cancelAnimationFrame(animationId);
          if (turboTimer) clearInterval(turboTimer);
          startScreen.classList.remove('hidden');
        }
      }
    });
    
    window.addEventListener('keyup', function(e) {
      if (e.key === 'ArrowLeft' || e.key === 'ArrowRight') {
        steerLeft = false;
        steerRight = false;
        wheelAngle = 0;
        wheelRotation.style.transform = 'rotate(0deg)';
      }
      if (e.key === ' ') {
        stopTurbo();
      }
    });
    
    // === BUTON PAUZƒÇ ===
    document.getElementById('pauseBtn').addEventListener('click', function() {
      if (gameRunning) {
        gameRunning = false;
        cancelAnimationFrame(animationId);
        if (turboTimer) clearInterval(turboTimer);
        startScreen.classList.remove('hidden');
      }
    });
    
    // === START/RESTART ===
    document.getElementById('startBtn').addEventListener('click', startGame);
    document.getElementById('restartBtn').addEventListener('click', startGame);
    
    function startGame() {
      // Resume audio context
      if (audioCtx.state === 'suspended') {
        audioCtx.resume();
      }
      
      startScreen.classList.add('hidden');
      gameOverScreen.classList.add('hidden');
      
      score = 0;
      currentSpeed = 50;
      targetSpeed = 50;
      isTurbo = false;
      car.x = canvas.width / 2 - 30;
      car.angle = 0;
      obstacles = [];
      lastObstacleTime = Date.now();
      
      scoreValue.textContent = '0 / 50';
      updateSpeedDisplay();
      
      gameRunning = true;
      gamePaused = false;
      gameLoop();
    }
    
    function updateSpeedDisplay() {
      speedValue.textContent = Math.round(currentSpeed);
      const pct = ((currentSpeed - 50) / (350 - 50)) * 100;
      speedBarFill.style.width = pct + '%';
      
      if (currentSpeed >= 300) {
        speedValue.style.color = '#ff0040';
      } else if (currentSpeed >= 200) {
        speedValue.style.color = '#ffaa44';
      } else {
        speedValue.style.color = '#00ff88';
      }
    }
    
    function getGameSpeed() {
      return 2 + (currentSpeed / 350) * 12;
    }
    
    // === SPAWN OBSTACOLE ===
    function spawnObstacle() {
      const width = 50 + Math.random() * 35;
      obstacles.push({
        x: Math.random() * (canvas.width - width),
        y: -60,
        width: width,
        height: 50,
        emoji: ['üüß', 'üöß', 'ü™®'][Math.floor(Math.random() * 3)]
      });
    }
    
    // === COLIZIUNE ===
    function checkCollision(a, b) {
      return a.x < b.x + b.width && a.x + a.width > b.x &&
             a.y < b.y + b.height && a.y + a.height > b.y;
    }
    
    // === DESENARE ===
    function drawCar() {
      ctx.save();
      ctx.translate(car.x + car.width/2, car.y + car.height/2);
      ctx.rotate(car.angle * Math.PI / 180);
      ctx.translate(-car.width/2, -car.height/2);
      
      // Corp
      ctx.fillStyle = car.color;
      ctx.fillRect(0, 0, car.width, car.height);
      
      // Dungi
      ctx.fillStyle = '#0a0a0a';
      ctx.fillRect(car.width/2 - 10, 0, 20, car.height);
      
      // Geam
      ctx.fillStyle = '#00ff88';
      ctx.fillRect(10, 20, car.width - 20, 25);
      
      // Faruri
      ctx.fillStyle = '#ffd700';
      ctx.fillRect(8, 2, 12, 8);
      ctx.fillRect(car.width - 20, 2, 12, 8);
      
      // Ro»õi
      ctx.fillStyle = '#0a0a0a';
      ctx.fillRect(-8, 15, 12, 20);
      ctx.fillRect(car.width - 4, 15, 12, 20);
      ctx.fillRect(-8, car.height - 25, 12, 20);
      ctx.fillRect(car.width - 4, car.height - 25, 12, 20);
      
      // Turbo effect
      if (isTurbo) {
        ctx.strokeStyle = 'rgba(255, 0, 64, 0.8)';
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.arc(car.width/2, car.height/2, car.width * 0.7, 0, Math.PI * 2);
        ctx.stroke();
      }
      
      ctx.restore();
    }
    
    function drawObstacle(obs) {
      ctx.fillStyle = '#ff6666';
      ctx.fillRect(obs.x, obs.y, obs.width, obs.height);
      ctx.fillStyle = 'white';
      ctx.font = 'bold 28px Arial';
      ctx.textAlign = 'center';
      ctx.fillText(obs.emoji, obs.x + obs.width/2, obs.y + obs.height/2 + 8);
    }
    
    function drawRoad() {
      // Drum
      ctx.fillStyle = '#1a1a1a';
      ctx.fillRect(25, 0, canvas.width - 50, canvas.height);
      
      // Linii
      ctx.fillStyle = '#fff';
      ctx.fillRect(30, 0, 8, canvas.height);
      ctx.fillRect(canvas.width - 38, 0, 8, canvas.height);
      
      // Linii centrale animate
      ctx.setLineDash([40, 35]);
      ctx.lineDashOffset = -Date.now() / 25 * getGameSpeed();
      ctx.strokeStyle = '#ffd700';
      ctx.lineWidth = 6;
      ctx.beginPath();
      ctx.moveTo(canvas.width / 2, 0);
      ctx.lineTo(canvas.width / 2, canvas.height);
      ctx.stroke();
      ctx.setLineDash([]);
      
      // Speed lines
      ctx.fillStyle = 'rgba(255, 0, 64, 0.15)';
      const count = Math.floor(10 + (currentSpeed / 350) * 10);
      for (let i = 0; i < count; i++) {
        const x = 35 + i * 25;
        const y = ((Date.now() / 40 * getGameSpeed()) + i * 50) % canvas.height;
        ctx.fillRect(x, y, 4, 60);
      }
    }
    
    // === UPDATE ===
    function update() {
      // Update speed
      if (currentSpeed < targetSpeed) {
        currentSpeed += 6;
      } else if (currentSpeed > targetSpeed) {
        currentSpeed -= 8;
      }
      currentSpeed = Math.max(50, Math.min(350, currentSpeed));
      updateSpeedDisplay();
      
      // Move car
      if (steerLeft && car.x > 30) {
        car.x -= car.steerSpeed;
        car.angle = -15;
      } else if (steerRight && car.x < canvas.width - car.width - 30) {
        car.x += car.steerSpeed;
        car.angle = 15;
      } else {
        car.angle *= 0.8;
      }
      
      // Spawn obstacles
      const now = Date.now();
      const rate = 1500 - (currentSpeed / 350) * 800;
      if (now - lastObstacleTime > rate) {
        spawnObstacle();
        lastObstacleTime = now;
      }
      
      // Update obstacles
      const gameSpeed = getGameSpeed();
      for (let i = obstacles.length - 1; i >= 0; i--) {
        const obs = obstacles[i];
        obs.y += gameSpeed;
        
        // Score
        if (!obs.passed && obs.y > car.y + car.height) {
          obs.passed = true;
          score++;
          scoreValue.textContent = score + ' / 50';
          playSound('score');
          
          if (score >= 50) {
            gameRunning = false;
            cancelAnimationFrame(animationId);
            if (turboTimer) clearInterval(turboTimer);
            messageEl.textContent = 'E»òTI O LEGENDƒÇ! üèÜüî•';
            playSound('win');
            endGame();
            return;
          }
        }
        
        // Collision
        if (checkCollision(car, obs)) {
          playSound('crash');
          gameRunning = false;
          cancelAnimationFrame(animationId);
          if (turboTimer) clearInterval(turboTimer);
          endGame();
          return;
        }
        
        // Remove off-screen
        if (obs.y > canvas.height) {
          obstacles.splice(i, 1);
        }
      }
    }
    
    function endGame() {
      finalScoreEl.textContent = score;
      finalSpeedEl.textContent = Math.round(currentSpeed);
      
      if (score > highScore) {
        highScore = score;
        localStorage.setItem('carHighScore', highScore);
      }
      
      gameOverScreen.classList.remove('hidden');
    }
    
    // === GAME LOOP ===
    function gameLoop() {
      if (!gameRunning) return;
      
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      drawRoad();
      obstacles.forEach(drawObstacle);
      drawCar();
      
      update();
      
      animationId = requestAnimationFrame(gameLoop);
    }
    
    // Prevent scroll
    document.addEventListener('touchmove', function(e) {
      e.preventDefault();
    }, { passive: false });
  </script>
</body>
</html>





















