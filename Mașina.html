<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>üöó Ma»ôinu»õa DistractivƒÉ</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      touch-action: none;
    }
    body {
      background: linear-gradient(180deg, #87CEEB 0%, #98FB98 50%, #90EE90 100%);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      font-family: 'Comic Sans MS', 'Chalkboard', cursive, sans-serif;
      overflow: hidden;
      user-select: none;
    }
    #gameContainer {
      position: relative;
      width: 360px;
      max-width: 95vw;
    }
    canvas {
      background: linear-gradient(180deg, #87CEEB 0%, #87CEEB 40%, #228B22 40%, #32CD32 100%);
      border: 6px solid #FF6B6B;
      border-radius: 20px 20px 0 0;
      display: block;
      margin: 0 auto;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    }
    
    /* === ZONE DE CONTROL === */
    #touchControls {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 200px;
      display: flex;
      z-index: 5;
    }
    .touchZone {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.1s;
    }
    .touchZone:active, .touchZone.active {
      background: rgba(255, 255, 255, 0.3);
    }
    .touchZone.left {
      border-right: 3px dashed rgba(255,255,255,0.4);
    }
    .touchHint {
      font-size: 60px;
      opacity: 0.4;
    }
    
    /* === VOLAN COLORAT === */
    #steeringWheel {
      position: absolute;
      bottom: 25px;
      left: 50%;
      transform: translateX(-50%);
      width: 160px;
      height: 160px;
      z-index: 20;
    }
    #wheelBase {
      position: absolute;
      width: 100%;
      height: 100%;
      background: linear-gradient(145deg, #FFD93D, #FFB347);
      border-radius: 50%;
      border: 6px solid #FF6B6B;
      box-shadow: 0 6px 20px rgba(0,0,0,0.3), inset 0 3px 10px rgba(255,255,255,0.5);
    }
    #wheelRim {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 140px;
      height: 140px;
      border-radius: 50%;
      border: 12px solid #FF6B6B;
      background: transparent;
      box-shadow: inset 0 3px 8px rgba(0,0,0,0.2);
    }
    #wheelCenter {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 60px;
      height: 60px;
      background: linear-gradient(145deg, #4ECDC4, #45B7AF);
      border-radius: 50%;
      border: 5px solid #FF6B6B;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 30px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    }
    #wheelSpoke1, #wheelSpoke2, #wheelSpoke3 {
      position: absolute;
      top: 50%;
      left: 50%;
      background: linear-gradient(90deg, #FF6B6B, #FF8E8E);
      transform-origin: left center;
      border-radius: 10px;
    }
    #wheelSpoke1 {
      width: 70px;
      height: 16px;
      transform: translate(-50%, -50%) rotate(90deg);
    }
    #wheelSpoke2 {
      width: 70px;
      height: 16px;
      transform: translate(-50%, -50%) rotate(-30deg);
    }
    #wheelSpoke3 {
      width: 70px;
      height: 16px;
      transform: translate(-50%, -50%) rotate(210deg);
    }
    #wheelRotation {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      transition: transform 0.1s ease-out;
    }
    #wheelIndicator {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      width: 12px;
      height: 20px;
      background: #FF6B6B;
      border-radius: 6px;
      box-shadow: 0 0 15px #FF6B6B;
      border: 2px solid white;
    }
    #scoreDisplay {
      position: absolute;
      bottom: -45px;
      left: 50%;
      transform: translateX(-50%);
      color: #FF6B6B;
      font-size: 22px;
      font-weight: bold;
      white-space: nowrap;
      text-shadow: 2px 2px 0 #fff, 3px 3px 0 #FFD93D;
    }
    #starsDisplay {
      position: absolute;
      bottom: -70px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 28px;
    }
    
    /* === BUTON PAUZƒÇ === */
    #pauseBtn {
      position: absolute;
      bottom: 190px;
      right: 15px;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      font-size: 24px;
      z-index: 25;
      border: 4px solid #FF6B6B;
      background: linear-gradient(145deg, #4ECDC4, #45B7AF);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    }
    #pauseBtn:active {
      transform: scale(0.9);
    }
    
    /* === ECRANE === */
    #startScreen, #gameOver, #levelUp, #pauseScreen {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: calc(100% - 180px);
      background: rgba(135, 206, 235, 0.95);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      color: #FF6B6B;
      border-radius: 20px 20px 0 0;
      text-align: center;
      padding: 20px;
      z-index: 30;
    }
    #startScreen h1 {
      font-size: 32px;
      margin-bottom: 15px;
      color: #FF6B6B;
      text-shadow: 3px 3px 0 #FFD93D;
      animation: bounce 1s infinite;
    }
    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }
    #gameOver h2, #levelUp h2 {
      font-size: 28px;
      margin-bottom: 15px;
      color: #FF6B6B;
      text-shadow: 2px 2px 0 #FFD93D;
    }
    .info-text {
      margin: 10px 0;
      font-size: 16px;
      max-width: 280px;
      color: #4ECDC4;
      font-weight: bold;
      line-height: 1.4;
    }
    .emoji-row {
      font-size: 35px;
      margin: 8px 0;
    }
    .stat-row {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      margin: 10px 0;
      padding: 10px 15px;
      background: rgba(255, 255, 255, 0.5);
      border-radius: 15px;
      font-size: 16px;
      font-weight: bold;
      color: #FF6B6B;
    }
    .actionBtn {
      margin-top: 20px;
      background: linear-gradient(145deg, #FF6B6B, #FF8E8E);
      color: white;
      border: none;
      padding: 18px 45px;
      border-radius: 35px;
      font-size: 22px;
      font-weight: bold;
      font-family: 'Comic Sans MS', cursive;
      cursor: pointer;
      box-shadow: 0 6px 20px rgba(255, 107, 107, 0.5);
      transition: all 0.2s;
      border: 4px solid #FFD93D;
      animation: pulse 1.5s infinite;
    }
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    .actionBtn:active {
      transform: scale(0.95);
      animation: none;
    }
    .hidden {
      display: none !important;
    }
    
    /* === POWER-UP INDICATOR === */
    #powerUpIndicator {
      position: absolute;
      top: 15px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 10px;
      z-index: 10;
    }
    .power-icon {
      width: 45px;
      height: 45px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      animation: bounce 0.8s infinite;
      border: 3px solid white;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    }
    .shield { background: linear-gradient(145deg, #4ECDC4, #45B7AF); }
    .star { background: linear-gradient(145deg, #FFD93D, #FFB347); }
    .double { background: linear-gradient(145deg, #FF6B6B, #FF8E8E); }
    
    /* === CLOUDS === */
    .cloud {
      position: absolute;
      background: white;
      border-radius: 50px;
      opacity: 0.8;
      animation: float 8s linear infinite;
    }
    @keyframes float {
      0% { transform: translateX(-100px); }
      100% { transform: translateX(400px); }
    }
    
    /* === VIBRA»öIE === */
    @keyframes vibrate {
      0%, 100% { transform: translateX(-50%) rotate(0deg); }
      25% { transform: translateX(-50%) rotate(-4deg); }
      75% { transform: translateX(-50%) rotate(4deg); }
    }
    .vibrating {
      animation: vibrate 0.1s infinite;
    }
    
    /* === CONFETTI === */
    .confetti {
      position: absolute;
      width: 10px;
      height: 10px;
      animation: fall 2s linear forwards;
    }
    @keyframes fall {
      0% { transform: translateY(-50px) rotate(0deg); opacity: 1; }
      100% { transform: translateY(500px) rotate(720deg); opacity: 0; }
    }
  </style>
</head>
<body>
  <div id="gameContainer">
    <canvas id="game" width="360" height="450"></canvas>
    
    <!-- NORI -->
    <div class="cloud" style="top: 30px; left: 20px; width: 80px; height: 40px; animation-delay: 0s;"></div>
    <div class="cloud" style="top: 60px; left: 200px; width: 100px; height: 50px; animation-delay: 3s;"></div>
    <div class="cloud" style="top: 20px; left: 280px; width: 60px; height: 35px; animation-delay: 6s;"></div>
    
    <!-- ZONE DE CONTROL -->
    <div id="touchControls">
      <div class="touchZone left" id="touchLeft">
        <span class="touchHint">‚¨ÖÔ∏è</span>
      </div>
      <div class="touchZone right" id="touchRight">
        <span class="touchHint">‚û°Ô∏è</span>
      </div>
    </div>
    
    <!-- BUTON PAUZƒÇ -->
    <button id="pauseBtn">‚è∏Ô∏è</button>
    
    <!-- POWER-UP INDICATOR -->
    <div id="powerUpIndicator"></div>
    
    <!-- VOLAN -->
    <div id="steeringWheel">
      <div id="wheelRotation">
        <div id="wheelBase"></div>
        <div id="wheelRim"></div>
        <div id="wheelSpoke1"></div>
        <div id="wheelSpoke2"></div>
        <div id="wheelSpoke3"></div>
        <div id="wheelCenter">üöó</div>
        <div id="wheelIndicator"></div>
      </div>
      <div id="scoreDisplay">‚≠ê <span id="scoreVal">0</span> / 20</div>
      <div id="starsDisplay">üåüüåüüåü</div>
    </div>
    
    <!-- ECRANE -->
    <div id="startScreen">
      <h1>üöó Ma»ôinu»õa Mea! üöó</h1>
      <p class="info-text">üë∂ Salut, micu»õule pilot!</p>
      <div class="emoji-row">üñêÔ∏è Atinge st√¢nga ‚û°Ô∏è ‚¨ÖÔ∏è sau dreapta!</div>
      <div class="emoji-row">üéÆ Sau √Ænv√¢rte volanul!</div>
      <div class="stat-row">üüß EvitƒÉ obstacolele!</div>
      <div class="stat-row">‚≠ê AdunƒÉ stelu»õe!</div>
      <div class="stat-row">üõ°Ô∏è Prinde scutul albastru!</div>
      <div class="stat-row">üéØ Scop: 20 de stelu»õe!</div>
      <button class="actionBtn" id="startBtn">üöÄ HAI SƒÇ NE JUCƒÇM!</button>
    </div>
    
    <div id="gameOver" class="hidden">
      <h2 id="endTitle">üåü Bravo!</h2>
      <div class="stat-row">
        <span>‚≠ê Stelu»õe:</span>
        <span id="finalScore">0</span>
      </div>
      <div class="stat-row">
        <span>üèÜ Record:</span>
        <span id="personalBest">0</span>
      </div>
      <p id="message" class="info-text">E»ôti super!</p>
      <button class="actionBtn" id="restartBtn">üîÑ MAI JUCƒÇM!</button>
    </div>
    
    <div id="levelUp" class="hidden">
      <h2>üéâ SUPER!</h2>
      <p id="levelUpText" class="info-text">Ai fƒÉcut un nivel nou!</p>
      <div class="emoji-row">üåüüåüüåü</div>
      <button class="actionBtn" id="continueBtn">‚ñ∂ CONTINUƒÇM!</button>
    </div>
    
    <div id="pauseScreen" class="hidden">
      <h2>‚è∏Ô∏è PauzƒÉ</h2>
      <p class="info-text">ApasƒÉ pe buton pentru a continua!</p>
      <div class="emoji-row">üòä</div>
      <button class="actionBtn" id="resumeBtn">‚ñ∂ CONTINUƒÇM!</button>
    </div>
  </div>

  <script>
    // === CONFIG ===
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const scoreVal = document.getElementById('scoreVal');
    const starsDisplay = document.getElementById('starsDisplay');
    const finalScoreEl = document.getElementById('finalScore');
    const personalBestEl = document.getElementById('personalBest');
    const messageEl = document.getElementById('message');
    const endTitle = document.getElementById('endTitle');
    const levelUpText = document.getElementById('levelUpText');
    const startScreen = document.getElementById('startScreen');
    const gameOverScreen = document.getElementById('gameOver');
    const levelUpScreen = document.getElementById('levelUp');
    const pauseScreen = document.getElementById('pauseScreen');
    const powerUpIndicator = document.getElementById('powerUpIndicator');
    const wheelRotation = document.getElementById('wheelRotation');
    const touchLeft = document.getElementById('touchLeft');
    const touchRight = document.getElementById('touchRight');
    
    const startBtn = document.getElementById('startBtn');
    const restartBtn = document.getElementById('restartBtn');
    const continueBtn = document.getElementById('continueBtn');
    const resumeBtn = document.getElementById('resumeBtn');
    const pauseBtn = document.getElementById('pauseBtn');

    // === AUDIO ===
    let soundEnabled = true;
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    
    function playSound(type) {
      if (!soundEnabled) return;
      try {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        
        const now = audioCtx.currentTime;
        
        switch(type) {
          case 'score':
            osc.frequency.setValueAtTime(523, now);
            osc.frequency.setValueAtTime(659, now + 0.1);
            osc.frequency.setValueAtTime(784, now + 0.2);
            gain.gain.setValueAtTime(0.15, now);
            gain.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
            osc.start(now);
            osc.stop(now + 0.3);
            break;
          case 'star':
            osc.frequency.setValueAtTime(880, now);
            osc.frequency.setValueAtTime(1175, now + 0.1);
            gain.gain.setValueAtTime(0.2, now);
            gain.gain.exponentialRampToValueAtTime(0.01, now + 0.2);
            osc.start(now);
            osc.stop(now + 0.2);
            break;
          case 'powerup':
            osc.frequency.setValueAtTime(523, now);
            osc.frequency.exponentialRampToValueAtTime(1047, now + 0.3);
            gain.gain.setValueAtTime(0.2, now);
            gain.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
            osc.start(now);
            osc.stop(now + 0.3);
            break;
          case 'collision':
            osc.type = 'sine';
            osc.frequency.setValueAtTime(200, now);
            osc.frequency.exponentialRampToValueAtTime(100, now + 0.2);
            gain.gain.setValueAtTime(0.2, now);
            gain.gain.exponentialRampToValueAtTime(0.01, now + 0.2);
            osc.start(now);
            osc.stop(now + 0.2);
            break;
          case 'win':
            const notes = [523, 659, 784, 1047];
            notes.forEach((freq, i) => {
              setTimeout(() => {
                const o = audioCtx.createOscillator();
                const g = audioCtx.createGain();
                o.connect(g);
                g.connect(audioCtx.destination);
                o.frequency.value = freq;
                g.gain.setValueAtTime(0.2, audioCtx.currentTime);
                g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);
                o.start();
                o.stop(audioCtx.currentTime + 0.2);
              }, i * 150);
            });
            break;
        }
      } catch(e) {}
    }

    // === STARE JOC ===
    let gameRunning = false;
    let gamePaused = false;
    let score = 0;
    let baseSpeed = 2;
    let currentSpeed = 2;
    let level = 1;
    let animationId;
    let highScore = localStorage.getItem('carGameHighScore') || 0;
    
    // === MA»òINA ===
    const car = {
      x: canvas.width / 2 - 25,
      y: canvas.height - 100,
      width: 55,
      height: 75,
      speed: 6,
      color: '#FF6B6B',
      shield: false,
      shieldTime: 0,
      angle: 0,
      happy: true
    };
    
    // === OBSTACOLE (MAI RARE) ===
    let obstacles = [];
    let stars = [];
    let powerUps = [];
    const obstacleColors = ['#FFB347', '#DDA0DD', '#98FB98'];
    const powerUpTypes = [
      { color: '#4ECDC4', effect: 'shield', icon: 'üõ°Ô∏è', duration: 5000 },
      { color: '#FFD93D', effect: 'star', icon: '‚≠ê', duration: 0 }
    ];
    
    // === NIVELURI (U»òOARE) ===
    const levels = [
      { score: 0, speed: 2, obstacleRate: 2500, name: 'Super' },
      { score: 7, speed: 2.5, obstacleRate: 2200, name: 'Extra' },
      { score: 14, speed: 3, obstacleRate: 2000, name: 'Mega' }
    ];
    
    // === CONTROALE ===
    let steeringAngle = 0;
    let lastObstacleTime = 0;
    let lastStarTime = 0;
    let lastPowerUpTime = 0;
    
    // === VOLAN ===
    let isDragging = false;
    const maxSteerAngle = 50;
    
    function updateSteering(clientX) {
      const rect = document.getElementById('steeringWheel').getBoundingClientRect();
      const centerX = rect.left + rect.width / 2;
      const deltaX = clientX - centerX;
      const maxDelta = 80;
      steeringAngle = Math.max(-1, Math.min(1, deltaX / maxDelta));
      
      const rotation = steeringAngle * maxSteerAngle;
      wheelRotation.style.transform = `rotate(${rotation}deg)`;
    }
    
    document.getElementById('steeringWheel').addEventListener('mousedown', (e) => {
      if (!gameRunning || gamePaused) return;
      isDragging = true;
      updateSteering(e.clientX);
    });
    
    document.addEventListener('mousemove', (e) => {
      if (!isDragging) return;
      updateSteering(e.clientX);
    });
    
    document.addEventListener('mouseup', () => {
      isDragging = false;
      steeringAngle = 0;
      wheelRotation.style.transform = 'rotate(0deg)';
    });
    
    document.getElementById('steeringWheel').addEventListener('touchstart', (e) => {
      if (!gameRunning || gamePaused) return;
      e.preventDefault();
      isDragging = true;
      updateSteering(e.touches[0].clientX);
    }, { passive: false });
    
    document.addEventListener('touchmove', (e) => {
      if (!isDragging) return;
      updateSteering(e.touches[0].clientX);
    }, { passive: false });
    
    document.addEventListener('touchend', () => {
      isDragging = false;
      steeringAngle = 0;
      wheelRotation.style.transform = 'rotate(0deg)';
    });
    
    // === ZONE TOUCH ===
    function handleTouchLeft(e) {
      e.preventDefault();
      if (!gameRunning || gamePaused) return;
      steeringAngle = -1;
      wheelRotation.style.transform = `rotate(-${maxSteerAngle}deg)`;
      touchLeft.classList.add('active');
    }
    
    function handleTouchRight(e) {
      e.preventDefault();
      if (!gameRunning || gamePaused) return;
      steeringAngle = 1;
      wheelRotation.style.transform = `rotate(${maxSteerAngle}deg)`;
      touchRight.classList.add('active');
    }
    
    function releaseTouch() {
      steeringAngle = 0;
      wheelRotation.style.transform = 'rotate(0deg)';
      touchLeft.classList.remove('active');
      touchRight.classList.remove('active');
    }
    
    touchLeft.addEventListener('touchstart', handleTouchLeft, { passive: false });
    touchLeft.addEventListener('touchend', releaseTouch);
    touchLeft.addEventListener('mousedown', handleTouchLeft);
    touchLeft.addEventListener('mouseup', releaseTouch);
    touchLeft.addEventListener('mouseleave', releaseTouch);
    
    touchRight.addEventListener('touchstart', handleTouchRight, { passive: false });
    touchRight.addEventListener('touchend', releaseTouch);
    touchRight.addEventListener('mousedown', handleTouchRight);
    touchRight.addEventListener('mouseup', releaseTouch);
    touchRight.addEventListener('mouseleave', releaseTouch);
    
    // === TASTATURƒÇ ===
    window.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowLeft') {
        steeringAngle = -1;
        wheelRotation.style.transform = `rotate(-${maxSteerAngle}deg)`;
      }
      if (e.key === 'ArrowRight') {
        steeringAngle = 1;
        wheelRotation.style.transform = `rotate(${maxSteerAngle}deg)`;
      }
      if (e.key === 'Escape' && gameRunning) togglePause();
      if (e.key === ' ' && gameRunning) togglePause();
    });
    
    window.addEventListener('keyup', (e) => {
      if (e.key === 'ArrowLeft' || e.key === 'ArrowRight') {
        steeringAngle = 0;
        wheelRotation.style.transform = 'rotate(0deg)';
      }
    });
    
    // === BUTOANE ===
    pauseBtn.addEventListener('click', () => {
      if (gameRunning) togglePause();
    });
    
    function resetCar() {
      car.x = canvas.width / 2 - 27;
      car.shield = false;
      car.angle = 0;
      car.happy = true;
      updatePowerUpIndicator();
      steeringAngle = 0;
      wheelRotation.style.transform = 'rotate(0deg)';
    }
    
    // === START JOC ===
    function startGame() {
      startScreen.classList.add('hidden');
      gameOverScreen.classList.add('hidden');
      levelUpScreen.classList.add('hidden');
      pauseScreen.classList.add('hidden');
      
      score = 0;
      level = 1;
      baseSpeed = levels[0].speed;
      currentSpeed = baseSpeed;
      scoreVal.textContent = score;
      updateStars();
      
      resetCar();
      obstacles = [];
      stars = [];
      powerUps = [];
      lastObstacleTime = Date.now();
      lastStarTime = Date.now();
      lastPowerUpTime = Date.now();
      
      gameRunning = true;
      gamePaused = false;
      gameLoop();
      spawnLoop();
    }
    
    startBtn.addEventListener('click', startGame);
    restartBtn.addEventListener('click', startGame);
    continueBtn.addEventListener('click', () => {
      levelUpScreen.classList.add('hidden');
      gameRunning = true;
      gameLoop();
      spawnLoop();
    });
    resumeBtn.addEventListener('click', togglePause);
    
    // === PAUZƒÇ ===
    function togglePause() {
      if (!gameRunning) return;
      gamePaused = !gamePaused;
      if (gamePaused) {
        cancelAnimationFrame(animationId);
        pauseScreen.classList.remove('hidden');
      } else {
        pauseScreen.classList.add('hidden');
        gameLoop();
        spawnLoop();
      }
    }
    
    // === SPAWN (MAI RAR) ===
    function spawnLoop() {
      if (!gameRunning || gamePaused) return;
      
      const currentLevel = levels[Math.min(level - 1, levels.length - 1)];
      const now = Date.now();
      
      // Obstacole - foarte rare
      if (now - lastObstacleTime > currentLevel.obstacleRate) {
        spawnObstacle();
        lastObstacleTime = now;
      }
      
      // Stelu»õe - des
      if (now - lastStarTime > 1500) {
        if (Math.random() < 0.7) spawnStar();
        lastStarTime = now;
      }
      
      // Power-ups - uneori
      if (now - lastPowerUpTime > 6000) {
        if (Math.random() < 0.5) spawnPowerUp();
        lastPowerUpTime = now;
      }
      
      setTimeout(spawnLoop, 100);
    }
    
    function spawnObstacle() {
      if (!gameRunning || gamePaused) return;
      const color = obstacleColors[Math.floor(Math.random() * obstacleColors.length)];
      const width = 45 + Math.random() * 25;
      obstacles.push({
        x: Math.random() * (canvas.width - width),
        y: -60,
        width: width,
        height: 45,
        color: color,
        passed: false,
        emoji: ['üüß', 'üì¶', 'ü™®'][Math.floor(Math.random() * 3)]
      });
    }
    
    function spawnStar() {
      if (!gameRunning || gamePaused) return;
      stars.push({
        x: Math.random() * (canvas.width - 35),
        y: -40,
        width: 35,
        height: 35,
        collected: false
      });
    }
    
    function spawnPowerUp() {
      if (!gameRunning || gamePaused) return;
      const type = powerUpTypes[Math.floor(Math.random() * powerUpTypes.length)];
      powerUps.push({
        x: Math.random() * (canvas.width - 45),
        y: -50,
        width: 45,
        height: 45,
        ...type,
        collected: false
      });
    }
    
    // === COLIZIUNE ===
    function checkCollision(a, b) {
      return a.x < b.x + b.width && a.x + a.width > b.x &&
             a.y < b.y + b.height && a.y + a.height > b.y;
    }
    
    // === POWER-UP ===
    function updatePowerUpIndicator() {
      powerUpIndicator.innerHTML = '';
      if (car.shield) {
        const icon = document.createElement('div');
        icon.className = 'power-icon shield';
        icon.textContent = 'üõ°Ô∏è';
        powerUpIndicator.appendChild(icon);
      }
    }
    
    function activatePowerUp(type) {
      playSound('powerup');
      switch(type) {
        case 'shield':
          car.shield = true;
          car.shieldTime = Date.now() + 5000;
          break;
        case 'star':
          score = Math.min(20, score + 1);
          scoreVal.textContent = score;
          playSound('star');
          createConfetti();
          break;
      }
      updatePowerUpIndicator();
    }
    
    function checkPowerUpExpiry() {
      const now = Date.now();
      if (car.shield && now > car.shieldTime) {
        car.shield = false;
        updatePowerUpIndicator();
      }
    }
    
    function checkLevelUp() {
      const nextLevel = levels[Math.min(level, levels.length - 1)];
      if (score >= nextLevel.score && level < levels.length) {
        level++;
        baseSpeed = levels[level - 1].speed;
        currentSpeed = baseSpeed;
        playSound('win');
        gameRunning = false;
        cancelAnimationFrame(animationId);
        levelUpText.textContent = `Nivel ${level}: ${levels[level-1].name}!`;
        levelUpScreen.classList.remove('hidden');
        createConfetti();
      }
    }
    
    function checkWin() {
      if (score >= 20) {
        gameRunning = false;
        cancelAnimationFrame(animationId);
        endTitle.textContent = 'üèÜ AI C√Ç»òTIGAT!';
        messageEl.textContent = 'E»ôti un pilot super tare!';
        playSound('win');
        createConfetti();
        endGame();
      }
    }
    
    // === CONFETTI ===
    function createConfetti() {
      const colors = ['#FF6B6B', '#FFD93D', '#4ECDC4', '#98FB98', '#DDA0DD'];
      for (let i = 0; i < 30; i++) {
        setTimeout(() => {
          const confetti = document.createElement('div');
          confetti.className = 'confetti';
          confetti.style.left = Math.random() * 360 + 'px';
          confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
          confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
          document.getElementById('gameContainer').appendChild(confetti);
          setTimeout(() => confetti.remove(), 2000);
        }, i * 50);
      }
    }
    
    // === STELE DISPLAY ===
    function updateStars() {
      const filled = Math.floor(score / 5);
      const empty = 4 - filled;
      starsDisplay.textContent = 'üåü'.repeat(filled) + '‚≠ê'.repeat(empty);
    }
    
    // === DESENARE ===
    function drawCar() {
      ctx.save();
      ctx.translate(car.x + car.width/2, car.y + car.height/2);
      ctx.rotate(car.angle * Math.PI / 180);
      ctx.translate(-car.width/2, -car.height/2);
      
      // UmbrƒÉ
      ctx.fillStyle = 'rgba(0,0,0,0.2)';
      ctx.fillRect(5, 5, car.width, car.height);
      
      // Corp ma»ôinƒÉ
      const gradient = ctx.createLinearGradient(0, 0, car.width, 0);
      gradient.addColorStop(0, car.color);
      gradient.addColorStop(0.5, '#FF8E8E');
      gradient.addColorStop(1, car.color);
      ctx.fillStyle = gradient;
      
      // FormƒÉ rotunjitƒÉ
      ctx.beginPath();
      ctx.roundRect(0, 0, car.width, car.height, 10);
      ctx.fill();
      
      // Dungi
      ctx.fillStyle = 'rgba(255,255,255,0.4)';
      ctx.fillRect(car.width/2 - 7, 0, 14, car.height);
      
      // Geam
      ctx.fillStyle = '#87CEEB';
      ctx.beginPath();
      ctx.roundRect(10, 18, car.width - 20, 20, 8);
      ctx.fill();
      
      // Fa»õƒÉ z√¢mbitoare
      ctx.fillStyle = '#333';
      // Ochii
      ctx.beginPath();
      ctx.arc(18, 30, 5, 0, Math.PI * 2);
      ctx.arc(car.width - 18, 30, 5, 0, Math.PI * 2);
      ctx.fill();
      // Z√¢mbet
      ctx.beginPath();
      ctx.arc(car.width/2, 35, 12, 0.1 * Math.PI, 0.9 * Math.PI);
      ctx.strokeStyle = '#333';
      ctx.lineWidth = 3;
      ctx.stroke();
      
      // Ro»õi
      ctx.fillStyle = '#333';
      ctx.beginPath();
      ctx.roundRect(-5, 15, 10, 18, 5);
      ctx.roundRect(car.width - 5, 15, 10, 18, 5);
      ctx.roundRect(-5, car.height - 20, 10, 18, 5);
      ctx.roundRect(car.width - 5, car.height - 20, 10, 18, 5);
      ctx.fill();
      
      // Faruri
      ctx.fillStyle = '#FFD93D';
      ctx.beginPath();
      ctx.arc(12, 2, 6, 0, Math.PI * 2);
      ctx.arc(car.width - 12, 2, 6, 0, Math.PI * 2);
      ctx.fill();
      
      // Scut
      if (car.shield) {
        ctx.strokeStyle = 'rgba(78, 205, 196, 0.9)';
        ctx.lineWidth = 5;
        ctx.beginPath();
        ctx.arc(car.width/2, car.height/2, car.width * 0.9, 0, Math.PI * 2);
        ctx.stroke();
        ctx.fillStyle = 'rgba(78, 205, 196, 0.2)';
        ctx.fill();
      }
      
      ctx.restore();
    }
    
    function drawObstacle(obs) {
      ctx.fillStyle = 'rgba(0,0,0,0.2)';
      ctx.fillRect(obs.x + 3, obs.y + 3, obs.width, obs.height);
      
      const gradient = ctx.createLinearGradient(obs.x, obs.y, obs.x, obs.y + obs.height);
      gradient.addColorStop(0, obs.color);
      gradient.addColorStop(1, 'rgba(0,0,0,0.3)');
      ctx.fillStyle = gradient;
      ctx.beginPath();
      ctx.roundRect(obs.x, obs.y, obs.width, obs.height, 8);
      ctx.fill();
      
      ctx.strokeStyle = 'rgba(255,255,255,0.5)';
      ctx.lineWidth = 3;
      ctx.stroke();
      
      ctx.fillStyle = 'white';
      ctx.font = 'bold 24px Arial';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillText(obs.emoji, obs.x + obs.width/2, obs.y + obs.height/2);
    }
    
    function drawStar(star) {
      // StrƒÉlucire
      const glow = ctx.createRadialGradient(
        star.x + star.width/2, star.y + star.height/2, 0,
        star.x + star.width/2, star.y + star.height/2, star.width
      );
      glow.addColorStop(0, '#FFD93DAA');
      glow.addColorStop(1, 'transparent');
      ctx.fillStyle = glow;
      ctx.fillRect(star.x - 10, star.y - 10, star.width + 20, star.height + 20);
      
      // Stea
      ctx.fillStyle = '#FFD93D';
      ctx.beginPath();
      const cx = star.x + star.width/2;
      const cy = star.y + star.height/2;
      const r = star.width/2;
      for (let i = 0; i < 5; i++) {
        const angle = (i * 4 * Math.PI / 5) - Math.PI/2;
        const x = cx + Math.cos(angle) * r;
        const y = cy + Math.sin(angle) * r;
        if (i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
      }
      ctx.closePath();
      ctx.fill();
      
      ctx.strokeStyle = '#FF6B6B';
      ctx.lineWidth = 2;
      ctx.stroke();
    }
    
    function drawPowerUp(pu) {
      const glow = ctx.createRadialGradient(
        pu.x + pu.width/2, pu.y + pu.height/2, 0,
        pu.x + pu.width/2, pu.y + pu.height/2, pu.width * 1.5
      );
      glow.addColorStop(0, pu.color + 'AA');
      glow.addColorStop(1, 'transparent');
      ctx.fillStyle = glow;
      ctx.fillRect(pu.x - 15, pu.y - 15, pu.width + 30, pu.height + 30);
      
      ctx.fillStyle = pu.color;
      ctx.beginPath();
      ctx.arc(pu.x + pu.width/2, pu.y + pu.height/2, pu.width/2, 0, Math.PI * 2);
      ctx.fill();
      
      ctx.strokeStyle = 'white';
      ctx.lineWidth = 4;
      ctx.stroke();
      
      ctx.fillStyle = 'white';
      ctx.font = 'bold 26px Arial';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillText(pu.icon, pu.x + pu.width/2, pu.y + pu.height/2);
    }
    
    function drawRoad() {
      // IarbƒÉ
      ctx.fillStyle = '#32CD32';
      ctx.fillRect(0, canvas.height * 0.4, canvas.width, canvas.height * 0.6);
      
      // Drum
      ctx.fillStyle = '#696969';
      ctx.fillRect(30, 0, canvas.width - 60, canvas.height);
      
      // Linii laterale
      ctx.fillStyle = '#FFF';
      ctx.fillRect(35, 0, 8, canvas.height);
      ctx.fillRect(canvas.width - 43, 0, 8, canvas.height);
      
      // Linii centrale animate
      ctx.setLineDash([30, 35]);
      ctx.lineDashOffset = -Date.now() / 40 * currentSpeed;
      ctx.strokeStyle = '#FFF';
      ctx.lineWidth = 5;
      ctx.beginPath();
      ctx.moveTo(canvas.width / 2, 0);
      ctx.lineTo(canvas.width / 2, canvas.height);
      ctx.stroke();
      ctx.setLineDash([]);
      
      // Flori pe iarbƒÉ
      ctx.font = '20px Arial';
      ctx.textAlign = 'center';
      const flowers = ['üå∏', 'üåº', 'üåª', 'üå∑'];
      for (let i = 0; i < 5; i++) {
        const x = 10 + i * 70;
        const y = canvas.height * 0.5 + (i % 2) * 30;
        ctx.fillText(flowers[i % 4], x, y);
        ctx.fillText(flowers[(i+2) % 4], canvas.width - 10 - i * 70, y + 20);
      }
    }
    
    function drawSky() {
      // Soare
      ctx.fillStyle = '#FFD93D';
      ctx.beginPath();
      ctx.arc(320, 50, 40, 0, Math.PI * 2);
      ctx.fill();
      
      // Raze soare
      ctx.strokeStyle = '#FFD93D';
      ctx.lineWidth = 4;
      for (let i = 0; i < 8; i++) {
        const angle = (i / 8) * Math.PI * 2;
        const x1 = 320 + Math.cos(angle) * 45;
        const y1 = 50 + Math.sin(angle) * 45;
        const x2 = 320 + Math.cos(angle) * 55;
        const y2 = 50 + Math.sin(angle) * 55;
        ctx.beginPath();
        ctx.moveTo(x1, y1);
        ctx.lineTo(x2, y2);
        ctx.stroke();
      }
    }
    
    // === UPDATE ===
    function update() {
      checkPowerUpExpiry();
      
      // Mi»ôcare ma»ôinƒÉ
      if (steeringAngle !== 0) {
        car.x += steeringAngle * car.speed;
        car.angle = steeringAngle * 15;
        
        if (car.x < 35) car.x = 35;
        if (car.x > canvas.width - car.width - 35) car.x = canvas.width - car.width - 35;
      } else {
        car.angle *= 0.85;
      }
      
      // Obstacole
      for (let i = obstacles.length - 1; i >= 0; i--) {
        const obs = obstacles[i];
        obs.y += currentSpeed;
        
        if (!obs.passed && obs.y > car.y + car.height) {
          obs.passed = true;
        }
        
        if (checkCollision(car, obs)) {
          if (car.shield) {
            car.shield = false;
            obstacles.splice(i, 1);
            updatePowerUpIndicator();
            playSound('powerup');
            document.getElementById('steeringWheel').classList.add('vibrating');
            setTimeout(() => {
              document.getElementById('steeringWheel').classList.remove('vibrating');
            }, 300);
          } else {
            score = Math.max(0, score - 1);
            scoreVal.textContent = score;
            updateStars();
            playSound('collision');
            car.happy = false;
            setTimeout(() => car.happy = true, 500);
          }
        }
        
        if (obs.y > canvas.height) obstacles.splice(i, 1);
      }
      
      // Stelu»õe
      for (let i = stars.length - 1; i >= 0; i--) {
        const star = stars[i];
        star.y += currentSpeed;
        
        if (checkCollision(car, star)) {
          score = Math.min(20, score + 1);
          scoreVal.textContent = score;
          updateStars();
          playSound('star');
          stars.splice(i, 1);
          createConfetti();
          checkLevelUp();
          checkWin();
          continue;
        }
        
        if (star.y > canvas.height) stars.splice(i, 1);
      }
      
      // Power-ups
      for (let i = powerUps.length - 1; i >= 0; i--) {
        const pu = powerUps[i];
        pu.y += currentSpeed;
        
        if (checkCollision(car, pu)) {
          activatePowerUp(pu.effect);
          powerUps.splice(i, 1);
          continue;
        }
        
        if (pu.y > canvas.height) powerUps.splice(i, 1);
      }
    }
    
    // === GAME OVER ===
    function endGame() {
      gameRunning = false;
      cancelAnimationFrame(animationId);
      
      finalScoreEl.textContent = score;
      
      if (score > highScore) {
        highScore = score;
        localStorage.setItem('carGameHighScore', highScore);
        personalBestEl.textContent = highScore + ' üéâ';
      } else {
        personalBestEl.textContent = highScore;
      }
      
      gameOverScreen.classList.remove('hidden');
    }
    
    // === GAME LOOP ===
    function gameLoop() {
      if (!gameRunning || gamePaused) return;
      
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      drawSky();
      drawRoad();
      stars.forEach(drawStar);
      powerUps.forEach(drawPowerUp);
      obstacles.forEach(drawObstacle);
      drawCar();
      
      update();
      
      animationId = requestAnimationFrame(gameLoop);
    }
    
    // === PREVENIRE SCROLL ===
    document.addEventListener('touchmove', (e) => {
      if (gameRunning) e.preventDefault();
    }, { passive: false });
    
    // === INIT AUDIO ===
    document.addEventListener('click', () => {
      if (audioCtx.state === 'suspended') audioCtx.resume();
    }, { once: true });
  </script>
</body>
</html>



