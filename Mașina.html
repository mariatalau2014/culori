<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>üèéÔ∏è Curse de Ma»ôinu»õe</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      touch-action: none;
    }
    body {
      background: linear-gradient(180deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      font-family: 'Arial Black', 'Impact', sans-serif;
      overflow: hidden;
      user-select: none;
    }
    #gameContainer {
      position: relative;
      width: 420px;
      max-width: 98vw;
    }
    canvas {
      background: linear-gradient(180deg, #1a1a2e 0%, #1a1a2e 35%, #2d2d2d 35%, #3d3d3d 100%);
      border: 5px solid #e94560;
      border-radius: 15px 15px 0 0;
      display: block;
      margin: 0 auto;
      box-shadow: 0 0 40px rgba(233, 69, 96, 0.5);
    }
    
    /* === ZONE DE CONTROL === */
    #touchControls {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 140px;
      display: flex;
      z-index: 5;
    }
    .touchZone {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.1s;
    }
    .touchZone:active, .touchZone.active {
      background: rgba(233, 69, 96, 0.3);
    }
    .touchZone.left {
      border-right: 3px dashed rgba(233, 69, 96, 0.4);
    }
    .touchHint {
      font-size: 50px;
      opacity: 0.3;
    }
    
    /* === VOLAN COMPACT === */
    #steeringWheel {
      position: absolute;
      bottom: 15px;
      left: 50%;
      transform: translateX(-50%);
      width: 100px;
      height: 100px;
      z-index: 20;
    }
    #wheelBase {
      position: absolute;
      width: 100%;
      height: 100%;
      background: linear-gradient(145deg, #1a1a1a, #0d0d0d);
      border-radius: 50%;
      border: 4px solid #e94560;
      box-shadow: 0 4px 15px rgba(233, 69, 96, 0.6), inset 0 2px 8px rgba(255,255,255,0.1);
    }
    #wheelRim {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 85px;
      height: 85px;
      border-radius: 50%;
      border: 8px solid #e94560;
      background: transparent;
    }
    #wheelCenter {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 35px;
      height: 35px;
      background: linear-gradient(145deg, #e94560, #c73e54);
      border-radius: 50%;
      border: 3px solid #ff6b6b;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      box-shadow: 0 2px 10px rgba(233, 69, 96, 0.5);
    }
    #wheelSpoke1, #wheelSpoke2, #wheelSpoke3 {
      position: absolute;
      top: 50%;
      left: 50%;
      background: linear-gradient(90deg, #e94560, #ff6b6b);
      transform-origin: left center;
      border-radius: 5px;
    }
    #wheelSpoke1 {
      width: 45px;
      height: 8px;
      transform: translate(-50%, -50%) rotate(90deg);
    }
    #wheelSpoke2 {
      width: 45px;
      height: 8px;
      transform: translate(-50%, -50%) rotate(-30deg);
    }
    #wheelSpoke3 {
      width: 45px;
      height: 8px;
      transform: translate(-50%, -50%) rotate(210deg);
    }
    #wheelRotation {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      transition: transform 0.08s ease-out;
    }
    #wheelIndicator {
      position: absolute;
      top: 6px;
      left: 50%;
      transform: translateX(-50%);
      width: 6px;
      height: 12px;
      background: #ff6b6b;
      border-radius: 3px;
      box-shadow: 0 0 10px #ff6b6b;
    }
    #scoreDisplay {
      position: absolute;
      bottom: -35px;
      left: 50%;
      transform: translateX(-50%);
      color: #e94560;
      font-size: 18px;
      font-weight: bold;
      white-space: nowrap;
      text-shadow: 0 0 10px #e94560;
    }
    #levelDisplay {
      position: absolute;
      bottom: -55px;
      left: 50%;
      transform: translateX(-50%);
      color: #00d9ff;
      font-size: 16px;
      font-weight: bold;
      white-space: nowrap;
      text-shadow: 0 0 10px #00d9ff;
    }
    
    /* === BUTON PAUZƒÇ === */
    #pauseBtn {
      position: absolute;
      bottom: 145px;
      right: 10px;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      font-size: 20px;
      z-index: 25;
      border: 3px solid #e94560;
      background: linear-gradient(145deg, #0f3460, #0a2540);
      color: #00d9ff;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: 0 3px 12px rgba(0, 217, 255, 0.4);
    }
    #pauseBtn:active {
      transform: scale(0.9);
    }
    
    /* === ECRANE === */
    #startScreen, #gameOver, #levelUp, #pauseScreen {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: calc(100% - 120px);
      background: rgba(26, 26, 46, 0.97);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      color: #e94560;
      border-radius: 15px 15px 0 0;
      text-align: center;
      padding: 20px;
      z-index: 30;
    }
    #startScreen h1 {
      font-size: 36px;
      margin-bottom: 15px;
      color: #e94560;
      text-shadow: 0 0 20px #e94560;
      letter-spacing: 2px;
    }
    #gameOver h2, #levelUp h2 {
      font-size: 32px;
      margin-bottom: 15px;
      color: #e94560;
      text-shadow: 0 0 15px #e94560;
    }
    .info-text {
      margin: 10px 0;
      font-size: 15px;
      max-width: 300px;
      color: #00d9ff;
      font-weight: bold;
      line-height: 1.4;
    }
    .emoji-row {
      font-size: 32px;
      margin: 8px 0;
    }
    .stat-row {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      margin: 8px 0;
      padding: 10px 15px;
      background: rgba(233, 69, 96, 0.2);
      border-radius: 10px;
      font-size: 15px;
      font-weight: bold;
      color: #e94560;
      border: 2px solid #e94560;
    }
    .actionBtn {
      margin-top: 20px;
      background: linear-gradient(145deg, #e94560, #c73e54);
      color: white;
      border: none;
      padding: 16px 40px;
      border-radius: 30px;
      font-size: 20px;
      font-weight: bold;
      font-family: 'Arial Black', sans-serif;
      cursor: pointer;
      box-shadow: 0 5px 20px rgba(233, 69, 96, 0.6);
      transition: all 0.2s;
      border: 3px solid #ff6b6b;
      text-transform: uppercase;
      letter-spacing: 2px;
    }
    .actionBtn:active {
      transform: scale(0.95);
    }
    .hidden {
      display: none !important;
    }
    
    /* === POWER-UP INDICATOR === */
    #powerUpIndicator {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 8px;
      z-index: 10;
    }
    .power-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      border: 3px solid white;
      box-shadow: 0 4px 15px rgba(0,0,0,0.5);
    }
    .shield { background: linear-gradient(145deg, #00d9ff, #0099cc); }
    .speed { background: linear-gradient(145deg, #ff6b6b, #e94560); }
    .double { background: linear-gradient(145deg, #ffd700, #ffaa00); }
    
    /* === SPEED LINES === */
    .speed-line {
      position: absolute;
      width: 3px;
      height: 60px;
      background: linear-gradient(180deg, transparent, #00d9ff, transparent);
      animation: speedFall 0.4s linear infinite;
    }
    @keyframes speedFall {
      0% { transform: translateY(-100px); opacity: 0; }
      50% { opacity: 1; }
      100% { transform: translateY(500px); opacity: 0; }
    }
    
    /* === VIBRA»öIE === */
    @keyframes vibrate {
      0%, 100% { transform: translateX(-50%) rotate(0deg); }
      25% { transform: translateX(-50%) rotate(-5deg); }
      75% { transform: translateX(-50%) rotate(5deg); }
    }
    .vibrating {
      animation: vibrate 0.1s infinite;
    }
    
    /* === EXPLOSION EFFECT === */
    .explosion {
      position: absolute;
      width: 80px;
      height: 80px;
      background: radial-gradient(circle, #ff6b6b 0%, #e94560 50%, transparent 70%);
      border-radius: 50%;
      animation: explode 0.5s ease-out forwards;
    }
    @keyframes explode {
      0% { transform: scale(0.5); opacity: 1; }
      100% { transform: scale(2); opacity: 0; }
    }
    
    /* === FLASH EFFECT === */
    @keyframes flash {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }
    .flashing {
      animation: flash 0.2s infinite;
    }
  </style>
</head>
<body>
  <div id="gameContainer">
    <canvas id="game" width="420" height="520"></canvas>
    
    <!-- ZONE DE CONTROL -->
    <div id="touchControls">
      <div class="touchZone left" id="touchLeft">
        <span class="touchHint">‚¨ÖÔ∏è</span>
      </div>
      <div class="touchZone right" id="touchRight">
        <span class="touchHint">‚û°Ô∏è</span>
      </div>
    </div>
    
    <!-- BUTON PAUZƒÇ -->
    <button id="pauseBtn">‚è∏Ô∏è</button>
    
    <!-- POWER-UP INDICATOR -->
    <div id="powerUpIndicator"></div>
    
    <!-- VOLAN -->
    <div id="steeringWheel">
      <div id="wheelRotation">
        <div id="wheelBase"></div>
        <div id="wheelRim"></div>
        <div id="wheelSpoke1"></div>
        <div id="wheelSpoke2"></div>
        <div id="wheelSpoke3"></div>
        <div id="wheelCenter">üèéÔ∏è</div>
        <div id="wheelIndicator"></div>
      </div>
      <div id="scoreDisplay">‚≠ê PUNCTE: <span id="scoreVal">0</span> / 30</div>
      <div id="levelDisplay">üèÅ NIVEL: <span id="levelVal">1</span></div>
    </div>
    
    <!-- ECRANE -->
    <div id="startScreen">
      <h1>üèéÔ∏è CURSE EXTREME üèéÔ∏è</h1>
      <p class="info-text">üë¶ Salut, campionule!</p>
      <div class="emoji-row">üñêÔ∏è Atinge ST√ÇNGA ‚û°Ô∏è ‚¨ÖÔ∏è sau DREAPTA!</div>
      <div class="emoji-row">üéÆ Sau √Ænv√¢rte VOLANUL!</div>
      <div class="stat-row">üüß EVITƒÇ OBSTACOLELE!</div>
      <div class="stat-row">üí• DACƒÇ TE LOVE»òTI - PIERZI!</div>
      <div class="stat-row">‚≠ê ADUNƒÇ 30 DE PUNCTE!</div>
      <div class="stat-row">üèÜ DEVINO CEL MAI BUN!</div>
      <button class="actionBtn" id="startBtn">üöÄ START!</button>
    </div>
    
    <div id="gameOver" class="hidden">
      <h2>üí• CRASH!</h2>
      <div class="stat-row">
        <span>‚≠ê Puncte:</span>
        <span id="finalScore">0</span>
      </div>
      <div class="stat-row">
        <span>üèÅ Nivel:</span>
        <span id="finalLevel">1</span>
      </div>
      <div class="stat-row">
        <span>üèÜ Record:</span>
        <span id="personalBest">0</span>
      </div>
      <p id="message" class="info-text">Mai √ÆncearcƒÉ, campionule!</p>
      <button class="actionBtn" id="restartBtn">üîÑ DIN NOU!</button>
    </div>
    
    <div id="levelUp" class="hidden">
      <h2>üéâ NIVEL NOU!</h2>
      <p id="levelUpText" class="info-text">Ai trecut la nivelul urmƒÉtor!</p>
      <div class="emoji-row">üèéÔ∏èüí®üèÅ</div>
      <button class="actionBtn" id="continueBtn">‚ñ∂ CONTINUƒÇ!</button>
    </div>
    
    <div id="pauseScreen" class="hidden">
      <h2>‚è∏Ô∏è PAUZƒÇ</h2>
      <p class="info-text">ApasƒÉ pe buton pentru a continua!</p>
      <div class="emoji-row">üèéÔ∏è</div>
      <button class="actionBtn" id="resumeBtn">‚ñ∂ CONTINUƒÇ!</button>
    </div>
  </div>

  <script>
    // === CONFIG ===
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const scoreVal = document.getElementById('scoreVal');
    const levelVal = document.getElementById('levelVal');
    const finalScoreEl = document.getElementById('finalScore');
    const finalLevelEl = document.getElementById('finalLevel');
    const personalBestEl = document.getElementById('personalBest');
    const messageEl = document.getElementById('message');
    const levelUpText = document.getElementById('levelUpText');
    const startScreen = document.getElementById('startScreen');
    const gameOverScreen = document.getElementById('gameOver');
    const levelUpScreen = document.getElementById('levelUp');
    const pauseScreen = document.getElementById('pauseScreen');
    const powerUpIndicator = document.getElementById('powerUpIndicator');
    const wheelRotation = document.getElementById('wheelRotation');
    const touchLeft = document.getElementById('touchLeft');
    const touchRight = document.getElementById('touchRight');
    
    const startBtn = document.getElementById('startBtn');
    const restartBtn = document.getElementById('restartBtn');
    const continueBtn = document.getElementById('continueBtn');
    const resumeBtn = document.getElementById('resumeBtn');
    const pauseBtn = document.getElementById('pauseBtn');

    // === AUDIO ===
    let soundEnabled = true;
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    
    function playSound(type) {
      if (!soundEnabled) return;
      try {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        
        const now = audioCtx.currentTime;
        
        switch(type) {
          case 'score':
            osc.frequency.setValueAtTime(440, now);
            osc.frequency.setValueAtTime(554, now + 0.08);
            osc.frequency.setValueAtTime(659, now + 0.16);
            gain.gain.setValueAtTime(0.15, now);
            gain.gain.exponentialRampToValueAtTime(0.01, now + 0.24);
            osc.start(now);
            osc.stop(now + 0.24);
            break;
          case 'powerup':
            osc.frequency.setValueAtTime(523, now);
            osc.frequency.exponentialRampToValueAtTime(1047, now + 0.25);
            gain.gain.setValueAtTime(0.2, now);
            gain.gain.exponentialRampToValueAtTime(0.01, now + 0.25);
            osc.start(now);
            osc.stop(now + 0.25);
            break;
          case 'collision':
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(150, now);
            osc.frequency.exponentialRampToValueAtTime(50, now + 0.3);
            gain.gain.setValueAtTime(0.3, now);
            gain.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
            osc.start(now);
            osc.stop(now + 0.3);
            break;
          case 'win':
            const notes = [523, 659, 784, 1047, 1319];
            notes.forEach((freq, i) => {
              setTimeout(() => {
                const o = audioCtx.createOscillator();
                const g = audioCtx.createGain();
                o.connect(g);
                g.connect(audioCtx.destination);
                o.frequency.value = freq;
                o.type = 'square';
                g.gain.setValueAtTime(0.15, audioCtx.currentTime);
                g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.15);
                o.start();
                o.stop(audioCtx.currentTime + 0.15);
              }, i * 120);
            });
            break;
        }
      } catch(e) {}
    }

    // === STARE JOC ===
    let gameRunning = false;
    let gamePaused = false;
    let score = 0;
    let baseSpeed = 3;
    let currentSpeed = 3;
    let level = 1;
    let animationId;
    let highScore = localStorage.getItem('carGameHighScore') || 0;
    
    // === MA»òINA ===
    const car = {
      x: canvas.width / 2 - 30,
      y: canvas.height - 110,
      width: 60,
      height: 80,
      speed: 7,
      color: '#e94560',
      shield: false,
      shieldTime: 0,
      angle: 0
    };
    
    // === OBSTACOLE ===
    let obstacles = [];
    let powerUps = [];
    const obstacleColors = ['#ff6b6b', '#ffd700', '#ff8c00'];
    const powerUpTypes = [
      { color: '#00d9ff', effect: 'shield', icon: 'üõ°Ô∏è', duration: 4000 },
      { color: '#00ff88', effect: 'speed', icon: '‚ö°', duration: 3000 },
      { color: '#ffd700', effect: 'double', icon: 'üíé', duration: 3500 }
    ];
    
    // === NIVELURI ===
    const levels = [
      { score: 0, speed: 3, obstacleRate: 2000, name: 'ROOKIE' },
      { score: 10, speed: 4, obstacleRate: 1700, name: 'RACER' },
      { score: 20, speed: 5, obstacleRate: 1400, name: 'PRO' }
    ];
    
    // === CONTROALE ===
    let steeringAngle = 0;
    let lastObstacleTime = 0;
    let lastPowerUpTime = 0;
    
    // === VOLAN ===
    let isDragging = false;
    const maxSteerAngle = 45;
    
    function updateSteering(clientX) {
      const rect = document.getElementById('steeringWheel').getBoundingClientRect();
      const centerX = rect.left + rect.width / 2;
      const deltaX = clientX - centerX;
      const maxDelta = 60;
      steeringAngle = Math.max(-1, Math.min(1, deltaX / maxDelta));
      
      const rotation = steeringAngle * maxSteerAngle;
      wheelRotation.style.transform = `rotate(${rotation}deg)`;
    }
    
    document.getElementById('steeringWheel').addEventListener('mousedown', (e) => {
      if (!gameRunning || gamePaused) return;
      isDragging = true;
      updateSteering(e.clientX);
    });
    
    document.addEventListener('mousemove', (e) => {
      if (!isDragging) return;
      updateSteering(e.clientX);
    });
    
    document.addEventListener('mouseup', () => {
      isDragging = false;
      steeringAngle = 0;
      wheelRotation.style.transform = 'rotate(0deg)';
    });
    
    document.getElementById('steeringWheel').addEventListener('touchstart', (e) => {
      if (!gameRunning || gamePaused) return;
      e.preventDefault();
      isDragging = true;
      updateSteering(e.touches[0].clientX);
    }, { passive: false });
    
    document.addEventListener('touchmove', (e) => {
      if (!isDragging) return;
      updateSteering(e.touches[0].clientX);
    }, { passive: false });
    
    document.addEventListener('touchend', () => {
      isDragging = false;
      steeringAngle = 0;
      wheelRotation.style.transform = 'rotate(0deg)';
    });
    
    // === ZONE TOUCH ===
    function handleTouchLeft(e) {
      e.preventDefault();
      if (!gameRunning || gamePaused) return;
      steeringAngle = -1;
      wheelRotation.style.transform = `rotate(-${maxSteerAngle}deg)`;
      touchLeft.classList.add('active');
    }
    
    function handleTouchRight(e) {
      e.preventDefault();
      if (!gameRunning || gamePaused) return;
      steeringAngle = 1;
      wheelRotation.style.transform = `rotate(${maxSteerAngle}deg)`;
      touchRight.classList.add('active');
    }
    
    function releaseTouch() {
      steeringAngle = 0;
      wheelRotation.style.transform = 'rotate(0deg)';
      touchLeft.classList.remove('active');
      touchRight.classList.remove('active');
    }
    
    touchLeft.addEventListener('touchstart', handleTouchLeft, { passive: false });
    touchLeft.addEventListener('touchend', releaseTouch);
    touchLeft.addEventListener('mousedown', handleTouchLeft);
    touchLeft.addEventListener('mouseup', releaseTouch);
    touchLeft.addEventListener('mouseleave', releaseTouch);
    
    touchRight.addEventListener('touchstart', handleTouchRight, { passive: false });
    touchRight.addEventListener('touchend', releaseTouch);
    touchRight.addEventListener('mousedown', handleTouchRight);
    touchRight.addEventListener('mouseup', releaseTouch);
    touchRight.addEventListener('mouseleave', releaseTouch);
    
    // === TASTATURƒÇ ===
    window.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowLeft') {
        steeringAngle = -1;
        wheelRotation.style.transform = `rotate(-${maxSteerAngle}deg)`;
      }
      if (e.key === 'ArrowRight') {
        steeringAngle = 1;
        wheelRotation.style.transform = `rotate(${maxSteerAngle}deg)`;
      }
      if (e.key === 'Escape' && gameRunning) togglePause();
      if (e.key === ' ' && gameRunning) togglePause();
    });
    
    window.addEventListener('keyup', (e) => {
      if (e.key === 'ArrowLeft' || e.key === 'ArrowRight') {
        steeringAngle = 0;
        wheelRotation.style.transform = 'rotate(0deg)';
      }
    });
    
    // === BUTOANE ===
    pauseBtn.addEventListener('click', () => {
      if (gameRunning) togglePause();
    });
    
    function resetCar() {
      car.x = canvas.width / 2 - 30;
      car.shield = false;
      car.angle = 0;
      updatePowerUpIndicator();
      steeringAngle = 0;
      wheelRotation.style.transform = 'rotate(0deg)';
    }
    
    // === START JOC ===
    function startGame() {
      startScreen.classList.add('hidden');
      gameOverScreen.classList.add('hidden');
      levelUpScreen.classList.add('hidden');
      pauseScreen.classList.add('hidden');
      
      score = 0;
      level = 1;
      baseSpeed = levels[0].speed;
      currentSpeed = baseSpeed;
      scoreVal.textContent = score;
      levelVal.textContent = level;
      
      resetCar();
      obstacles = [];
      powerUps = [];
      lastObstacleTime = Date.now();
      lastPowerUpTime = Date.now();
      
      gameRunning = true;
      gamePaused = false;
      gameLoop();
      spawnLoop();
    }
    
    startBtn.addEventListener('click', startGame);
    restartBtn.addEventListener('click', startGame);
    continueBtn.addEventListener('click', () => {
      levelUpScreen.classList.add('hidden');
      gameRunning = true;
      gameLoop();
      spawnLoop();
    });
    resumeBtn.addEventListener('click', togglePause);
    
    // === PAUZƒÇ ===
    function togglePause() {
      if (!gameRunning) return;
      gamePaused = !gamePaused;
      if (gamePaused) {
        cancelAnimationFrame(animationId);
        pauseScreen.classList.remove('hidden');
      } else {
        pauseScreen.classList.add('hidden');
        gameLoop();
        spawnLoop();
      }
    }
    
    // === SPAWN ===
    function spawnLoop() {
      if (!gameRunning || gamePaused) return;
      
      const currentLevel = levels[Math.min(level - 1, levels.length - 1)];
      const now = Date.now();
      
      if (now - lastObstacleTime > currentLevel.obstacleRate) {
        spawnObstacle();
        lastObstacleTime = now;
      }
      
      if (now - lastPowerUpTime > 5000) {
        if (Math.random() < 0.5) spawnPowerUp();
        lastPowerUpTime = now;
      }
      
      setTimeout(spawnLoop, 100);
    }
    
    function spawnObstacle() {
      if (!gameRunning || gamePaused) return;
      const color = obstacleColors[Math.floor(Math.random() * obstacleColors.length)];
      const width = 50 + Math.random() * 30;
      obstacles.push({
        x: Math.random() * (canvas.width - width),
        y: -60,
        width: width,
        height: 50,
        color: color,
        passed: false,
        emoji: ['üüß', 'üöß', 'ü™®'][Math.floor(Math.random() * 3)]
      });
    }
    
    function spawnPowerUp() {
      if (!gameRunning || gamePaused) return;
      const type = powerUpTypes[Math.floor(Math.random() * powerUpTypes.length)];
      powerUps.push({
        x: Math.random() * (canvas.width - 45),
        y: -50,
        width: 45,
        height: 45,
        ...type,
        collected: false
      });
    }
    
    // === COLIZIUNE ===
    function checkCollision(a, b) {
      return a.x < b.x + b.width && a.x + a.width > b.x &&
             a.y < b.y + b.height && a.y + a.height > b.y;
    }
    
    // === POWER-UP ===
    function updatePowerUpIndicator() {
      powerUpIndicator.innerHTML = '';
      if (car.shield) {
        const icon = document.createElement('div');
        icon.className = 'power-icon shield';
        icon.textContent = 'üõ°Ô∏è';
        powerUpIndicator.appendChild(icon);
      }
    }
    
    function activatePowerUp(type) {
      playSound('powerup');
      switch(type) {
        case 'shield':
          car.shield = true;
          car.shieldTime = Date.now() + 4000;
          break;
        case 'speed':
          currentSpeed = Math.min(8, currentSpeed + 2);
          setTimeout(() => {
            currentSpeed = baseSpeed;
          }, 3000);
          break;
        case 'double':
          score = Math.min(30, score + 2);
          scoreVal.textContent = score;
          break;
      }
      updatePowerUpIndicator();
    }
    
    function checkPowerUpExpiry() {
      const now = Date.now();
      if (car.shield && now > car.shieldTime) {
        car.shield = false;
        updatePowerUpIndicator();
      }
    }
    
    function checkLevelUp() {
      const nextLevel = levels[Math.min(level, levels.length - 1)];
      if (score >= nextLevel.score && level < levels.length) {
        level++;
        baseSpeed = levels[level - 1].speed;
        currentSpeed = baseSpeed;
        levelVal.textContent = level;
        playSound('win');
        gameRunning = false;
        cancelAnimationFrame(animationId);
        levelUpText.textContent = `Nivel ${level}: ${levels[level-1].name}!`;
        levelUpScreen.classList.remove('hidden');
      }
    }
    
    function checkWin() {
      if (score >= 30) {
        gameRunning = false;
        cancelAnimationFrame(animationId);
        messageEl.textContent = 'E»òTI UN ADEVƒÇRAT CAMPION! üèÜ';
        playSound('win');
        createExplosion(canvas.width/2, canvas.height/2);
        endGame();
      }
    }
    
    // === EXPLOSION EFFECT ===
    function createExplosion(x, y) {
      const explosion = document.createElement('div');
      explosion.className = 'explosion';
      explosion.style.left = (x - 40) + 'px';
      explosion.style.top = (y - 40) + 'px';
      document.getElementById('gameContainer').appendChild(explosion);
      setTimeout(() => explosion.remove(), 500);
    }
    
    // === DESENARE ===
    function drawCar() {
      ctx.save();
      ctx.translate(car.x + car.width/2, car.y + car.height/2);
      ctx.rotate(car.angle * Math.PI / 180);
      ctx.translate(-car.width/2, -car.height/2);
      
      // UmbrƒÉ
      ctx.fillStyle = 'rgba(0,0,0,0.4)';
      ctx.fillRect(5, 5, car.width, car.height);
      
      // Corp ma»ôinƒÉ - formƒÉ de cursƒÉ
      ctx.fillStyle = car.color;
      ctx.beginPath();
      ctx.moveTo(10, 0);
      ctx.lineTo(car.width - 10, 0);
      ctx.lineTo(car.width, 20);
      ctx.lineTo(car.width, car.height - 10);
      ctx.lineTo(car.width - 10, car.height);
      ctx.lineTo(10, car.height);
      ctx.lineTo(0, car.height - 10);
      ctx.lineTo(0, 20);
      ctx.closePath();
      ctx.fill();
      
      // Dungi de curse
      ctx.fillStyle = '#1a1a2e';
      ctx.fillRect(car.width/2 - 8, 0, 16, car.height);
      
      // BordurƒÉ dungi
      ctx.strokeStyle = '#fff';
      ctx.lineWidth = 2;
      ctx.strokeRect(car.width/2 - 8, 0, 16, car.height);
      
      // Geam
      ctx.fillStyle = '#00d9ff';
      ctx.beginPath();
      ctx.moveTo(15, 25);
      ctx.lineTo(car.width - 15, 25);
      ctx.lineTo(car.width - 12, 45);
      ctx.lineTo(12, 45);
      ctx.closePath();
      ctx.fill();
      
      // AripioarƒÉ spate
      ctx.fillStyle = '#1a1a2e';
      ctx.fillRect(5, car.height - 15, car.width - 10, 12);
      
      // Ro»õi
      ctx.fillStyle = '#1a1a1a';
      ctx.fillRect(-8, 18, 12, 22);
      ctx.fillRect(car.width - 4, 18, 12, 22);
      ctx.fillRect(-8, car.height - 25, 12, 22);
      ctx.fillRect(car.width - 4, car.height - 25, 12, 22);
      
      // Detalii ro»õi
      ctx.fillStyle = '#e94560';
      ctx.beginPath();
      ctx.arc(0, 29, 5, 0, Math.PI * 2);
      ctx.arc(car.width, 29, 5, 0, Math.PI * 2);
      ctx.arc(0, car.height - 14, 5, 0, Math.PI * 2);
      ctx.arc(car.width, car.height - 14, 5, 0, Math.PI * 2);
      ctx.fill();
      
      // Faruri
      ctx.fillStyle = '#ffd700';
      ctx.beginPath();
      ctx.ellipse(15, 3, 8, 5, 0, 0, Math.PI * 2);
      ctx.ellipse(car.width - 15, 3, 8, 5, 0, 0, Math.PI * 2);
      ctx.fill();
      
      // LuminƒÉ faruri
      ctx.fillStyle = 'rgba(255, 215, 0, 0.3)';
      ctx.beginPath();
      ctx.moveTo(10, 0);
      ctx.lineTo(5, -30);
      ctx.lineTo(20, -30);
      ctx.lineTo(20, 0);
      ctx.fill();
      ctx.beginPath();
      ctx.moveTo(car.width - 20, 0);
      ctx.lineTo(car.width - 20, -30);
      ctx.lineTo(car.width - 5, -30);
      ctx.lineTo(car.width - 10, 0);
      ctx.fill();
      
      // Scut
      if (car.shield) {
        ctx.strokeStyle = 'rgba(0, 217, 255, 0.9)';
        ctx.lineWidth = 4;
        ctx.beginPath();
        ctx.ellipse(car.width/2, car.height/2, car.width * 0.8, car.height * 0.7, 0, 0, Math.PI * 2);
        ctx.stroke();
        ctx.fillStyle = 'rgba(0, 217, 255, 0.15)';
        ctx.fill();
        
        // Particule scut
        for (let i = 0; i < 6; i++) {
          const angle = Date.now() / 200 + i * (Math.PI * 2 / 6);
          const px = car.width/2 + Math.cos(angle) * car.width * 0.7;
          const py = car.height/2 + Math.sin(angle) * car.height * 0.6;
          ctx.fillStyle = 'rgba(0, 217, 255, 0.8)';
          ctx.beginPath();
          ctx.arc(px, py, 4, 0, Math.PI * 2);
          ctx.fill();
        }
      }
      
      ctx.restore();
    }
    
    function drawObstacle(obs) {
      ctx.fillStyle = 'rgba(0,0,0,0.4)';
      ctx.fillRect(obs.x + 4, obs.y + 4, obs.width, obs.height);
      
      const gradient = ctx.createLinearGradient(obs.x, obs.y, obs.x, obs.y + obs.height);
      gradient.addColorStop(0, obs.color);
      gradient.addColorStop(1, 'rgba(0,0,0,0.4)');
      ctx.fillStyle = gradient;
      ctx.fillRect(obs.x, obs.y, obs.width, obs.height);
      
      ctx.strokeStyle = 'rgba(255,255,255,0.6)';
      ctx.lineWidth = 3;
      ctx.strokeRect(obs.x, obs.y, obs.width, obs.height);
      
      // Dungi pericol
      ctx.fillStyle = 'rgba(0,0,0,0.3)';
      for (let i = 0; i < 3; i++) {
        ctx.beginPath();
        ctx.moveTo(obs.x + i * 20, obs.y);
        ctx.lineTo(obs.x + i * 20 + 15, obs.y + obs.height);
        ctx.lineTo(obs.x + i * 20 + 10, obs.y + obs.height);
        ctx.lineTo(obs.x + i * 20 - 5, obs.y);
        ctx.closePath();
        ctx.fill();
      }
      
      ctx.fillStyle = 'white';
      ctx.font = 'bold 28px Arial';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillText(obs.emoji, obs.x + obs.width/2, obs.y + obs.height/2);
    }
    
    function drawPowerUp(pu) {
      const glow = ctx.createRadialGradient(
        pu.x + pu.width/2, pu.y + pu.height/2, 0,
        pu.x + pu.width/2, pu.y + pu.height/2, pu.width * 1.5
      );
      glow.addColorStop(0, pu.color + 'AA');
      glow.addColorStop(1, 'transparent');
      ctx.fillStyle = glow;
      ctx.fillRect(pu.x - 15, pu.y - 15, pu.width + 30, pu.height + 30);
      
      ctx.fillStyle = pu.color;
      ctx.beginPath();
      ctx.arc(pu.x + pu.width/2, pu.y + pu.height/2, pu.width/2, 0, Math.PI * 2);
      ctx.fill();
      
      ctx.strokeStyle = 'white';
      ctx.lineWidth = 4;
      ctx.stroke();
      
      // Puls effect
      const pulse = 1 + Math.sin(Date.now() / 100) * 0.1;
      ctx.save();
      ctx.translate(pu.x + pu.width/2, pu.y + pu.height/2);
      ctx.scale(pulse, pulse);
      ctx.fillStyle = 'white';
      ctx.font = 'bold 28px Arial';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillText(pu.icon, 0, 0);
      ctx.restore();
    }
    
    function drawRoad() {
      // Asfalt
      ctx.fillStyle = '#2d2d2d';
      ctx.fillRect(25, 0, canvas.width - 50, canvas.height);
      
      // Linii laterale
      ctx.fillStyle = '#fff';
      ctx.fillRect(30, 0, 10, canvas.height);
      ctx.fillRect(canvas.width - 40, 0, 10, canvas.height);
      
      // Linii ro»ôii pe margini
      ctx.fillStyle = '#e94560';
      const stripeHeight = 30;
      const stripeGap = 30;
      const offset = (Date.now() / 50 * currentSpeed) % (stripeHeight + stripeGap);
      for (let y = -offset; y < canvas.height; y += stripeHeight + stripeGap) {
        ctx.fillRect(25, y, 5, stripeHeight);
        ctx.fillRect(canvas.width - 30, y, 5, stripeHeight);
      }
      
      // Linii centrale animate
      ctx.setLineDash([40, 35]);
      ctx.lineDashOffset = -Date.now() / 40 * currentSpeed;
      ctx.strokeStyle = '#ffd700';
      ctx.lineWidth = 6;
      ctx.beginPath();
      ctx.moveTo(canvas.width / 2, 0);
      ctx.lineTo(canvas.width / 2, canvas.height);
      ctx.stroke();
      ctx.setLineDash([]);
      
      // Speed lines
      ctx.fillStyle = 'rgba(0, 217, 255, 0.1)';
      for (let i = 0; i < 10; i++) {
        const x = 40 + i * 35;
        const y = ((Date.now() / 60 * currentSpeed) + i * 60) % canvas.height;
        ctx.fillRect(x, y, 4, 50);
      }
    }
    
    function drawGrid() {
      // Grid effect pentru senza»õia de vitezƒÉ
      ctx.strokeStyle = 'rgba(0, 217, 255, 0.15)';
      ctx.lineWidth = 1;
      const gridOffset = (Date.now() / 30 * currentSpeed) % 40;
      for (let y = gridOffset; y < canvas.height; y += 40) {
        ctx.beginPath();
        ctx.moveTo(25, y);
        ctx.lineTo(canvas.width - 25, y);
        ctx.stroke();
      }
    }
    
    // === UPDATE ===
    function update() {
      checkPowerUpExpiry();
      
      // Mi»ôcare ma»ôinƒÉ
      if (steeringAngle !== 0) {
        car.x += steeringAngle * car.speed;
        car.angle = steeringAngle * 18;
        
        if (car.x < 30) car.x = 30;
        if (car.x > canvas.width - car.width - 30) car.x = canvas.width - car.width - 30;
      } else {
        car.angle *= 0.85;
      }
      
      // Obstacole
      for (let i = obstacles.length - 1; i >= 0; i--) {
        const obs = obstacles[i];
        obs.y += currentSpeed;
        
        if (!obs.passed && obs.y > car.y + car.height) {
          obs.passed = true;
          score++;
          scoreVal.textContent = score;
          playSound('score');
          checkLevelUp();
          checkWin();
        }
        
        if (checkCollision(car, obs)) {
          if (car.shield) {
            car.shield = false;
            obstacles.splice(i, 1);
            updatePowerUpIndicator();
            playSound('powerup');
            createExplosion(obs.x + obs.width/2, obs.y + obs.height/2);
            document.getElementById('steeringWheel').classList.add('vibrating');
            setTimeout(() => {
              document.getElementById('steeringWheel').classList.remove('vibrating');
            }, 300);
          } else {
            // GAME OVER - fƒÉrƒÉ scut
            createExplosion(car.x + car.width/2, car.y + car.height/2);
            playSound('collision');
            endGame();
            return;
          }
        }
        
        if (obs.y > canvas.height) obstacles.splice(i, 1);
      }
      
      // Power-ups
      for (let i = powerUps.length - 1; i >= 0; i--) {
        const pu = powerUps[i];
        pu.y += currentSpeed;
        
        if (checkCollision(car, pu)) {
          activatePowerUp(pu.effect);
          powerUps.splice(i, 1);
          continue;
        }
        
        if (pu.y > canvas.height) powerUps.splice(i, 1);
      }
    }
    
    // === GAME OVER ===
    function endGame() {
      gameRunning = false;
      cancelAnimationFrame(animationId);
      
      finalScoreEl.textContent = score;
      finalLevelEl.textContent = level;
      
      if (score > highScore) {
        highScore = score;
        localStorage.setItem('carGameHighScore', highScore);
        personalBestEl.textContent = highScore + ' üî•';
      } else {
        personalBestEl.textContent = highScore;
      }
      
      if (score >= 30) {
        messageEl.textContent = 'E»òTI UN ADEVƒÇRAT CAMPION! üèÜ';
      } else if (score >= 20) {
        messageEl.textContent = 'FOARTE BINE, CAMPIONULE! üí™';
      } else if (score >= 10) {
        messageEl.textContent = 'BINE! MAI PO»öI MAI MULT! üöÄ';
      } else {
        messageEl.textContent = '√éNCEARCƒÇ DIN NOU, EROULE! üèéÔ∏è';
      }
      
      gameOverScreen.classList.remove('hidden');
    }
    
    // === GAME LOOP ===
    function gameLoop() {
      if (!gameRunning || gamePaused) return;
      
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      drawGrid();
      drawRoad();
      powerUps.forEach(drawPowerUp);
      obstacles.forEach(drawObstacle);
      drawCar();
      
      update();
      
      animationId = requestAnimationFrame(gameLoop);
    }
    
    // === PREVENIRE SCROLL ===
    document.addEventListener('touchmove', (e) => {
      if (gameRunning) e.preventDefault();
    }, { passive: false });
    
    // === INIT AUDIO ===
    document.addEventListener('click', () => {
      if (audioCtx.state === 'suspended') audioCtx.resume();
    }, { once: true });
  </script>
</body>
</html>




