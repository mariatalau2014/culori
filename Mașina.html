

<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>üöó Ma»ôinu»õa Mea - VitezƒÉ MaximƒÉ</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      touch-action: none;
    }
    body {
      background: linear-gradient(135deg, #6a1b9a 0%, #4a148c 100%);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      overflow: hidden;
      user-select: none;
    }
    #gameContainer {
      position: relative;
      width: 360px;
      max-width: 95vw;
    }
    canvas {
      background: linear-gradient(180deg, #1a1a2e 0%, #2d1b4e 100%);
      border: 4px solid #9c27b0;
      border-radius: 15px 15px 0 0;
      display: block;
      margin: 0 auto;
      box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    }
    
    /* === ZONE DE CONTROL PE ECRAN === */
    #touchControls {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 180px;
      display: flex;
      z-index: 5;
    }
    .touchZone {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.1s;
    }
    .touchZone:active, .touchZone.active {
      background: rgba(156, 39, 176, 0.2);
    }
    .touchZone.left {
      border-right: 2px dashed rgba(156, 39, 176, 0.2);
    }
    .touchHint {
      font-size: 50px;
      opacity: 0.2;
      color: white;
    }
    
    /* === VOLAN === */
    #steeringWheel {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      width: 150px;
      height: 150px;
      z-index: 20;
    }
    #wheelBase {
      position: absolute;
      width: 100%;
      height: 100%;
      background: linear-gradient(145deg, #2d2d2d, #1a1a1a);
      border-radius: 50%;
      border: 5px solid #555;
      box-shadow: 0 5px 25px rgba(0,0,0,0.6), inset 0 2px 10px rgba(255,255,255,0.1);
    }
    #wheelRim {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 130px;
      height: 130px;
      border-radius: 50%;
      border: 10px solid #333;
      background: transparent;
      box-shadow: inset 0 2px 5px rgba(0,0,0,0.5);
    }
    #wheelCenter {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 55px;
      height: 55px;
      background: linear-gradient(145deg, #9c27b0, #7b1fa2);
      border-radius: 50%;
      border: 4px solid #ce93d8;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      box-shadow: 0 3px 15px rgba(0,0,0,0.4);
    }
    #wheelSpoke1, #wheelSpoke2, #wheelSpoke3 {
      position: absolute;
      top: 50%;
      left: 50%;
      background: linear-gradient(90deg, #444, #222);
      transform-origin: left center;
    }
    #wheelSpoke1 {
      width: 65px;
      height: 14px;
      transform: translate(-50%, -50%) rotate(90deg);
    }
    #wheelSpoke2 {
      width: 65px;
      height: 14px;
      transform: translate(-50%, -50%) rotate(-30deg);
    }
    #wheelSpoke3 {
      width: 65px;
      height: 14px;
      transform: translate(-50%, -50%) rotate(210deg);
    }
    #wheelRotation {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      transition: transform 0.08s ease-out;
    }
    #wheelIndicator {
      position: absolute;
      top: 8px;
      left: 50%;
      transform: translateX(-50%);
      width: 10px;
      height: 18px;
      background: #ff5722;
      border-radius: 5px;
      box-shadow: 0 0 15px #ff5722;
    }
    #speedDisplay {
      position: absolute;
      bottom: -35px;
      left: 50%;
      transform: translateX(-50%);
      color: #ce93d8;
      font-size: 16px;
      font-weight: bold;
      white-space: nowrap;
      text-shadow: 0 0 10px #9c27b0;
    }
    #scoreDisplay {
      position: absolute;
      bottom: -55px;
      left: 50%;
      transform: translateX(-50%);
      color: #ffd700;
      font-size: 18px;
      font-weight: bold;
      white-space: nowrap;
      text-shadow: 0 0 10px #ff9800;
    }
    
    /* === BUTON PAUZƒÇ === */
    #pauseBtn {
      position: absolute;
      bottom: 180px;
      right: 15px;
      width: 45px;
      height: 45px;
      border-radius: 50%;
      font-size: 20px;
      z-index: 25;
      border: 3px solid rgba(255,255,255,0.3);
      background: rgba(255, 152, 0, 0.8);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    /* === ECRANE === */
    #startScreen, #gameOver, #levelUp, #pauseScreen {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: calc(100% - 160px);
      background: rgba(26, 26, 46, 0.98);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      color: white;
      border-radius: 15px 15px 0 0;
      text-align: center;
      padding: 25px;
      z-index: 30;
    }
    #startScreen h1 {
      font-size: 28px;
      margin-bottom: 15px;
      background: linear-gradient(90deg, #ce93d8, #f48fb1);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    #gameOver h2, #levelUp h2 {
      font-size: 26px;
      margin-bottom: 15px;
      color: #ce93d8;
    }
    .info-text {
      margin: 8px 0;
      font-size: 14px;
      max-width: 280px;
      color: #e1bee7;
      line-height: 1.5;
    }
    .stat-row {
      display: flex;
      justify-content: space-between;
      width: 100%;
      max-width: 260px;
      margin: 8px 0;
      padding: 8px 12px;
      background: rgba(156, 39, 176, 0.3);
      border-radius: 8px;
      font-size: 14px;
    }
    .actionBtn {
      margin-top: 20px;
      background: linear-gradient(145deg, #7e57c2, #5e35b1);
      color: white;
      border: none;
      padding: 15px 40px;
      border-radius: 30px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 5px 20px rgba(126, 87, 194, 0.6);
      transition: all 0.2s;
      border: 2px solid #b39ddb;
    }
    .actionBtn:hover, .actionBtn:active {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(126, 87, 194, 0.8);
    }
    .hidden {
      display: none !important;
    }
    
    /* === POWER-UP INDICATOR === */
    #powerUpIndicator {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 8px;
      z-index: 10;
    }
    .power-icon {
      width: 35px;
      height: 35px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      animation: pulse 0.8s infinite;
    }
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.15); }
    }
    .shield { background: #4fc3f7; box-shadow: 0 0 15px #4fc3f7; }
    .speed { background: #ff7043; box-shadow: 0 0 15px #ff7043; }
    .double { background: #66bb6a; box-shadow: 0 0 15px #66bb6a; }
    
    /* === VIBRA»öIE VOLAN === */
    @keyframes vibrate {
      0%, 100% { transform: translateX(-50%) rotate(0deg); }
      25% { transform: translateX(-50%) rotate(-3deg); }
      75% { transform: translateX(-50%) rotate(3deg); }
    }
    .vibrating {
      animation: vibrate 0.08s infinite;
    }
    
    /* === SPEED LINES EFFECT === */
    @keyframes speedLines {
      0% { opacity: 0; transform: translateY(-100px); }
      50% { opacity: 1; }
      100% { opacity: 0; transform: translateY(500px); }
    }
    .speed-line {
      position: absolute;
      width: 2px;
      height: 50px;
      background: rgba(255,255,255,0.3);
      animation: speedLines 0.5s linear infinite;
    }
  </style>
</head>
<body>
  <div id="gameContainer">
    <canvas id="game" width="360" height="450"></canvas>
    
    <!-- ZONE DE CONTROL PE ECRAN -->
    <div id="touchControls">
      <div class="touchZone left" id="touchLeft">
        <span class="touchHint">‚óÄ</span>
      </div>
      <div class="touchZone right" id="touchRight">
        <span class="touchHint">‚ñ∂</span>
      </div>
    </div>
    
    <!-- BUTON PAUZƒÇ -->
    <button id="pauseBtn">‚è∏</button>
    
    <!-- POWER-UP INDICATOR -->
    <div id="powerUpIndicator"></div>
    
    <!-- VOLAN -->
    <div id="steeringWheel">
      <div id="wheelRotation">
        <div id="wheelBase"></div>
        <div id="wheelRim"></div>
        <div id="wheelSpoke1"></div>
        <div id="wheelSpoke2"></div>
        <div id="wheelSpoke3"></div>
        <div id="wheelCenter">üöó</div>
        <div id="wheelIndicator"></div>
      </div>
      <div id="speedDisplay">‚ö° <span id="speedVal">5</span>x</div>
      <div id="scoreDisplay">üèÜ <span id="scoreVal">0</span>/100</div>
    </div>
    
    <!-- ECRANE -->
    <div id="startScreen">
      <h1>üèÅ VITEZƒÇ MAXIMƒÇ</h1>
      <p class="info-text">üëÜ Atinge ST√ÇNGA sau DREAPTA ecranului</p>
      <p class="info-text">üéÆ Sau folose»ôte VOLANUL de jos!</p>
      <p class="info-text" style="color: #ff7043; font-weight: bold;">‚ö° VITEZƒÇ MARE - Fii atent!</p>
      <div class="stat-row">
        <span>üü† Normal:</span>
        <span>+1 punct</span>
      </div>
      <div class="stat-row">
        <span>üî¥ Rapid:</span>
        <span>+2 puncte</span>
      </div>
      <div class="stat-row">
        <span>üíé Power-up:</span>
        <span>Special</span>
      </div>
      <div class="stat-row">
        <span>‚ö†Ô∏è Coliziune:</span>
        <span>-5 puncte</span>
      </div>
      <button class="actionBtn" id="startBtn">üöÄ START</button>
    </div>
    
    <div id="gameOver" class="hidden">
      <h2>üí• Joc Terminat!</h2>
      <div class="stat-row">
        <span>üèÜ Scor:</span>
        <span id="finalScore">0</span>
      </div>
      <div class="stat-row">
        <span>üìä Nivel:</span>
        <span id="finalLevel">1</span>
      </div>
      <div class="stat-row">
        <span>ü•á Record:</span>
        <span id="personalBest">0</span>
      </div>
      <p id="message" class="info-text">√éncearcƒÉ din nou!</p>
      <button class="actionBtn" id="restartBtn">üîÑ REIA</button>
    </div>
    
    <div id="levelUp" class="hidden">
      <h2>üéâ NIVEL NOU!</h2>
      <p id="levelUpText" class="info-text">Ai ajuns la nivelul 2!</p>
      <p class="info-text" style="color: #ff7043;">‚ö° Viteza cre»ôte!</p>
      <button class="actionBtn" id="continueBtn">‚ñ∂ CONTINUƒÇ</button>
    </div>
    
    <div id="pauseScreen" class="hidden">
      <h2>‚è∏Ô∏è PauzƒÉ</h2>
      <p class="info-text">ApasƒÉ pentru a continua</p>
      <button class="actionBtn" id="resumeBtn">‚ñ∂ CONTINUƒÇ</button>
    </div>
  </div>

  <script>
    // === CONFIG ===
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const scoreVal = document.getElementById('scoreVal');
    const speedVal = document.getElementById('speedVal');
    const finalScoreEl = document.getElementById('finalScore');
    const finalLevelEl = document.getElementById('finalLevel');
    const personalBestEl = document.getElementById('personalBest');
    const messageEl = document.getElementById('message');
    const levelUpText = document.getElementById('levelUpText');
    const startScreen = document.getElementById('startScreen');
    const gameOverScreen = document.getElementById('gameOver');
    const levelUpScreen = document.getElementById('levelUp');
    const pauseScreen = document.getElementById('pauseScreen');
    const powerUpIndicator = document.getElementById('powerUpIndicator');
    const wheelRotation = document.getElementById('wheelRotation');
    const touchLeft = document.getElementById('touchLeft');
    const touchRight = document.getElementById('touchRight');
    
    const startBtn = document.getElementById('startBtn');
    const restartBtn = document.getElementById('restartBtn');
    const continueBtn = document.getElementById('continueBtn');
    const resumeBtn = document.getElementById('resumeBtn');
    const pauseBtn = document.getElementById('pauseBtn');

    // === AUDIO ===
    let soundEnabled = true;
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    
    function playSound(type) {
      if (!soundEnabled) return;
      try {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        
        const now = audioCtx.currentTime;
        
        switch(type) {
          case 'score':
            osc.frequency.setValueAtTime(880, now);
            osc.frequency.exponentialRampToValueAtTime(1200, now + 0.08);
            gain.gain.setValueAtTime(0.15, now);
            gain.gain.exponentialRampToValueAtTime(0.01, now + 0.08);
            osc.start(now);
            osc.stop(now + 0.08);
            break;
          case 'powerup':
            osc.frequency.setValueAtTime(600, now);
            osc.frequency.exponentialRampToValueAtTime(1500, now + 0.2);
            gain.gain.setValueAtTime(0.2, now);
            gain.gain.exponentialRampToValueAtTime(0.01, now + 0.2);
            osc.start(now);
            osc.stop(now + 0.2);
            break;
          case 'collision':
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(150, now);
            osc.frequency.exponentialRampToValueAtTime(50, now + 0.25);
            gain.gain.setValueAtTime(0.25, now);
            gain.gain.exponentialRampToValueAtTime(0.01, now + 0.25);
            osc.start(now);
            osc.stop(now + 0.25);
            break;
          case 'levelup':
            osc.type = 'square';
            osc.frequency.setValueAtTime(523, now);
            gain.gain.setValueAtTime(0.15, now);
            gain.gain.exponentialRampToValueAtTime(0.01, now + 0.15);
            osc.start(now);
            osc.stop(now + 0.15);
            
            setTimeout(() => {
              const osc2 = audioCtx.createOscillator();
              const gain2 = audioCtx.createGain();
              osc2.connect(gain2);
              gain2.connect(audioCtx.destination);
              osc2.type = 'square';
              osc2.frequency.setValueAtTime(659, audioCtx.currentTime);
              gain2.gain.setValueAtTime(0.15, audioCtx.currentTime);
              gain2.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.15);
              osc2.start();
              osc2.stop(audioCtx.currentTime + 0.15);
            }, 120);
            break;
          case 'gameover':
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(400, now);
            osc.frequency.exponentialRampToValueAtTime(100, now + 0.4);
            gain.gain.setValueAtTime(0.25, now);
            gain.gain.exponentialRampToValueAtTime(0.01, now + 0.4);
            osc.start(now);
            osc.stop(now + 0.4);
            break;
        }
      } catch(e) {}
    }

    // === STARE JOC ===
    let gameRunning = false;
    let gamePaused = false;
    let score = 0;
    let baseSpeed = 5;
    let currentSpeed = 5;
    let level = 1;
    let animationId;
    let highScore = localStorage.getItem('carGameHighScore') || 0;
    
    // === MA»òINA ===
    const car = {
      x: canvas.width / 2 - 25,
      y: canvas.height - 90,
      width: 50,
      height: 70,
      speed: 8,
      color: '#4fc3f7',
      shield: false,
      shieldTime: 0,
      doublePoints: false,
      doubleTime: 0,
      angle: 0
    };
    
    // === OBSTACOLE ===
    let obstacles = [];
    let powerUps = [];
    const obstacleTypes = [
      { color: '#ff7043', points: 1, speedMod: 1, name: 'normal' },
      { color: '#e91e63', points: 2, speedMod: 1.3, name: 'fast' },
      { color: '#7e57c2', points: 3, speedMod: 0.9, name: 'slow' }
    ];
    const powerUpTypes = [
      { color: '#4fc3f7', effect: 'shield', icon: 'üõ°Ô∏è', duration: 4000 },
      { color: '#ff7043', effect: 'speed', icon: '‚ö°', duration: 2500 },
      { color: '#66bb6a', effect: 'double', icon: 'üíé', duration: 3500 }
    ];
    
    // === NIVELURI (VITEZE MARI) ===
    const levels = [
      { score: 0, speed: 5, obstacleRate: 800, name: 'Rapid' },
      { score: 20, speed: 7, obstacleRate: 650, name: 'Foarte Rapid' },
      { score: 40, speed: 9, obstacleRate: 500, name: 'VitezƒÉ' },
      { score: 60, speed: 11, obstacleRate: 400, name: 'Super VitezƒÉ' },
      { score: 80, speed: 13, obstacleRate: 300, name: 'MAXIM' }
    ];
    
    // === CONTROALE ===
    let steeringAngle = 0;
    let lastObstacleTime = 0;
    let lastPowerUpTime = 0;
    
    // === VOLAN ===
    let isDragging = false;
    const maxSteerAngle = 50;
    
    function updateSteering(clientX) {
      const rect = document.getElementById('steeringWheel').getBoundingClientRect();
      const centerX = rect.left + rect.width / 2;
      const deltaX = clientX - centerX;
      const maxDelta = 75;
      steeringAngle = Math.max(-1, Math.min(1, deltaX / maxDelta));
      
      const rotation = steeringAngle * maxSteerAngle;
      wheelRotation.style.transform = `rotate(${rotation}deg)`;
    }
    
    document.getElementById('steeringWheel').addEventListener('mousedown', (e) => {
      if (!gameRunning || gamePaused) return;
      isDragging = true;
      updateSteering(e.clientX);
    });
    
    document.addEventListener('mousemove', (e) => {
      if (!isDragging) return;
      updateSteering(e.clientX);
    });
    
    document.addEventListener('mouseup', () => {
      isDragging = false;
      steeringAngle = 0;
      wheelRotation.style.transform = 'rotate(0deg)';
    });
    
    document.getElementById('steeringWheel').addEventListener('touchstart', (e) => {
      if (!gameRunning || gamePaused) return;
      e.preventDefault();
      isDragging = true;
      updateSteering(e.touches[0].clientX);
    }, { passive: false });
    
    document.addEventListener('touchmove', (e) => {
      if (!isDragging) return;
      updateSteering(e.touches[0].clientX);
    }, { passive: false });
    
    document.addEventListener('touchend', () => {
      isDragging = false;
      steeringAngle = 0;
      wheelRotation.style.transform = 'rotate(0deg)';
    });
    
    // === ZONE TOUCH ===
    function handleTouchLeft(e) {
      e.preventDefault();
      if (!gameRunning || gamePaused) return;
      steeringAngle = -1;
      wheelRotation.style.transform = `rotate(-${maxSteerAngle}deg)`;
      touchLeft.classList.add('active');
    }
    
    function handleTouchRight(e) {
      e.preventDefault();
      if (!gameRunning || gamePaused) return;
      steeringAngle = 1;
      wheelRotation.style.transform = `rotate(${maxSteerAngle}deg)`;
      touchRight.classList.add('active');
    }
    
    function releaseTouch() {
      steeringAngle = 0;
      wheelRotation.style.transform = 'rotate(0deg)';
      touchLeft.classList.remove('active');
      touchRight.classList.remove('active');
    }
    
    touchLeft.addEventListener('touchstart', handleTouchLeft, { passive: false });
    touchLeft.addEventListener('touchend', releaseTouch);
    touchLeft.addEventListener('mousedown', handleTouchLeft);
    touchLeft.addEventListener('mouseup', releaseTouch);
    touchLeft.addEventListener('mouseleave', releaseTouch);
    
    touchRight.addEventListener('touchstart', handleTouchRight, { passive: false });
    touchRight.addEventListener('touchend', releaseTouch);
    touchRight.addEventListener('mousedown', handleTouchRight);
    touchRight.addEventListener('mouseup', releaseTouch);
    touchRight.addEventListener('mouseleave', releaseTouch);
    
    // === TASTATURƒÇ ===
    window.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowLeft') {
        steeringAngle = -1;
        wheelRotation.style.transform = `rotate(-${maxSteerAngle}deg)`;
      }
      if (e.key === 'ArrowRight') {
        steeringAngle = 1;
        wheelRotation.style.transform = `rotate(${maxSteerAngle}deg)`;
      }
      if (e.key === 'Escape' && gameRunning) togglePause();
      if (e.key === ' ' && gameRunning) togglePause();
    });
    
    window.addEventListener('keyup', (e) => {
      if (e.key === 'ArrowLeft' || e.key === 'ArrowRight') {
        steeringAngle = 0;
        wheelRotation.style.transform = 'rotate(0deg)';
      }
    });
    
    // === BUTOANE ===
    pauseBtn.addEventListener('click', () => {
      if (gameRunning) togglePause();
    });
    
    function resetCar() {
      car.x = canvas.width / 2 - 25;
      car.shield = false;
      car.doublePoints = false;
      car.angle = 0;
      updatePowerUpIndicator();
      steeringAngle = 0;
      wheelRotation.style.transform = 'rotate(0deg)';
    }
    
    // === START JOC ===
    function startGame() {
      startScreen.classList.add('hidden');
      gameOverScreen.classList.add('hidden');
      levelUpScreen.classList.add('hidden');
      pauseScreen.classList.add('hidden');
      
      score = 0;
      level = 1;
      baseSpeed = levels[0].speed;
      currentSpeed = baseSpeed;
      scoreVal.textContent = score;
      speedVal.textContent = currentSpeed;
      
      resetCar();
      obstacles = [];
      powerUps = [];
      lastObstacleTime = Date.now();
      lastPowerUpTime = Date.now();
      
      gameRunning = true;
      gamePaused = false;
      gameLoop();
      spawnLoop();
    }
    
    startBtn.addEventListener('click', startGame);
    restartBtn.addEventListener('click', startGame);
    continueBtn.addEventListener('click', () => {
      levelUpScreen.classList.add('hidden');
      gameRunning = true;
      gameLoop();
      spawnLoop();
    });
    resumeBtn.addEventListener('click', togglePause);
    
    // === PAUZƒÇ ===
    function togglePause() {
      if (!gameRunning) return;
      gamePaused = !gamePaused;
      if (gamePaused) {
        cancelAnimationFrame(animationId);
        pauseScreen.classList.remove('hidden');
      } else {
        pauseScreen.classList.add('hidden');
        gameLoop();
        spawnLoop();
      }
    }
    
    // === SPAWN ===
    function spawnLoop() {
      if (!gameRunning || gamePaused) return;
      
      const currentLevel = levels[Math.min(level - 1, levels.length - 1)];
      const now = Date.now();
      
      if (now - lastObstacleTime > currentLevel.obstacleRate / currentSpeed) {
        spawnObstacle();
        lastObstacleTime = now;
      }
      
      if (now - lastPowerUpTime > 5000) {
        if (Math.random() < 0.4) spawnPowerUp();
        lastPowerUpTime = now;
      }
      
      setTimeout(spawnLoop, 50);
    }
    
    function spawnObstacle() {
      if (!gameRunning || gamePaused) return;
      const type = obstacleTypes[Math.floor(Math.random() * obstacleTypes.length)];
      const width = 35 + Math.random() * 35;
      obstacles.push({
        x: Math.random() * (canvas.width - width),
        y: -60,
        width: width,
        height: 45,
        ...type,
        passed: false
      });
    }
    
    function spawnPowerUp() {
      if (!gameRunning || gamePaused) return;
      const type = powerUpTypes[Math.floor(Math.random() * powerUpTypes.length)];
      powerUps.push({
        x: Math.random() * (canvas.width - 40),
        y: -50,
        width: 40,
        height: 40,
        ...type,
        collected: false
      });
    }
    
    // === COLIZIUNE ===
    function checkCollision(a, b) {
      return a.x < b.x + b.width && a.x + a.width > b.x &&
             a.y < b.y + b.height && a.y + a.height > b.y;
    }
    
    // === POWER-UP ===
    function updatePowerUpIndicator() {
      powerUpIndicator.innerHTML = '';
      if (car.shield) {
        const icon = document.createElement('div');
        icon.className = 'power-icon shield';
        icon.textContent = 'üõ°Ô∏è';
        powerUpIndicator.appendChild(icon);
      }
      if (car.doublePoints) {
        const icon = document.createElement('div');
        icon.className = 'power-icon double';
        icon.textContent = 'üíé';
        powerUpIndicator.appendChild(icon);
      }
    }
    
    function activatePowerUp(type) {
      playSound('powerup');
      switch(type) {
        case 'shield':
          car.shield = true;
          car.shieldTime = Date.now() + 4000;
          break;
        case 'speed':
          currentSpeed = Math.min(15, currentSpeed + 3);
          speedVal.textContent = currentSpeed;
          setTimeout(() => {
            currentSpeed = baseSpeed;
            speedVal.textContent = currentSpeed;
          }, 2500);
          break;
        case 'double':
          car.doublePoints = true;
          car.doubleTime = Date.now() + 3500;
          break;
      }
      updatePowerUpIndicator();
    }
    
    function checkPowerUpExpiry() {
      const now = Date.now();
      if (car.shield && now > car.shieldTime) {
        car.shield = false;
        updatePowerUpIndicator();
      }
      if (car.doublePoints && now > car.doubleTime) {
        car.doublePoints = false;
        updatePowerUpIndicator();
      }
    }
    
    function checkLevelUp() {
      const nextLevel = levels[Math.min(level, levels.length - 1)];
      if (score >= nextLevel.score && level < levels.length) {
        level++;
        baseSpeed = levels[level - 1].speed;
        currentSpeed = baseSpeed;
        speedVal.textContent = currentSpeed;
        playSound('levelup');
        gameRunning = false;
        cancelAnimationFrame(animationId);
        levelUpText.textContent = `Nivel ${level}: ${levels[level-1].name}!`;
        levelUpScreen.classList.remove('hidden');
      }
    }
    
    function checkWin() {
      if (score >= 100) {
        gameRunning = false;
        cancelAnimationFrame(animationId);
        messageEl.textContent = 'üèÜ LEGENDAR! Ai c√¢»ôtigat!';
        endGame();
      }
    }
    
    // === DESENARE ===
    function drawCar() {
      ctx.save();
      ctx.translate(car.x + car.width/2, car.y + car.height/2);
      ctx.rotate(car.angle * Math.PI / 180);
      ctx.translate(-car.width/2, -car.height/2);
      
      // UmbrƒÉ
      ctx.fillStyle = 'rgba(0,0,0,0.4)';
      ctx.fillRect(5, 5, car.width, car.height);
      
      // Corp
      const gradient = ctx.createLinearGradient(0, 0, car.width, 0);
      gradient.addColorStop(0, car.color);
      gradient.addColorStop(0.5, '#81d4fa');
      gradient.addColorStop(1, car.color);
      ctx.fillStyle = gradient;
      ctx.fillRect(0, 0, car.width, car.height);
      
      // Dungi de vitezƒÉ
      ctx.fillStyle = 'rgba(255,255,255,0.4)';
      ctx.fillRect(car.width/2 - 6, 0, 12, car.height);
      
      // Geamuri
      ctx.fillStyle = '#1a237e';
      ctx.fillRect(8, 15, car.width - 16, 18);
      
      // Ro»õi
      ctx.fillStyle = '#212121';
      ctx.fillRect(-5, 12, 8, 15);
      ctx.fillRect(car.width - 3, 12, 8, 15);
      ctx.fillRect(-5, 43, 8, 15);
      ctx.fillRect(car.width - 3, 43, 8, 15);
      
      // Faruri
      ctx.fillStyle = '#ffeb3b';
      ctx.fillRect(8, 0, 10, 6);
      ctx.fillRect(car.width - 18, 0, 10, 6);
      
      // Flame effect la vitezƒÉ mare
      if (currentSpeed >= 10) {
        ctx.fillStyle = `rgba(255, ${100 - currentSpeed * 5}, 0, 0.8)`;
        ctx.beginPath();
        ctx.moveTo(car.width/2 - 10, car.height);
        ctx.lineTo(car.width/2 - 5, car.height + 15 + Math.random() * 10);
        ctx.lineTo(car.width/2, car.height);
        ctx.fill();
        ctx.beginPath();
        ctx.moveTo(car.width/2 + 10, car.height);
        ctx.lineTo(car.width/2 + 5, car.height + 15 + Math.random() * 10);
        ctx.lineTo(car.width/2, car.height);
        ctx.fill();
      }
      
      // Scut
      if (car.shield) {
        ctx.strokeStyle = 'rgba(79, 195, 247, 0.9)';
        ctx.lineWidth = 5;
        ctx.beginPath();
        ctx.arc(car.width/2, car.height/2, car.width * 0.85, 0, Math.PI * 2);
        ctx.stroke();
        ctx.fillStyle = 'rgba(79, 195, 247, 0.15)';
        ctx.fill();
      }
      
      ctx.restore();
    }
    
    function drawObstacle(obs) {
      ctx.fillStyle = 'rgba(0,0,0,0.4)';
      ctx.fillRect(obs.x + 3, obs.y + 3, obs.width, obs.height);
      
      const gradient = ctx.createLinearGradient(obs.x, obs.y, obs.x, obs.y + obs.height);
      gradient.addColorStop(0, obs.color);
      gradient.addColorStop(1, 'rgba(0,0,0,0.4)');
      ctx.fillStyle = gradient;
      ctx.fillRect(obs.x, obs.y, obs.width, obs.height);
      
      ctx.strokeStyle = 'rgba(255,255,255,0.5)';
      ctx.lineWidth = 2;
      ctx.strokeRect(obs.x, obs.y, obs.width, obs.height);
      
      ctx.fillStyle = 'rgba(255,255,255,0.25)';
      ctx.fillRect(obs.x + 5, obs.y + 5, obs.width - 10, obs.height - 10);
      
      ctx.fillStyle = 'white';
      ctx.font = 'bold 18px Arial';
      ctx.textAlign = 'center';
      let icon = 'üì¶';
      if (obs.name === 'fast') icon = '‚ö°';
      if (obs.name === 'slow') icon = 'üî∑';
      ctx.fillText(icon, obs.x + obs.width/2, obs.y + obs.height/2 + 6);
    }
    
    function drawPowerUp(pu) {
      const glow = ctx.createRadialGradient(
        pu.x + pu.width/2, pu.y + pu.height/2, 0,
        pu.x + pu.width/2, pu.y + pu.height/2, pu.width * 1.5
      );
      glow.addColorStop(0, pu.color + 'AA');
      glow.addColorStop(1, 'transparent');
      ctx.fillStyle = glow;
      ctx.fillRect(pu.x - 15, pu.y - 15, pu.width + 30, pu.height + 30);
      
      ctx.fillStyle = pu.color;
      ctx.beginPath();
      ctx.arc(pu.x + pu.width/2, pu.y + pu.height/2, pu.width/2, 0, Math.PI * 2);
      ctx.fill();
      
      ctx.strokeStyle = 'white';
      ctx.lineWidth = 3;
      ctx.stroke();
      
      ctx.fillStyle = 'white';
      ctx.font = 'bold 22px Arial';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillText(pu.icon, pu.x + pu.width/2, pu.y + pu.height/2);
    }
    
    function drawRoad() {
      // Linii laterale
      ctx.fillStyle = 'rgba(255,255,255,0.4)';
      ctx.fillRect(5, 0, 10, canvas.height);
      ctx.fillRect(canvas.width - 15, 0, 10, canvas.height);
      
      // Linii centrale animate
      ctx.setLineDash([35, 30]);
      ctx.lineDashOffset = -Date.now() / 30 * currentSpeed;
      ctx.strokeStyle = 'rgba(255,255,255,0.5)';
      ctx.lineWidth = 5;
      ctx.beginPath();
      ctx.moveTo(canvas.width / 2, 0);
      ctx.lineTo(canvas.width / 2, canvas.height);
      ctx.stroke();
      ctx.setLineDash([]);
      
      // Speed lines
      ctx.fillStyle = 'rgba(255,255,255,0.08)';
      const speedLines = 8;
      for (let i = 0; i < speedLines; i++) {
        const x = (i * canvas.width / speedLines) + 20;
        const y = ((Date.now() / 80 * currentSpeed) + i * 80) % canvas.height;
        ctx.fillRect(x, y, 3, 40);
      }
    }
    
    function drawParticles() {
      if (car.shield) {
        for (let i = 0; i < 4; i++) {
          const angle = Date.now() / 150 + i * (Math.PI * 2 / 4);
          const x = car.x + car.width/2 + Math.cos(angle) * car.width * 0.7;
          const y = car.y + car.height/2 + Math.sin(angle) * car.height * 0.7;
          ctx.fillStyle = 'rgba(79, 195, 247, 0.7)';
          ctx.beginPath();
          ctx.arc(x, y, 5, 0, Math.PI * 2);
          ctx.fill();
        }
      }
    }
    
    // === UPDATE ===
    function update() {
      checkPowerUpExpiry();
      
      // Mi»ôcare ma»ôinƒÉ
      if (steeringAngle !== 0) {
        car.x += steeringAngle * car.speed;
        car.angle = steeringAngle * 18;
        
        if (car.x < 15) car.x = 15;
        if (car.x > canvas.width - car.width - 15) car.x = canvas.width - car.width - 15;
      } else {
        car.angle *= 0.85;
      }
      
      // Obstacole
      for (let i = obstacles.length - 1; i >= 0; i--) {
        const obs = obstacles[i];
        obs.y += currentSpeed * obs.speedMod;
        
        if (!obs.passed && obs.y > car.y + car.height) {
          obs.passed = true;
          let points = obs.points;
          if (car.doublePoints) points *= 2;
          score = Math.min(100, score + points);
          scoreVal.textContent = score;
          playSound('score');
          checkLevelUp();
          checkWin();
        }
        
        if (checkCollision(car, obs)) {
          if (car.shield) {
            car.shield = false;
            obstacles.splice(i, 1);
            updatePowerUpIndicator();
            playSound('powerup');
            document.getElementById('steeringWheel').classList.add('vibrating');
            setTimeout(() => {
              document.getElementById('steeringWheel').classList.remove('vibrating');
            }, 250);
          } else {
            score = Math.max(0, score - 5);
            scoreVal.textContent = score;
            playSound('collision');
            endGame();
            return;
          }
        }
        
        if (obs.y > canvas.height) obstacles.splice(i, 1);
      }
      
      // Power-ups
      for (let i = powerUps.length - 1; i >= 0; i--) {
        const pu = powerUps[i];
        pu.y += currentSpeed;
        
        if (checkCollision(car, pu)) {
          activatePowerUp(pu.effect);
          powerUps.splice(i, 1);
          continue;
        }
        
        if (pu.y > canvas.height) powerUps.splice(i, 1);
      }
    }
    
    // === GAME OVER ===
    function endGame() {
      gameRunning = false;
      cancelAnimationFrame(animationId);
      
      finalScoreEl.textContent = score;
      finalLevelEl.textContent = level;
      
      if (score > highScore) {
        highScore = score;
        localStorage.setItem('carGameHighScore', highScore);
        personalBestEl.textContent = highScore + ' (NOU!)';
      } else {
        personalBestEl.textContent = highScore;
      }
      
      if (score >= 100) {
        messageEl.textContent = 'üèÜ LEGENDAR! E»ôti cel mai bun!';
      } else if (score >= 80) {
        messageEl.textContent = 'üåü EXCELENT! VitezƒÉ maximƒÉ!';
      } else if (score >= 50) {
        messageEl.textContent = 'üëç Bine! Mai po»õi mai repede!';
      } else {
        messageEl.textContent = 'üí™ √éncearcƒÉ din nou!';
      }
      
      playSound('gameover');
      gameOverScreen.classList.remove('hidden');
    }
    
    // === GAME LOOP ===
    function gameLoop() {
      if (!gameRunning || gamePaused) return;
      
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      drawRoad();
      powerUps.forEach(drawPowerUp);
      obstacles.forEach(drawObstacle);
      drawCar();
      drawParticles();
      
      update();
      
      animationId = requestAnimationFrame(gameLoop);
    }
    
    // === PREVENIRE SCROLL ===
    document.addEventListener('touchmove', (e) => {
      if (gameRunning) e.preventDefault();
    }, { passive: false });
    
    // === INIT AUDIO ===
    document.addEventListener('click', () => {
      if (audioCtx.state === 'suspended') audioCtx.resume();
    }, { once: true });
  </script>
</body>
</html>


