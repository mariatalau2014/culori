<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test de MatematicƒÉ - Alege Nivelul TƒÉu!</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Comic Sans MS', 'Marker Felt', 'Chalkboard SE', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #ff9ec7 0%, #a8e6cf 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(255, 255, 255, 0.3) 2px, transparent 3px),
                radial-gradient(circle at 90% 80%, rgba(255, 255, 255, 0.3) 2px, transparent 3px),
                radial-gradient(circle at 50% 10%, rgba(255, 105, 180, 0.2) 1px, transparent 2px),
                radial-gradient(circle at 30% 90%, rgba(173, 216, 230, 0.2) 1px, transparent 2px);
        }
        
        .container {
            background: white;
            border-radius: 25px;
            box-shadow: 0 15px 35px rgba(255, 105, 180, 0.4);
            padding: 40px;
            max-width: 600px;
            width: 100%;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .container::before {
            content: '';
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            background: linear-gradient(45deg, #ff69b4, #ff9ec7, #a8e6cf, #8fd3f4);
            z-index: -1;
            border-radius: 30px;
            animation: rotateGradient 8s linear infinite;
            opacity: 0.3;
        }
        
        @keyframes rotateGradient {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        h1 {
            color: #ff69b4;
            margin-bottom: 30px;
            font-size: 32px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            background: linear-gradient(45deg, #ff69b4, #ff9ec7, #8fd3f4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .level-selection {
            margin: 30px 0;
        }
        
        .level-btn {
            background: linear-gradient(135deg, #ffebf3, #f0f8ff);
            border: 3px solid #ff9ec7;
            border-radius: 20px;
            padding: 20px;
            margin: 15px 0;
            font-size: 22px;
            font-weight: bold;
            color: #ff69b4;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            box-shadow: 0 4px 8px rgba(255, 158, 199, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .level-btn:hover {
            background: linear-gradient(135deg, #ffe6f0, #e6f7ff);
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 8px 16px rgba(255, 158, 199, 0.5);
            border-color: #ff69b4;
        }
        
        .level-btn.easy {
            border-color: #4CAF50;
            background: linear-gradient(135deg, #e8f5e8, #f0f8ff);
            color: #2e7d32;
        }
        
        .level-btn.easy:hover {
            border-color: #2e7d32;
            background: linear-gradient(135deg, #d4edda, #e6f7ff);
        }
        
        .level-btn.medium {
            border-color: #FF9800;
            background: linear-gradient(135deg, #fff3e0, #f0f8ff);
            color: #E65100;
        }
        
        .level-btn.medium:hover {
            border-color: #E65100;
            background: linear-gradient(135deg, #ffe0b2, #e6f7ff);
        }
        
        .level-btn.hard {
            border-color: #F44336;
            background: linear-gradient(135deg, #ffebee, #f0f8ff);
            color: #C62828;
        }
        
        .level-btn.hard:hover {
            border-color: #C62828;
            background: linear-gradient(135deg, #ffcdd2, #e6f7ff);
        }
        
        .timer-container {
            background: linear-gradient(45deg, #ffebf3, #e6f7ff);
            border-radius: 50px;
            padding: 15px 25px;
            margin-bottom: 30px;
            display: inline-block;
            border: 3px solid #ff9ec7;
            box-shadow: 0 4px 8px rgba(255, 158, 199, 0.3);
        }
        
        .timer {
            font-size: 28px;
            font-weight: bold;
            color: #ff69b4;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        
        .progress {
            background: linear-gradient(45deg, #e6f7ff, #fff0f5);
            border-radius: 50px;
            padding: 12px 22px;
            margin-bottom: 25px;
            display: inline-block;
            font-size: 18px;
            color: #ff69b4;
            border: 2px solid #8fd3f4;
            box-shadow: 0 3px 6px rgba(143, 211, 244, 0.3);
        }
        
        .problem {
            font-size: 52px;
            font-weight: bold;
            color: #ff69b4;
            margin: 30px 0;
            min-height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            background: linear-gradient(45deg, #fff0f5, #f0f8ff);
            border-radius: 20px;
            padding: 15px;
            border: 3px dashed #ff9ec7;
        }
        
        .options-container {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        
        .option {
            background: linear-gradient(135deg, #ffebf3, #f0f8ff);
            border: 3px solid #ff9ec7;
            border-radius: 20px;
            padding: 18px 22px;
            font-size: 22px;
            font-weight: bold;
            color: #ff69b4;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 85px;
            box-shadow: 0 4px 8px rgba(255, 158, 199, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .option::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: left 0.5s;
        }
        
        .option:hover {
            background: linear-gradient(135deg, #ffe6f0, #e6f7ff);
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 16px rgba(255, 158, 199, 0.5);
            border-color: #ff69b4;
        }
        
        .option:hover::before {
            left: 100%;
        }
        
        .option.correct {
            background: linear-gradient(135deg, #c8f7c5, #a8e6cf);
            border-color: #4CAF50;
            color: #2e7d32;
            animation: bounce 0.6s ease-in-out;
        }
        
        .option.incorrect {
            background: linear-gradient(135deg, #ffcdd2, #ffebee);
            border-color: #f44336;
            color: #c62828;
            animation: shake 0.6s ease-in-out;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0) scale(1); }
            40% { transform: translateY(-10px) scale(1.1); }
            60% { transform: translateY(-5px) scale(1.05); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        
        .option:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .result {
            font-size: 24px;
            font-weight: bold;
            margin: 20px 0;
            min-height: 35px;
            color: #ff69b4;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        
        .points {
            font-size: 22px;
            color: #ff69b4;
            margin-bottom: 15px;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        
        .emoji-display {
            font-size: 48px;
            margin: 10px 0;
            transition: transform 0.3s ease;
        }
        
        .emoji-display:hover {
            transform: scale(1.2) rotate(10deg);
        }
        
        .btn {
            background: linear-gradient(135deg, #ff69b4, #ff9ec7);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 18px 45px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 15px;
            box-shadow: 0 6px 12px rgba(255, 105, 180, 0.4);
            font-family: 'Comic Sans MS', 'Marker Felt', 'Chalkboard SE', sans-serif;
        }
        
        .btn:hover {
            transform: translateY(-4px) scale(1.05);
            box-shadow: 0 10px 20px rgba(255, 105, 180, 0.6);
            background: linear-gradient(135deg, #ff5ca8, #ff8db8);
        }
        
        .btn:active {
            transform: translateY(0) scale(1);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .back-btn {
            background: linear-gradient(135deg, #8fd3f4, #a8e6cf);
            color: #ff69b4;
            border: none;
            border-radius: 50px;
            padding: 12px 30px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
            box-shadow: 0 4px 8px rgba(143, 211, 244, 0.4);
            font-family: 'Comic Sans MS', 'Marker Felt', 'Chalkboard SE', sans-serif;
        }
        
        .back-btn:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 6px 12px rgba(143, 211, 244, 0.6);
            background: linear-gradient(135deg, #7fc7e8, #98d9c0);
        }
        
        .hidden {
            display: none;
        }
        
        .prize-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 158, 199, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }
        
        .prize-content {
            background: white;
            border-radius: 30px;
            padding: 50px;
            text-align: center;
            max-width: 550px;
            width: 90%;
            animation: popIn 0.6s ease-out;
            border: 5px solid #ff69b4;
            box-shadow: 0 20px 40px rgba(255, 105, 180, 0.5);
        }
        
        @keyframes popIn {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .prize-title {
            font-size: 36px;
            color: #ff69b4;
            margin-bottom: 25px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .prize-message {
            font-size: 22px;
            color: #ff69b4;
            margin-bottom: 35px;
            line-height: 1.6;
            font-weight: bold;
        }
        
        .trophy {
            font-size: 100px;
            margin: 25px 0;
            color: #FFD700;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
            animation: sparkle 2s infinite;
        }
        
        @keyframes sparkle {
            0%, 100% { text-shadow: 0 0 20px rgba(255, 215, 0, 0.5); }
            50% { text-shadow: 0 0 30px rgba(255, 215, 0, 0.8), 0 0 40px gold; }
        }
        
        .fireworks {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }
        
        .firework {
            position: absolute;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            animation: explode 1.2s ease-out forwards;
        }
        
        @keyframes explode {
            0% { transform: translate(0, 0); opacity: 1; width: 6px; height: 6px; }
            100% { transform: translate(var(--tx), var(--ty)); opacity: 0; width: 3px; height: 3px; }
        }
        
        /* Decorative elements */
        .star {
            position: absolute;
            font-size: 20px;
            color: #ff69b4;
            opacity: 0.7;
            animation: twinkle 3s infinite;
        }
        
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.9; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Level Selection Screen -->
        <div id="level-screen">
            <h1>‚ú® Alege Nivelul TƒÉu! ‚ú®</h1>
            <p style="color: #ff69b4; margin-bottom: 25px; font-size: 18px;">SelecteazƒÉ dificultatea »ôi √Æncepe aventura matematicƒÉ!</p>
            
            <div class="level-selection">
                <button class="level-btn easy" data-level="easy">
                    üåü U»ôor<br>
                    <span style="font-size: 16px; font-weight: normal;">AdunƒÉri »ôi scƒÉderi</span>
                </button>
                
                <button class="level-btn medium" data-level="medium">
                    ‚≠ê Mediu<br>
                    <span style="font-size: 16px; font-weight: normal;">√énmul»õiri »ôi √ÆmpƒÉr»õiri</span>
                </button>
                
                <button class="level-btn hard" data-level="hard">
                    üí´ Greu<br>
                    <span style="font-size: 16px; font-weight: normal;">√énmul»õiri, √ÆmpƒÉr»õiri »ôi puteri</span>
                </button>
            </div>
        </div>
        
        <!-- Game Screen -->
        <div id="game-screen" class="hidden">
            <h1>‚ú® Test de MatematicƒÉ Magic! ‚ú®</h1>
            
            <div class="progress">√éntrebarea: <span id="question-count">1</span>/20</div>
            
            <div class="timer-container">
                <span class="timer">20</span>
            </div>
            
            <div class="points">Puncte: <span id="points-value">100</span> <span id="points-emoji">üëë</span></div>
            <div class="emoji-display" id="emoji-display">üëë</div>
            
            <div class="problem" id="problem"></div>
            
            <div class="options-container" id="options-container"></div>
            
            <div class="result" id="result"></div>
            
            <button class="btn hidden" id="restart-btn">Re√Æncepe Jocul! üéÄ</button>
            <button class="back-btn" id="back-to-level-btn">‚ùÆ √énapoi la Alegere</button>
        </div>
    </div>

    <script>
        // Add decorative stars
        function addStars() {
            const colors = ['#ff69b4', '#ff9ec7', '#8fd3f4', '#a8e6cf', '#ffd700'];
            for (let i = 0; i < 15; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.innerHTML = '‚≠ê';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.color = colors[Math.floor(Math.random() * colors.length)];
                star.style.fontSize = (Math.random() * 20 + 15) + 'px';
                star.style.animationDelay = Math.random() * 3 + 's';
                document.body.appendChild(star);
            }
        }
        
        // Get emoji based on points
        function getEmojiForPoints(points) {
            if (points >= 90) return 'üëë'; // Crown - Excellent
            if (points >= 80) return 'üåü'; // Star - Great
            if ( points >= 70) return 'üòä'; // Happy face - Good
            if (points >= 60) return 'üôÇ'; // Slightly happy - Okay
            if (points >= 50) return 'üòê'; // Neutral - Fair
            if (points >= 40) return 'üòï'; // Confused - Below average
            if (points >= 30) return 'üòû'; // Sad - Poor
            if (points >= 20) return 'üò¢'; // Crying - Very poor
            if (points >= 10) return 'üò≠'; // Loudly crying - Terrible
            return 'üíÄ'; // Skull - Game over
        }
        
        // Update emoji display
        function updateEmojiDisplay() {
            const emoji = getEmojiForPoints(points);
            document.getElementById('points-emoji').textContent = emoji;
            document.getElementById('emoji-display').textContent = emoji;
        }
        
        // Elements
        const levelScreen = document.getElementById('level-screen');
        const gameScreen = document.getElementById('game-screen');
        const problemEl = document.getElementById('problem');
        const optionsContainer = document.getElementById('options-container');
        const resultEl = document.getElementById('result');
        const timerEl = document.querySelector('.timer');
        const pointsValueEl = document.getElementById('points-value');
        const restartBtn = document.getElementById('restart-btn');
        const backToLevelBtn = document.getElementById('back-to-level-btn');
        const questionCountEl = document.getElementById('question-count');
        const levelButtons = document.querySelectorAll('.level-btn');
        
        // Game state
        let points = 100;
        let questionCount = 1;
        let timeLeft = 20;
        let timerInterval;
        let currentAnswer;
        let gameActive = true;
        let isPenaltyQuestion = false;
        let currentLevel = 'easy';
        let overtimeMode = false; // Flag to track if we're in overtime mode
        let overtimeSeconds = 0; // Track seconds in overtime
        let correctAnswersFirst10 = 0; // Track correct answers in first 10 questions
        const totalQuestions = 20;
        
        // Level descriptions with updated timing rules
        const levelInfo = {
            easy: {
                name: 'U»ôor',
                operations: ['+', '-'],
                maxNumbers: [50, 50],
                penaltyMax: 100,
                timeFirst10: 20, // First 10 questions: 20 seconds
                timeAfter10: 10,  // After 10 correct answers: 10 seconds
                penaltyTime: 25   // Penalty questions: 25 seconds (as requested)
            },
            medium: {
                name: 'Mediu',
                operations: ['*', '/'],
                maxNumbers: [20, 20],
                penaltyMax: 50,
                timeFirst10: 20, // First 10 questions: 20 seconds
                timeAfter10: 10,  // After 10 correct answers: 10 seconds
                penaltyTime: 25   // Penalty questions: 25 seconds (as requested)
            },
            hard: {
                name: 'Greu',
                operations: ['*', '/', '^'],
                maxNumbers: [10, 5],
                penaltyMax: 30,
                timeFirst10: 20, // First 10 questions: 20 seconds
                timeAfter10: 25,  // After 10 correct answers: 25 seconds
                penaltyTime: 25   // Penalty questions: 25 seconds (as requested)
            }
        };
        
        // Check if addition has no carry-over (fƒÉrƒÉ trecere peste ordin)
        function hasNoCarry(num1, num2) {
            if ((num1 % 10) + (num2 % 10) >= 10) return false;
            if (Math.floor(num1 / 10) % 10 + Math.floor(num2 / 10) % 10 >= 10) return false;
            if (Math.floor(num1 / 100) + Math.floor(num2 / 100) >= 10) return false;
            return true;
        }
        
        // Generate 3-digit addition without carry-over (only for easy level penalty)
        function generateNoCarryAddition() {
            let num1, num2;
            do {
                num1 = Math.floor(Math.random() * 900) + 100;
                num2 = Math.floor(Math.random() * 900) + 100;
            } while (!hasNoCarry(num1, num2));
            return { num1, num2, answer: num1 + num2 };
        }
        
        // Generate harder multiplication/division for medium penalty
        function generateHardMediumProblem() {
            const operation = Math.random() < 0.5 ? '*' : '/';
            let num1, num2, answer;
            
            if (operation === '*') {
                // Harder multiplication: numbers up to 50
                num1 = Math.floor(Math.random() * 50) + 10; // 10-59
                num2 = Math.floor(Math.random() * 50) + 10; // 10-59
                answer = num1 * num2;
            } else {
                // Harder division: larger numbers with exact division
                num2 = Math.floor(Math.random() * 20) + 5; // 5-24
                answer = Math.floor(Math.random() * 30) + 10; // 10-39
                num1 = num2 * answer;
            }
            
            const problem = operation === '/' ? `${num1} √∑ ${num2}` : `${num1} ${operation} ${num2}`;
            return { problem, answer };
        }
        
        // Generate harder power problems for hard penalty
        function generateHardPowerProblem() {
            // Larger base and exponent for penalty questions
            const base = Math.floor(Math.random() * 8) + 3; // 3-10
            const exponent = Math.floor(Math.random() * 4) + 3; // 3-6
            const answer = Math.pow(base, exponent);
            const problem = `${base}<sup>${exponent}</sup>`;
            return { problem, answer };
        }
        
        // Generate random math problem based on level
        function generateProblem() {
            if (isPenaltyQuestion) {
                // Handle penalty questions based on level
                if (currentLevel === 'easy') {
                    // Easy level penalty: 3-digit addition without carry-over
                    const { num1, num2, answer } = generateNoCarryAddition();
                    return { problem: `${num1} + ${num2}`, answer };
                } else if (currentLevel === 'medium') {
                    // Medium level penalty: harder multiplication/division
                    return generateHardMediumProblem();
                } else if (currentLevel === 'hard') {
                    // Hard level penalty: harder powers
                    return generateHardPowerProblem();
                }
            }
            
            const level = levelInfo[currentLevel];
            const operation = level.operations[Math.floor(Math.random() * level.operations.length)];
            
            let num1, num2, answer;
            
            if (operation === '*') {
                num1 = Math.floor(Math.random() * level.maxNumbers[1]) + 1;
                num2 = Math.floor(Math.random() * level.maxNumbers[1]) + 1;
                answer = num1 * num2;
            }
            else if (operation === '/') {
                num2 = Math.floor(Math.random() * level.maxNumbers[1]) + 1;
                answer = Math.floor(Math.random() * level.maxNumbers[1]) + 1;
                num1 = num2 * answer;
            }
            else if (operation === '^') {
                num1 = Math.floor(Math.random() * 5) + 2; // 2-6
                num2 = Math.floor(Math.random() * 3) + 2; // 2-4
                answer = Math.pow(num1, num2);
            }
            // For easy level, we still have + and -
            else if (operation === '+') {
                num1 = Math.floor(Math.random() * level.maxNumbers[0]) + 1;
                num2 = Math.floor(Math.random() * (level.maxNumbers[0] + 1 - num1)) + 1;
                answer = num1 + num2;
            } 
            else if (operation === '-') {
                num1 = Math.floor(Math.random() * level.maxNumbers[0]) + 1;
                num2 = Math.floor(Math.random() * num1) + 1;
                answer = num1 - num2;
            }
            
            let problem;
            if (operation === '^') {
                problem = `${num1}<sup>${num2}</sup>`;
            } else if (operation === '/') {
                problem = `${num1} √∑ ${num2}`;
            } else {
                problem = `${num1} ${operation} ${num2}`;
            }
            
            return { problem, answer };
        }
        
        // Generate wrong answers based on level and question type
        function generateWrongAnswers(correctAnswer) {
            const wrongAnswers = new Set();
            const maxAttempts = 20;
            let attempts = 0;
            
            if (isPenaltyQuestion) {
                // For penalty questions, generate more challenging wrong answers
                if (currentLevel === 'easy') {
                    while (wrongAnswers.size < 4 && attempts < maxAttempts) {
                        const offset = Math.floor(Math.random() * 200) - 100;
                        const wrongAnswer = correctAnswer + offset;
                        if (wrongAnswer !== correctAnswer && wrongAnswer > 0) {
                            wrongAnswers.add(wrongAnswer);
                        }
                        attempts++;
                    }
                } else if (currentLevel === 'medium') {
                    // Medium penalty: larger range for wrong answers
                    while (wrongAnswers.size < 4 && attempts < maxAttempts) {
                        const offset = Math.floor(Math.random() * 400) - 200;
                        const wrongAnswer = correctAnswer + offset;
                        if (wrongAnswer !== correctAnswer && wrongAnswer > 0) {
                            wrongAnswers.add(wrongAnswer);
                        }
                        attempts++;
                    }
                } else if (currentLevel === 'hard') {
                    // Hard penalty: very large range for wrong answers
                    while (wrongAnswers.size < 4 && attempts < maxAttempts) {
                        const offset = Math.floor(Math.random() * 1000) - 500;
                        const wrongAnswer = correctAnswer + offset;
                        if (wrongAnswer !== correctAnswer && wrongAnswer > 0) {
                            wrongAnswers.add(wrongAnswer);
                        }
                        attempts++;
                    }
                }
            } else {
                const level = levelInfo[currentLevel];
                const range = currentLevel === 'easy' ? 50 : (currentLevel === 'medium' ? 200 : 500);
                
                while (wrongAnswers.size < 4 && attempts < maxAttempts) {
                    const wrongAnswer = Math.floor(Math.random() * (range + 1));
                    if (wrongAnswer !== correctAnswer && wrongAnswer >= 0) {
                        wrongAnswers.add(wrongAnswer);
                    }
                    attempts++;
                }
            }
            
            // If we couldn't generate enough unique wrong answers, fill with sequential numbers
            if (wrongAnswers.size < 4) {
                let filler = correctAnswer + 1;
                while (wrongAnswers.size < 4) {
                    if (filler !== correctAnswer) {
                        wrongAnswers.add(filler);
                    }
                    filler++;
                }
            }
            
            return Array.from(wrongAnswers);
        }
        
        // Display problem and options
        function displayProblem() {
            const { problem, answer } = generateProblem();
            currentAnswer = answer;
            
            if (!isPenaltyQuestion) {
                questionCountEl.textContent = questionCount;
            }
            
            // Reset overtime mode when displaying new problem
            overtimeMode = false;
            overtimeSeconds = 0;
            
            // Set timer based on level, question count, and whether it's a penalty question
            if (isPenaltyQuestion) {
                timeLeft = levelInfo[currentLevel].penaltyTime; // Always 25 seconds for penalty (as requested)
            } else {
                // Check if we have 10 or more correct answers in the first 10 questions
                if (correctAnswersFirst10 >= 10) {
                    timeLeft = levelInfo[currentLevel].timeAfter10;
                } else {
                    timeLeft = levelInfo[currentLevel].timeFirst10;
                }
            }
            timerEl.textContent = timeLeft;
            
            problemEl.innerHTML = problem;
            
            const wrongAnswers = generateWrongAnswers(answer);
            const allAnswers = [...wrongAnswers, answer];
            const shuffledAnswers = allAnswers.sort(() => Math.random() - 0.5);
            
            optionsContainer.innerHTML = '';
            shuffledAnswers.forEach(ans => {
                const option = document.createElement('div');
                option.className = 'option';
                option.textContent = ans;
                option.addEventListener('click', () => selectAnswer(ans));
                optionsContainer.appendChild(option);
            });
            
            resultEl.textContent = '';
            restartBtn.classList.add('hidden');
        }
        
        // Create fireworks effect
        function createFireworks() {
            const container = document.createElement('div');
            container.className = 'fireworks';
            document.body.appendChild(container);
            
            const colors = ['#FF5252', '#4CAF50', '#2196F3', '#FFC107', '#9C27B0', '#00BCD4', '#FF69B4', '#FF9EC7'];
            
            for (let i = 0; i < 60; i++) {
                const firework = document.createElement('div');
                firework.className = 'firework';
                firework.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                firework.style.left = Math.random() * 100 + '%';
                firework.style.top = Math.random() * 100 + '%';
                firework.style.setProperty('--tx', (Math.random() - 0.5) * 250 + 'px');
                firework.style.setProperty('--ty', (Math.random() - 0.5) * 250 + 'px');
                container.appendChild(firework);
            }
            
            setTimeout(() => {
                container.remove();
            }, 2500);
        }
        
        // Show prize modal
        function showPrizeModal() {
            createFireworks();
            
            const finalEmoji = getEmojiForPoints(points);
            
            const modal = document.createElement('div');
            modal.className = 'prize-modal';
            modal.innerHTML = `
                <div class="prize-content">
                    <div class="trophy">${finalEmoji}</div>
                    <div class="prize-title">FelicitƒÉri, Super Eroine! üåà</div>
                    <div class="prize-message">
                        Ai completat cu succes toate cele 20 de √ÆntrebƒÉri!<br>
                        Ai terminat cu <strong>${points} puncte</strong>! ‚ú®<br>
                        E»ôti o adevƒÉratƒÉ campioanƒÉ a matematicii! üëë
                    </div>
                    <button class="btn" id="final-restart-btn">JoacƒÉ din nou! üéÄ</button>
                    <button class="back-btn" style="margin-top: 15px;" id="final-back-btn">‚ùÆ √énapoi la Alegere</button>
                </div>
            `;
            document.body.appendChild(modal);
            
            document.getElementById('final-restart-btn').addEventListener('click', () => {
                modal.remove();
                restartGame();
            });
            
            document.getElementById('final-back-btn').addEventListener('click', () => {
                modal.remove();
                goBackToLevelSelection();
            });
        }
        
        // Handle answer selection
        function selectAnswer(selectedAnswer) {
            if (!gameActive) return;
            
            clearInterval(timerInterval);
            gameActive = false;
            
            const options = document.querySelectorAll('.option');
            options.forEach(option => {
                const optionValue = parseInt(option.textContent);
                if (optionValue === currentAnswer) {
                    option.classList.add('correct');
                } else if (optionValue === selectedAnswer) {
                    option.classList.add('incorrect');
                }
                option.style.pointerEvents = 'none';
            });
            
            if (selectedAnswer === currentAnswer) {
                resultEl.textContent = 'Corect! üéâ‚ú®';
                resultEl.style.color = '#4CAF50';
                
                // Track correct answers in first 10 questions
                if (!isPenaltyQuestion && questionCount <= 10) {
                    correctAnswersFirst10++;
                }
            } else {
                resultEl.textContent = `Gre»ôit! Acum ai o √Æntrebare mai grea... üí´`;
                resultEl.style.color = '#f44336';
                points--; // Deduct 1 point for wrong answer
                pointsValueEl.textContent = points;
                updateEmojiDisplay();
                isPenaltyQuestion = true;
            }
            
            if (isPenaltyQuestion && selectedAnswer === currentAnswer) {
                // Correct answer on penalty question
                isPenaltyQuestion = false;
                if (questionCount >= totalQuestions) {
                    setTimeout(showPrizeModal, 3000);
                } else {
                    setTimeout(() => {
                        questionCount++;
                        displayProblem();
                        startTimer();
                    }, 3000);
                }
            } else if (!isPenaltyQuestion && selectedAnswer === currentAnswer) {
                // Correct answer on regular question
                if (questionCount >= totalQuestions) {
                    setTimeout(showPrizeModal, 3000);
                } else {
                    setTimeout(() => {
                        questionCount++;
                        displayProblem();
                        startTimer();
                    }, 3000);
                }
            } else if (selectedAnswer !== currentAnswer) {
                // Wrong answer - stay on same question count, show penalty next
                setTimeout(() => {
                    displayProblem();
                    startTimer();
                }, 3000);
            }
        }
        
        // Start timer - slowed down to update every 1.5 seconds instead of 1 second
        function startTimer() {
            gameActive = true;
            overtimeMode = false;
            overtimeSeconds = 0;
            
            timerInterval = setInterval(() => {
                if (timeLeft > 0) {
                    timeLeft--;
                    timerEl.textContent = timeLeft;
                } else {
                    // Overtime mode: show negative time and deduct points
                    if (!overtimeMode) {
                        overtimeMode = true;
                        overtimeSeconds = 0;
                    }
                    
                    overtimeSeconds++;
                    timeLeft--;
                    timerEl.textContent = timeLeft; // This will show negative numbers
                    
                    // Deduct 1 point for each second in overtime
                    points--;
                    pointsValueEl.textContent = points;
                    updateEmojiDisplay();
                    
                    // End game if points reach 0 or below
                    if (points <= 0) {
                        clearInterval(timerInterval);
                        gameActive = false;
                        resultEl.textContent = `Ai rƒÉmas fƒÉrƒÉ puncte! Joc terminat. üíî`;
                        resultEl.style.color = '#f44336';
                        
                        setTimeout(() => {
                            goBackToLevelSelection();
                        }, 3000);
                        return;
                    }
                    
                    // If more than 5 seconds in overtime, automatically mark as wrong
                    if (overtimeSeconds > 5) {
                        clearInterval(timerInterval);
                        gameActive = false;
                        resultEl.textContent = `Timp expirat! Acum ai o √Æntrebare mai grea... üí´`;
                        resultEl.style.color = '#f44336';
                        
                        points--; // Deduct 1 point for timeout
                        pointsValueEl.textContent = points;
                        updateEmojiDisplay();
                        isPenaltyQuestion = true;
                        
                        setTimeout(() => {
                            displayProblem();
                            startTimer();
                        }, 3000);
                        return;
                    }
                }
            }, 1500); // Changed from 1000ms to 1500ms (1.5 seconds per tick)
        }
        
        // Restart game
        function restartGame() {
            points = 100;
            questionCount = 1;
            correctAnswersFirst10 = 0; // Reset correct answers counter
            isPenaltyQuestion = false;
            pointsValueEl.textContent = points;
            updateEmojiDisplay();
            restartBtn.classList.add('hidden');
            displayProblem();
            startTimer();
        }
        
        // Go back to level selection
        function goBackToLevelSelection() {
            gameScreen.classList.add('hidden');
            levelScreen.classList.remove('hidden');
        }
        
        // Start game with selected level
        function startGame(level) {
            currentLevel = level;
            levelScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');
            restartGame();
        }
        
        // Event listeners for level selection
        levelButtons.forEach(button => {
            button.addEventListener('click', () => {
                const level = button.getAttribute('data-level');
                startGame(level);
            });
        });
        
        // Event listener for restart button
        restartBtn.addEventListener('click', restartGame);
        
        // Event listener for back to level button
        backToLevelBtn.addEventListener('click', goBackToLevelSelection);
        
        // Initialize game and add decorative elements
        addStars();
        updateEmojiDisplay();
    </script>
</body>
</html>

