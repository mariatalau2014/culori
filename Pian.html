<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Musical Piano Adventure</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Caveat:wght@600;700&display=swap');
    body {
      font-family: 'Inter', sans-serif;
      margin: 0;
      padding: 0;
    }
    .cursive-text {
      font-family: 'Caveat', cursive;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useRef, useEffect } = React;

    const PianoWithFallingDots = () => {
      const [activeKeys, setActiveKeys] = useState(new Set());
      const [fallingDots, setFallingDots] = useState([]);
      const [currentSong, setCurrentSong] = useState('twinkle');
      const [isAutoMode, setIsAutoMode] = useState(true);
      const [speedMultiplier, setSpeedMultiplier] = useState(1.0);
      const [isSongFinished, setIsSongFinished] = useState(false);
      const audioContextRef = useRef(null);
      
      const whiteKeys = [
        { id: 'C4', note: 'C', freq: 261.63, lyric: 'Do', x: 0 },
        { id: 'D4', note: 'D', freq: 293.66, lyric: 'Re', x: 32 },
        { id: 'E4', note: 'E', freq: 329.63, lyric: 'Mi', x: 64 },
        { id: 'F4', note: 'F', freq: 349.23, lyric: 'Fa', x: 96 },
        { id: 'G4', note: 'G', freq: 392.00, lyric: 'Sol', x: 128 },
        { id: 'A4', note: 'A', freq: 440.00, lyric: 'La', x: 160 },
        { id: 'B4', note: 'B', freq: 493.88, lyric: 'Si', x: 192 },
        { id: 'C5', note: 'C', freq: 523.25, lyric: 'Do!', x: 224 }
      ];

      const baseSongs = {
        twinkle: {
          name: 'Twinkle Twinkle',
          lyrics: [
            'Twinkle', 'twinkle', 'little', 'star',
            'How', 'I', 'wonder', 'what', 'you', 'are',
            'Up', 'above', 'the', 'world', 'so', 'high',
            'Like', 'a', 'diamond', 'in', 'the', 'sky'
          ],
          notes: [
            'C4', 'C4', 'G4', 'G4', 'A4', 'A4', 'G4',
            'F4', 'F4', 'E4', 'E4', 'D4', 'D4', 'C4',
            'G4', 'G4', 'F4', 'F4', 'E4', 'E4', 'D4',
            'G4', 'G4', 'F4', 'F4', 'E4', 'E4', 'D4',
            'C4', 'C4', 'G4', 'G4', 'A4', 'A4', 'G4',
            'F4', 'F4', 'E4', 'E4', 'D4', 'D4', 'C4'
          ],
          tempo: 500
        },
        happy: {
          name: 'Happy Birthday',
          lyrics: [
            'Happy', 'birthday', 'to', 'you',
            'Happy', 'birthday', 'to', 'you',
            'Happy', 'birthday', 'dear', 'friend',
            'Happy', 'birthday', 'to', 'you'
          ],
          notes: [
            'C4', 'C4', 'D4', 'C4', 'F4', 'E4',
            'C4', 'C4', 'D4', 'C4', 'G4', 'F4',
            'C4', 'C4', 'C5', 'A4', 'F4', 'E4', 'D4',
            'A4', 'A4', 'G4', 'F4', 'G4', 'F4'
          ],
          tempo: 600
        },
        row: {
          name: 'Row Your Boat',
          lyrics: [
            'Row', 'row', 'row', 'your', 'boat',
            'Gently', 'down', 'the', 'stream',
            'Merrily', 'merrily', 'merrily', 'merrily',
            'Life', 'is', 'but', 'a', 'dream'
          ],
          notes: [
            'C4', 'C4', 'C4', 'D4', 'E4',
            'E4', 'D4', 'E4', 'F4', 'G4',
            'G4', 'G4', 'G4', 'G4', 'G4', 'G4',
            'E4', 'E4', 'E4', 'E4', 'E4', 'E4',
            'G4', 'G4', 'G4', 'G4', 'G4', 'G4',
            'C4', 'C4', 'C4', 'C4', 'C4', 'C4'
          ],
          tempo: 450
        },
        jingle: {
          name: 'Jingle Bells',
          lyrics: [
            'Jingle', 'bells', 'jingle', 'bells',
            'Jingle', 'all', 'the', 'way',
            'Oh', 'what', 'fun', 'it', 'is', 'to',
            'Ride', 'in', 'a', 'one', 'horse', 'open', 'sleigh'
          ],
          notes: [
            'E4', 'E4', 'E4', 'E4', 'E4', 'E4', 'E4', 'G4', 'C4', 'D4', 'E4',
            'F4', 'F4', 'F4', 'F4', 'F4', 'E4', 'E4', 'E4', 'E4', 'D4', 'D4', 'E4', 'D4', 'G4'
          ],
          tempo: 400
        },
        mary: {
          name: "Mary Had a Lamb",
          lyrics: [
            'Mary', 'had', 'a', 'little', 'lamb',
            'Little', 'lamb', 'little', 'lamb',
            'Mary', 'had', 'a', 'little', 'lamb',
            'Its', 'fleece', 'was', 'white', 'as', 'snow'
          ],
          notes: [
            'E4', 'D4', 'C4', 'D4', 'E4', 'E4', 'E4',
            'D4', 'D4', 'D4', 'E4', 'G4', 'G4',
            'E4', 'D4', 'C4', 'D4', 'E4', 'E4', 'E4', 'E4', 'D4', 'D4', 'E4', 'D4', 'C4'
          ],
          tempo: 500
        },
        abc: {
          name: 'ABC Song',
          lyrics: [
            'A', 'B', 'C', 'D', 'E', 'F', 'G',
            'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P',
            'Q', 'R', 'S', 'T', 'U', 'V',
            'W', 'X', 'Y', 'and', 'Z'
          ],
          notes: [
            'C4', 'C4', 'G4', 'G4', 'A4', 'A4', 'G4',
            'F4', 'F4', 'E4', 'E4', 'D4', 'D4', 'C4',
            'G4', 'G4', 'F4', 'F4', 'E4', 'E4', 'D4',
            'G4', 'G4', 'F4', 'F4', 'E4', 'E4', 'D4',
            'C4', 'C4', 'G4', 'G4', 'A4', 'A4', 'G4',
            'F4', 'F4', 'E4', 'E4', 'D4', 'D4', 'C4'
          ],
          tempo: 480
        },
        old: {
          name: 'Old MacDonald',
          lyrics: [
            'Old', 'MacDonald', 'had', 'a', 'farm',
            'E-I-E-I-O',
            'And', 'on', 'his', 'farm', 'he', 'had', 'a', 'cow',
            'E-I-E-I-O'
          ],
          notes: [
            'G4', 'G4', 'G4', 'D4', 'E4', 'E4', 'D4',
            'G4', 'G4', 'G4', 'D4', 'E4', 'E4', 'D4',
            'G4', 'B4', 'B4', 'A4', 'A4', 'G4',
            'D4', 'D4', 'C4', 'C4', 'D4', 'E4', 'D4', 'G4',
            'G4', 'G4', 'D4', 'E4', 'E4', 'D4'
          ],
          tempo: 550
        },
        barbi: {
          name: 'Barbi Warl',
          lyrics: [
            'In', 'a', 'Barbi', 'Warl', 'so', 'bright',
            'Where', 'dreams', 'take', 'flight', 'all', 'night',
            'Pink', 'castles', 'shine', 'with', 'glow',
            'And', 'magic', 'flows', 'just', 'like', 'so'
          ],
          notes: [
            'C4', 'E4', 'G4', 'C5', 'G4', 'E4', 'C4',
            'D4', 'F4', 'A4', 'D5', 'A4', 'F4', 'D4',
            'E4', 'G4', 'B4', 'E5', 'B4', 'G4', 'E4',
            'C4', 'E4', 'G4', 'C5', 'G4', 'E4', 'C4'
          ],
          tempo: 520
        },
        rainbow: {
          name: 'Rainbow Song',
          lyrics: [
            'Red', 'and', 'yellow', 'and', 'pink', 'and', 'green',
            'Purple', 'and', 'orange', 'and', 'blue',
            'I', 'can', 'sing', 'a', 'rainbow',
            'Sing', 'along', 'with', 'me'
          ],
          notes: [
            'C4', 'D4', 'E4', 'F4', 'G4', 'A4', 'B4',
            'C5', 'B4', 'A4', 'G4', 'F4', 'E4', 'D4',
            'C4', 'E4', 'G4', 'C5', 'G4', 'E4', 'C4',
            'D4', 'F4', 'A4', 'D5', 'A4', 'F4', 'D4'
          ],
          tempo: 500
        },
        wheels: {
          name: 'Wheels on the Bus',
          lyrics: [
            'The', 'wheels', 'on', 'the', 'bus', 'go',
            'Round', 'and', 'round', 'round',
            'All', 'through', 'the', 'town'
          ],
          notes: [
            'C4', 'C4', 'C4', 'G4', 'G4', 'G4',
            'A4', 'A4', 'G4', 'F4', 'F4', 'E4', 'E4', 'D4', 'D4', 'C4',
            'G4', 'G4', 'F4', 'F4', 'E4', 'E4', 'D4',
            'G4', 'G4', 'F4', 'F4', 'E4', 'E4', 'D4',
            'C4', 'C4', 'G4', 'G4', 'F4', 'F4', 'E4', 'E4', 'D4', 'C4'
          ],
          tempo: 450
        },
        spider: {
          name: 'Itsy Bitsy Spider',
          lyrics: [
            'The', 'itsy', 'bitsy', 'spider',
            'Climbed', 'up', 'the', 'water', 'spout',
            'Down', 'came', 'the', 'rain',
            'And', 'washed', 'the', 'spider', 'out'
          ],
          notes: [
            'C4', 'D4', 'E4', 'C4', 'E4', 'G4', 'E4', 'C4',
            'D4', 'E4', 'F4', 'D4', 'F4', 'A4', 'F4', 'D4',
            'E4', 'G4', 'E4', 'C4', 'E4', 'G4', 'E4', 'C4',
            'C4', 'G4', 'G4', 'G4', 'E4', 'E4', 'E4', 'C4'
          ],
          tempo: 500
        },
        baa: {
          name: 'Baa Baa Black Sheep',
          lyrics: [
            'Baa', 'baa', 'black', 'sheep',
            'Have', 'you', 'any', 'wool',
            'Yes', 'sir', 'yes', 'sir',
            'Three', 'bags', 'full'
          ],
          notes: [
            'E4', 'E4', 'E4', 'E4', 'E4', 'E4', 'E4', 'G4',
            'C4', 'D4', 'E4', 'F4', 'F4', 'E4', 'E4', 'D4', 'D4',
            'E4', 'D4', 'C4', 'D4', 'E4', 'E4', 'E4',
            'D4', 'D4', 'E4', 'D4', 'C4'
          ],
          tempo: 550
        },
        star: {
          name: 'Star Light',
          lyrics: [
            'Star', 'light', 'star', 'bright',
            'First', 'star', 'I', 'see', 'tonight',
            'I', 'wish', 'I', 'may', 'I', 'wish', 'I', 'might',
            'Have', 'the', 'wish', 'I', 'wish', 'tonight'
          ],
          notes: [
            'C4', 'C4', 'G4', 'G4', 'A4', 'A4', 'G4',
            'F4', 'F4', 'E4', 'E4', 'D4', 'D4', 'C4',
            'G4', 'G4', 'F4', 'F4', 'E4', 'E4', 'D4',
            'G4', 'G4', 'F4', 'F4', 'E4', 'E4', 'D4',
            'C4', 'C4', 'G4', 'G4', 'A4', 'A4', 'G4',
            'F4', 'F4', 'E4', 'E4', 'D4', 'D4', 'C4'
          ],
          tempo: 600
        }
      };

      // Apply speed multiplier to get current songs
      const songs = {};
      Object.entries(baseSongs).forEach(([key, song]) => {
        songs[key] = {
          ...song,
          tempo: Math.max(100, Math.round(song.tempo / speedMultiplier))
        };
      });

      let currentSongIndex = 0;

      const initAudioContext = () => {
        if (!audioContextRef.current) {
          audioContextRef.current = new (window.AudioContext || window.webkitAudioContext)();
        }
      };

      const playNote = (freq, lyric) => {
        initAudioContext();
        const oscillator = audioContextRef.current.createOscillator();
        const gainNode = audioContextRef.current.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContextRef.current.destination);
        
        oscillator.frequency.value = freq;
        oscillator.type = 'sine';
        
        const now = audioContextRef.current.currentTime;
        gainNode.gain.setValueAtTime(0, now);
        gainNode.gain.linearRampToValueAtTime(0.4, now + 0.01);
        gainNode.gain.linearRampToValueAtTime(0, now + 0.7);
        
        oscillator.start(now);
        oscillator.stop(now + 0.7);
      };

      const createFallingDot = () => {
        const song = songs[currentSong];
        if (currentSongIndex >= song.notes.length) {
          setIsSongFinished(true);
          return;
        }
        
        const noteId = song.notes[currentSongIndex];
        const lyric = song.lyrics[currentSongIndex];
        currentSongIndex++;
        
        const key = whiteKeys.find(k => k.id === noteId);
        if (key) {
          const newDot = {
            id: Date.now() + Math.random(),
            x: key.x + 16,
            y: 0,
            targetKey: key.id,
            lyric: lyric,
            freq: key.freq,
            size: 20,
            color: `hsl(${Math.random() * 360}, 80%, 65%)`
          };
          setFallingDots(prev => [...prev, newDot]);
        }
      };

      useEffect(() => {
        const song = songs[currentSong];
        if (isSongFinished) return;
        
        const interval = setInterval(() => {
          if (isAutoMode) {
            createFallingDot();
          }
        }, song.tempo);

        return () => clearInterval(interval);
      }, [currentSong, isAutoMode, speedMultiplier, isSongFinished]);

      // Animation loop for falling dots
      useEffect(() => {
        const fallInterval = setInterval(() => {
          setFallingDots(prev => {
            const updatedDots = prev.map(dot => ({
              ...dot,
              y: dot.y + (4.0 * speedMultiplier)
            })).filter(dot => dot.y < 300);
            return updatedDots;
          });
        }, 30);

        return () => clearInterval(fallInterval);
      }, [speedMultiplier]);

      const handleDotReachedPiano = (dot) => {
        const key = whiteKeys.find(k => k.id === dot.targetKey);
        if (key) {
          playNote(dot.freq, dot.lyric);
          setActiveKeys(prev => new Set([...prev, key.id]));
          setTimeout(() => {
            setActiveKeys(prev => {
              const newSet = new Set(prev);
              newSet.delete(key.id);
              return newSet;
            });
          }, 300);
          
          // Remove the dot when it reaches the piano
          setFallingDots(prev => prev.filter(d => d.id !== dot.id));
        }
      };

      const handleKeyPress = (key) => {
        playNote(key.freq, key.lyric);
        setActiveKeys(prev => new Set([...prev, key.id]));
        setTimeout(() => {
          setActiveKeys(prev => {
            const newSet = new Set(prev);
            newSet.delete(key.id);
            return newSet;
          });
        }, 300);
        
        // Remove only the first (oldest) falling dot that matches this key
        setFallingDots(prev => {
          const index = prev.findIndex(dot => dot.targetKey === key.id);
          if (index !== -1) {
            return [...prev.slice(0, index), ...prev.slice(index + 1)];
          }
          return prev;
        });
      };

      const handleDotClick = (dot) => {
        setFallingDots(prev => prev.filter(d => d.id !== dot.id));
        handleDotReachedPiano(dot);
      };

      const changeSong = (songKey) => {
        setCurrentSong(songKey);
        currentSongIndex = 0;
        setFallingDots([]);
        setIsSongFinished(false);
      };

      const handleSpeedChange = (e) => {
        const value = parseFloat(e.target.value);
        setSpeedMultiplier(value);
      };

      const restartSong = () => {
        currentSongIndex = 0;
        setFallingDots([]);
        setIsSongFinished(false);
      };

      return (
        <div className="min-h-screen bg-gradient-to-b from-indigo-900 via-purple-900 to-pink-800 flex flex-col items-center justify-center p-4">
          <div className="text-center mb-6">
            <h1 className="text-4xl md:text-5xl font-bold text-white mb-2 cursive-text">
              Musical Piano Adventure
            </h1>
            <p className="text-purple-200 text-lg cursive-text">
              Play along with falling lyrics or create your own melody! ðŸŽµ
            </p>
          </div>

          <div className="mb-6 max-w-4xl w-full">
            <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-2">
              {Object.entries(baseSongs).map(([key, song]) => (
                <button
                  key={key}
                  onClick={() => changeSong(key)}
                  className={`px-2 py-2 rounded-lg font-medium transition-all duration-200 text-sm cursive-text ${
                    currentSong === key
                      ? 'bg-gradient-to-r from-yellow-400 to-orange-500 text-white shadow-lg'
                      : 'bg-white/20 text-purple-200 hover:bg-white/30'
                  }`}
                >
                  {song.name}
                </button>
              ))}
            </div>
          </div>

          <div className="mb-6 flex flex-col items-center w-full max-w-md">
            <div className="flex items-center gap-4 mb-2 w-full">
              <span className="text-white cursive-text font-medium">Slow</span>
              <input
                type="range"
                min="0.5"
                max="2.0"
                step="0.1"
                value={speedMultiplier}
                onChange={handleSpeedChange}
                className="w-full h-2 bg-purple-300 rounded-lg appearance-none cursor-pointer"
              />
              <span className="text-white cursive-text font-medium">Fast</span>
            </div>
            <div className="text-purple-200 cursive-text text-sm">
              Speed: {speedMultiplier.toFixed(1)}x
            </div>
          </div>

          <div className="mb-6 flex gap-3">
            <button
              onClick={() => setIsAutoMode(!isAutoMode)}
              className={`px-4 py-2 rounded-full font-medium transition-all duration-200 cursive-text ${
                isAutoMode
                  ? 'bg-gradient-to-r from-green-400 to-emerald-500 text-white shadow-lg'
                  : 'bg-gradient-to-r from-purple-400 to-pink-500 text-white shadow-lg'
              }`}
            >
              {isAutoMode ? 'Auto Mode: ON' : 'Free Play: ON'}
            </button>
            
            {isSongFinished && (
              <button
                onClick={restartSong}
                className="px-4 py-2 bg-gradient-to-r from-blue-400 to-cyan-500 text-white rounded-full font-medium cursive-text shadow-lg hover:shadow-xl transition-all duration-200"
              >
                Restart Song
              </button>
            )}
          </div>

          <div className="relative" style={{ width: '256px', height: '340px' }}>
            {fallingDots.map(dot => (
              <div
                key={dot.id}
                className="absolute rounded-full shadow-lg transform -translate-x-1/2 -translate-y-1/2 cursor-pointer transition-all duration-200 hover:scale-125"
                style={{
                  left: `${dot.x}px`,
                  top: `${dot.y}px`,
                  width: `${dot.size}px`,
                  height: `${dot.size}px`,
                  backgroundColor: dot.color,
                  boxShadow: `0 0 15px ${dot.color}cc, 0 0 30px ${dot.color}80`
                }}
                onClick={() => handleDotClick(dot)}
              >
                <div className="w-full h-full flex items-center justify-center">
                  <span className="text-white font-bold text-xs drop-shadow-md cursive-text">
                    {dot.lyric}
                  </span>
                </div>
              </div>
            ))}

            <div className="absolute bottom-0 left-0 flex" style={{ width: '256px' }}>
              {whiteKeys.map(key => (
                <button
                  key={key.id}
                  className={`w-8 h-36 bg-white border-r border-gray-300 last:border-r-0 rounded-t-none shadow-lg relative
                    ${activeKeys.has(key.id) 
                      ? 'bg-gradient-to-b from-cyan-300 to-cyan-200 transform -translate-y-2 ring-4 ring-cyan-400 shadow-2xl' 
                      : 'hover:bg-gray-100 hover:shadow-xl'}
                    transition-all duration-150 ease-in-out cursor-pointer z-10 flex flex-col items-center justify-end pb-2`}
                  onClick={() => handleKeyPress(key)}
                >
                  <div className="text-gray-700 font-bold text-base mb-1 cursive-text">
                    {key.note}
                  </div>
                  <div className="text-gray-600 font-medium text-xs cursive-text">
                    {key.lyric}
                  </div>
                </button>
              ))}
            </div>

            <div className="absolute bottom-0 left-0 w-full h-36 bg-gradient-to-t from-amber-900 via-amber-800 to-amber-700 rounded-t-lg z-0 border-t-4 border-amber-950" />
          </div>

          <div className="mt-8 text-center max-w-md">
            <div className="bg-white/10 backdrop-blur-sm rounded-lg p-4 border border-white/20">
              <p className="text-purple-200 text-sm leading-relaxed cursive-text">
                Choose from 13 different songs! When a song finishes, dots stop appearing automatically. 
                Use the Restart button to play again. Adjust speed with the slider. âœ¨
              </p>
            </div>
          </div>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<PianoWithFallingDots />);
  </script>
</body>
</html>

